(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.$rdf = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (process){
!function(){function n(n){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,n.apply(t,arguments)}}var t,e,r={};t=this,null!=t&&(e=t.async),r.noConflict=function(){return t.async=e,r};var i=Object.prototype.toString,u=Array.isArray||function(n){return"[object Array]"===i.call(n)},c=function(n,t){for(var e=0;e<n.length;e+=1)t(n[e],e,n)},o=function(n,t){if(n.map)return n.map(t);var e=[];return c(n,function(n,r,i){e.push(t(n,r,i))}),e},a=function(n,t,e){return n.reduce?n.reduce(t,e):(c(n,function(n,r,i){e=t(e,n,r,i)}),e)},l=function(n){if(Object.keys)return Object.keys(n);var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t};"undefined"!=typeof process&&process.nextTick?(r.nextTick=process.nextTick,"undefined"!=typeof setImmediate?r.setImmediate=function(n){setImmediate(n)}:r.setImmediate=r.nextTick):"function"==typeof setImmediate?(r.nextTick=function(n){setImmediate(n)},r.setImmediate=r.nextTick):(r.nextTick=function(n){setTimeout(n,0)},r.setImmediate=r.nextTick),r.each=function(t,e,r){function i(n){n?(r(n),r=function(){}):(u+=1)>=t.length&&r()}if(r=r||function(){},!t.length)return r();var u=0;c(t,function(t){e(t,n(i))})},r.forEach=r.each,r.eachSeries=function(n,t,e){if(e=e||function(){},!n.length)return e();var r=0,i=function(){t(n[r],function(t){t?(e(t),e=function(){}):(r+=1,r>=n.length?e():i())})};i()},r.forEachSeries=r.eachSeries,r.eachLimit=function(n,t,e,r){f(t).apply(null,[n,e,r])},r.forEachLimit=r.eachLimit;var f=function(n){return function(t,e,r){if(r=r||function(){},!t.length||n<=0)return r();var i=0,u=0,c=0;!function o(){if(i>=t.length)return r();for(;c<n&&u<t.length;)u+=1,c+=1,e(t[u-1],function(n){n?(r(n),r=function(){}):(i+=1,c-=1,i>=t.length?r():o())})}()}},s=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[r.each].concat(t))}},p=function(n,t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[f(n)].concat(e))}},y=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[r.eachSeries].concat(t))}},d=function(n,t,e,r){if(t=o(t,function(n,t){return{index:t,value:n}}),r){var i=[];n(t,function(n,t){e(n.value,function(e,r){i[n.index]=r,t(e)})},function(n){r(n,i)})}else n(t,function(n,t){e(n.value,function(n){t(n)})})};r.map=s(d),r.mapSeries=y(d),r.mapLimit=function(n,t,e,r){return h(t)(n,e,r)};var h=function(n){return p(n,d)};r.reduce=function(n,t,e,i){r.eachSeries(n,function(n,r){e(t,n,function(n,e){t=e,r(n)})},function(n){i(n,t)})},r.inject=r.reduce,r.foldl=r.reduce,r.reduceRight=function(n,t,e,i){var u=o(n,function(n){return n}).reverse();r.reduce(u,t,e,i)},r.foldr=r.reduceRight;var v=function(n,t,e,r){var i=[];t=o(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e&&i.push(n),t()})},function(n){r(o(i.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};r.filter=s(v),r.filterSeries=y(v),r.select=r.filter,r.selectSeries=r.filterSeries;var m=function(n,t,e,r){var i=[];t=o(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e||i.push(n),t()})},function(n){r(o(i.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};r.reject=s(m),r.rejectSeries=y(m);var g=function(n,t,e,r){n(t,function(n,t){e(n,function(e){e?(r(n),r=function(){}):t()})},function(n){r()})};r.detect=s(g),r.detectSeries=y(g),r.some=function(n,t,e){r.each(n,function(n,r){t(n,function(n){n&&(e(!0),e=function(){}),r()})},function(n){e(!1)})},r.any=r.some,r.every=function(n,t,e){r.each(n,function(n,r){t(n,function(n){n||(e(!1),e=function(){}),r()})},function(n){e(!0)})},r.all=r.every,r.sortBy=function(n,t,e){r.map(n,function(n,e){t(n,function(t,r){t?e(t):e(null,{value:n,criteria:r})})},function(n,t){if(n)return e(n);var r=function(n,t){var e=n.criteria,r=t.criteria;return e<r?-1:e>r?1:0};e(null,o(t.sort(r),function(n){return n.value}))})},r.auto=function(n,t){t=t||function(){};var e=l(n),i=e.length;if(!i)return t();var o={},f=[],s=function(n){f.unshift(n)},p=function(n){for(var t=0;t<f.length;t+=1)if(f[t]===n)return void f.splice(t,1)},y=function(){i--,c(f.slice(0),function(n){n()})};s(function(){if(!i){var n=t;t=function(){},n(null,o)}}),c(e,function(e){var i=u(n[e])?n[e]:[n[e]],f=function(n){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),n){var u={};c(l(o),function(n){u[n]=o[n]}),u[e]=i,t(n,u),t=function(){}}else o[e]=i,r.setImmediate(y)},d=i.slice(0,Math.abs(i.length-1))||[],h=function(){return a(d,function(n,t){return n&&o.hasOwnProperty(t)},!0)&&!o.hasOwnProperty(e)};if(h())i[i.length-1](f,o);else{var v=function(){h()&&(p(v),i[i.length-1](f,o))};s(v)}})},r.retry=function(n,t,e){var i=[];"function"==typeof n&&(e=t,t=n,n=5),n=parseInt(n,10)||5;var u=function(u,c){for(;n;)i.push(function(n,t){return function(e){n(function(n,r){e(!n||t,{err:n,result:r})},c)}}(t,!(n-=1)));r.series(i,function(n,t){t=t[t.length-1],(u||e)(t.err,t.result)})};return e?u():u},r.waterfall=function(n,t){if(t=t||function(){},!u(n)){var e=new Error("First argument to waterfall must be an array of functions");return t(e)}if(!n.length)return t();var i=function(n){return function(e){if(e)t.apply(null,arguments),t=function(){};else{var u=Array.prototype.slice.call(arguments,1),c=n.next();c?u.push(i(c)):u.push(t),r.setImmediate(function(){n.apply(null,u)})}}};i(r.iterator(n))()};var k=function(n,t,e){if(e=e||function(){},u(t))n.map(t,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},e);else{var r={};n.each(l(t),function(n,e){t[n](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[n]=i,e(t)})},function(n){e(n,r)})}};r.parallel=function(n,t){k({map:r.map,each:r.each},n,t)},r.parallelLimit=function(n,t,e){k({map:h(t),each:f(t)},n,e)},r.series=function(n,t){if(t=t||function(){},u(n))r.mapSeries(n,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},t);else{var e={};r.eachSeries(l(n),function(t,r){n[t](function(n){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),e[t]=i,r(n)})},function(n){t(n,e)})}},r.iterator=function(n){var t=function(e){var r=function(){return n.length&&n[e].apply(null,arguments),r.next()};return r.next=function(){return e<n.length-1?t(e+1):null},r};return t(0)},r.apply=function(n){var t=Array.prototype.slice.call(arguments,1);return function(){return n.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var A=function(n,t,e,r){var i=[];n(t,function(n,t){e(n,function(n,e){i=i.concat(e||[]),t(n)})},function(n){r(n,i)})};r.concat=s(A),r.concatSeries=y(A),r.whilst=function(n,t,e){n()?t(function(i){if(i)return e(i);r.whilst(n,t,e)}):e()},r.doWhilst=function(n,t,e){n(function(i){if(i)return e(i);var u=Array.prototype.slice.call(arguments,1);t.apply(null,u)?r.doWhilst(n,t,e):e()})},r.until=function(n,t,e){n()?e():t(function(i){if(i)return e(i);r.until(n,t,e)})},r.doUntil=function(n,t,e){n(function(i){if(i)return e(i);var u=Array.prototype.slice.call(arguments,1);t.apply(null,u)?e():r.doUntil(n,t,e)})},r.queue=function(t,e){function i(n,t,e,i){if(n.started||(n.started=!0),u(t)||(t=[t]),0==t.length)return r.setImmediate(function(){n.drain&&n.drain()});c(t,function(t){var u={data:t,callback:"function"==typeof i?i:null};e?n.tasks.unshift(u):n.tasks.push(u),n.saturated&&n.tasks.length===n.concurrency&&n.saturated(),r.setImmediate(n.process)})}void 0===e&&(e=1);var o=0,a={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(n,t){i(a,n,!1,t)},kill:function(){a.drain=null,a.tasks=[]},unshift:function(n,t){i(a,n,!0,t)},process:function(){if(!a.paused&&o<a.concurrency&&a.tasks.length){var e=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),o+=1;var r=function(){o-=1,e.callback&&e.callback.apply(e,arguments),a.drain&&a.tasks.length+o===0&&a.drain(),a.process()},i=n(r);t(e.data,i)}},length:function(){return a.tasks.length},running:function(){return o},idle:function(){return a.tasks.length+o===0},pause:function(){!0!==a.paused&&(a.paused=!0)},resume:function(){if(!1!==a.paused){a.paused=!1;for(var n=1;n<=a.concurrency;n++)r.setImmediate(a.process)}}};return a},r.priorityQueue=function(n,t){function e(n,t){return n.priority-t.priority}function i(n,t,e){for(var r=-1,i=n.length-1;r<i;){var u=r+(i-r+1>>>1);e(t,n[u])>=0?r=u:i=u-1}return r}function o(n,t,o,a){if(n.started||(n.started=!0),u(t)||(t=[t]),0==t.length)return r.setImmediate(function(){n.drain&&n.drain()});c(t,function(t){var u={data:t,priority:o,callback:"function"==typeof a?a:null};n.tasks.splice(i(n.tasks,u,e)+1,0,u),n.saturated&&n.tasks.length===n.concurrency&&n.saturated(),r.setImmediate(n.process)})}var a=r.queue(n,t);return a.push=function(n,t,e){o(a,n,t,e)},delete a.unshift,a},r.cargo=function(n,t){var e=!1,i=[],a={tasks:i,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(n,e){u(n)||(n=[n]),c(n,function(n){i.push({data:n,callback:"function"==typeof e?e:null}),a.drained=!1,a.saturated&&i.length===t&&a.saturated()}),r.setImmediate(a.process)},process:function r(){if(!e){if(0===i.length)return a.drain&&!a.drained&&a.drain(),void(a.drained=!0);var u="number"==typeof t?i.splice(0,t):i.splice(0,i.length),l=o(u,function(n){return n.data});a.empty&&a.empty(),e=!0,n(l,function(){e=!1;var n=arguments;c(u,function(t){t.callback&&t.callback.apply(null,n)}),r()})}},length:function(){return i.length},running:function(){return e}};return a};var x=function(n){return function(t){var e=Array.prototype.slice.call(arguments,1);t.apply(null,e.concat([function(t){var e=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[n]&&c(e,function(t){console[n](t)}))}]))}};r.log=x("log"),r.dir=x("dir"),r.memoize=function(n,t){var e={},i={};t=t||function(n){return n};var u=function(){var u=Array.prototype.slice.call(arguments),c=u.pop(),o=t.apply(null,u);o in e?r.nextTick(function(){c.apply(null,e[o])}):o in i?i[o].push(c):(i[o]=[c],n.apply(null,u.concat([function(){e[o]=arguments;var n=i[o];delete i[o];for(var t=0,r=n.length;t<r;t++)n[t].apply(null,arguments)}])))};return u.memo=e,u.unmemoized=n,u},r.unmemoize=function(n){return function(){return(n.unmemoized||n).apply(null,arguments)}},r.times=function(n,t,e){for(var i=[],u=0;u<n;u++)i.push(u);return r.map(i,t,e)},r.timesSeries=function(n,t,e){for(var i=[],u=0;u<n;u++)i.push(u);return r.mapSeries(i,t,e)},r.seq=function(){var n=arguments;return function(){var t=this,e=Array.prototype.slice.call(arguments),i=e.pop();r.reduce(n,e,function(n,e,r){e.apply(t,n.concat([function(){var n=arguments[0],t=Array.prototype.slice.call(arguments,1);r(n,t)}]))},function(n,e){i.apply(t,[n].concat(e))})}},r.compose=function(){return r.seq.apply(null,Array.prototype.reverse.call(arguments))};var S=function(n,t){var e=function(){var e=this,r=Array.prototype.slice.call(arguments),i=r.pop();return n(t,function(n,t){n.apply(e,r.concat([t]))},i)};if(arguments.length>2){return e.apply(this,Array.prototype.slice.call(arguments,2))}return e};r.applyEach=s(S),r.applyEachSeries=y(S),r.forever=function(n,t){function e(r){if(r){if(t)return t(r);throw r}n(e)}e()},"undefined"!=typeof module&&module.exports?module.exports=r:"undefined"!=typeof define&&define.amd?define([],function(){return r}):t.async=r}();
}).call(this,require('_process'))

},{"_process":23}],2:[function(require,module,exports){
"use strict";function placeHoldersCount(o){var r=o.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===o[r-2]?2:"="===o[r-1]?1:0}function byteLength(o){return 3*o.length/4-placeHoldersCount(o)}function toByteArray(o){var r,e,t,u,n,p=o.length;u=placeHoldersCount(o),n=new Arr(3*p/4-u),e=u>0?p-4:p;var a=0;for(r=0;r<e;r+=4)t=revLookup[o.charCodeAt(r)]<<18|revLookup[o.charCodeAt(r+1)]<<12|revLookup[o.charCodeAt(r+2)]<<6|revLookup[o.charCodeAt(r+3)],n[a++]=t>>16&255,n[a++]=t>>8&255,n[a++]=255&t;return 2===u?(t=revLookup[o.charCodeAt(r)]<<2|revLookup[o.charCodeAt(r+1)]>>4,n[a++]=255&t):1===u&&(t=revLookup[o.charCodeAt(r)]<<10|revLookup[o.charCodeAt(r+1)]<<4|revLookup[o.charCodeAt(r+2)]>>2,n[a++]=t>>8&255,n[a++]=255&t),n}function tripletToBase64(o){return lookup[o>>18&63]+lookup[o>>12&63]+lookup[o>>6&63]+lookup[63&o]}function encodeChunk(o,r,e){for(var t,u=[],n=r;n<e;n+=3)t=(o[n]<<16)+(o[n+1]<<8)+o[n+2],u.push(tripletToBase64(t));return u.join("")}function fromByteArray(o){for(var r,e=o.length,t=e%3,u="",n=[],p=0,a=e-t;p<a;p+=16383)n.push(encodeChunk(o,p,p+16383>a?a:p+16383));return 1===t?(r=o[e-1],u+=lookup[r>>2],u+=lookup[r<<4&63],u+="=="):2===t&&(r=(o[e-2]<<8)+o[e-1],u+=lookup[r>>10],u+=lookup[r>>4&63],u+=lookup[r<<2&63],u+="="),n.push(u),n.join("")}exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63;
},{}],3:[function(require,module,exports){

},{}],4:[function(require,module,exports){
(function (global){
"use strict";function typedArraySupport(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=Buffer.prototype):(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,e,r)}function from(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?fromArrayBuffer(t,e,r,n):"string"==typeof e?fromString(t,e,r):fromObject(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function alloc(t,e,r,n){return assertSize(e),e<=0?createBuffer(t,e):void 0!==r?"string"==typeof n?createBuffer(t,e).fill(r,n):createBuffer(t,e).fill(r):createBuffer(t,e)}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function fromString(t,e,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|byteLength(e,r);t=createBuffer(t,n);var f=t.write(e,r);return f!==n&&(t=t.slice(0,f)),t}function fromArrayLike(t,e){var r=e.length<0?0:0|checked(e.length);t=createBuffer(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function fromArrayBuffer(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),Buffer.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=Buffer.prototype):t=fromArrayLike(t,e),t}function fromObject(t,e){if(Buffer.isBuffer(e)){var r=0|checked(e.length);return t=createBuffer(t,r),0===t.length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||isnan(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&isArray(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function SlowBuffer(t){return+t!=t&&(t=0),Buffer.alloc(+t)}function byteLength(t,e){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(t).length;default:if(n)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),n=!0}}function slowToString(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,e>>>=0,r<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,e,r);case"utf8":case"utf-8":return utf8Slice(this,e,r);case"ascii":return asciiSlice(this,e,r);case"latin1":case"binary":return latin1Slice(this,e,r);case"base64":return base64Slice(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function swap(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function bidirectionalIndexOf(t,e,r,n,f){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=f?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(f)return-1;r=t.length-1}else if(r<0){if(!f)return-1;r=0}if("string"==typeof e&&(e=Buffer.from(e,n)),Buffer.isBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,r,n,f);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?f?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):arrayIndexOf(t,[e],r,n,f);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,r,n,f){function i(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}var o=1,u=t.length,s=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,u/=2,s/=2,r/=2}var a;if(f){var h=-1;for(a=r;a<u;a++)if(i(t,a)===i(e,-1===h?0:a-h)){if(-1===h&&(h=a),a-h+1===s)return h*o}else-1!==h&&(a-=a-h),h=-1}else for(r+s>u&&(r=u-s),a=r;a>=0;a--){for(var c=!0,l=0;l<s;l++)if(i(t,a+l)!==i(e,l)){c=!1;break}if(c)return a}return-1}function hexWrite(t,e,r,n){r=Number(r)||0;var f=t.length-r;n?(n=Number(n))>f&&(n=f):n=f;var i=e.length;if(i%2!=0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var o=0;o<n;++o){var u=parseInt(e.substr(2*o,2),16);if(isNaN(u))return o;t[r+o]=u}return o}function utf8Write(t,e,r,n){return blitBuffer(utf8ToBytes(e,t.length-r),t,r,n)}function asciiWrite(t,e,r,n){return blitBuffer(asciiToBytes(e),t,r,n)}function latin1Write(t,e,r,n){return asciiWrite(t,e,r,n)}function base64Write(t,e,r,n){return blitBuffer(base64ToBytes(e),t,r,n)}function ucs2Write(t,e,r,n){return blitBuffer(utf16leToBytes(e,t.length-r),t,r,n)}function base64Slice(t,e,r){return 0===e&&r===t.length?base64.fromByteArray(t):base64.fromByteArray(t.slice(e,r))}function utf8Slice(t,e,r){r=Math.min(t.length,r);for(var n=[],f=e;f<r;){var i=t[f],o=null,u=i>239?4:i>223?3:i>191?2:1;if(f+u<=r){var s,a,h,c;switch(u){case 1:i<128&&(o=i);break;case 2:s=t[f+1],128==(192&s)&&(c=(31&i)<<6|63&s)>127&&(o=c);break;case 3:s=t[f+1],a=t[f+2],128==(192&s)&&128==(192&a)&&(c=(15&i)<<12|(63&s)<<6|63&a)>2047&&(c<55296||c>57343)&&(o=c);break;case 4:s=t[f+1],a=t[f+2],h=t[f+3],128==(192&s)&&128==(192&a)&&128==(192&h)&&(c=(15&i)<<18|(63&s)<<12|(63&a)<<6|63&h)>65535&&c<1114112&&(o=c)}}null===o?(o=65533,u=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),f+=u}return decodeCodePointsArray(n)}function decodeCodePointsArray(t){var e=t.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(t,e,r){var n="";r=Math.min(t.length,r);for(var f=e;f<r;++f)n+=String.fromCharCode(127&t[f]);return n}function latin1Slice(t,e,r){var n="";r=Math.min(t.length,r);for(var f=e;f<r;++f)n+=String.fromCharCode(t[f]);return n}function hexSlice(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var f="",i=e;i<r;++i)f+=toHex(t[i]);return f}function utf16leSlice(t,e,r){for(var n=t.slice(e,r),f="",i=0;i<n.length;i+=2)f+=String.fromCharCode(n[i]+256*n[i+1]);return f}function checkOffset(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,r,n,f,i){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>f||e<i)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,r,n){e<0&&(e=65535+e+1);for(var f=0,i=Math.min(t.length-r,2);f<i;++f)t[r+f]=(e&255<<8*(n?f:1-f))>>>8*(n?f:1-f)}function objectWriteUInt32(t,e,r,n){e<0&&(e=4294967295+e+1);for(var f=0,i=Math.min(t.length-r,4);f<i;++f)t[r+f]=e>>>8*(n?f:3-f)&255}function checkIEEE754(t,e,r,n,f,i){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(t,e,r,n,f){return f||checkIEEE754(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(t,e,r,n,23,4),r+4}function writeDouble(t,e,r,n,f){return f||checkIEEE754(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(t,e,r,n,52,8),r+8}function base64clean(t){if(t=stringtrim(t).replace(INVALID_BASE64_RE,""),t.length<2)return"";for(;t.length%4!=0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){e=e||1/0;for(var r,n=t.length,f=null,i=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!f){if(r>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&i.push(239,191,189);continue}f=r;continue}if(r<56320){(e-=3)>-1&&i.push(239,191,189),f=r;continue}r=65536+(f-55296<<10|r-56320)}else f&&(e-=3)>-1&&i.push(239,191,189);if(f=null,r<128){if((e-=1)<0)break;i.push(r)}else if(r<2048){if((e-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function asciiToBytes(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function utf16leToBytes(t,e){for(var r,n,f,i=[],o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),n=r>>8,f=r%256,i.push(f),i.push(n);return i}function base64ToBytes(t){return base64.toByteArray(base64clean(t))}function blitBuffer(t,e,r,n){for(var f=0;f<n&&!(f+r>=e.length||f>=t.length);++f)e[f+r]=t[f];return f}function isnan(t){return t!==t}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("isarray");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,r){return from(null,t,e,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,e,r){return alloc(null,t,e,r)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=function(t){return!(null==t||!t._isBuffer)},Buffer.compare=function(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,f=0,i=Math.min(r,n);f<i;++f)if(t[f]!==e[f]){r=t[f],n=e[f];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,e){if(!isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=Buffer.allocUnsafe(e),f=0;for(r=0;r<t.length;++r){var i=t[r];if(!Buffer.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,f),f+=i.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",e=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t,e,r,n,f){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===f&&(f=this.length),e<0||r>t.length||n<0||f>this.length)throw new RangeError("out of range index");if(n>=f&&e>=r)return 0;if(n>=f)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,f>>>=0,this===t)return 0;for(var i=f-n,o=r-e,u=Math.min(i,o),s=this.slice(n,f),a=t.slice(e,r),h=0;h<u;++h)if(s[h]!==a[h]){i=s[h],o=a[h];break}return i<o?-1:o<i?1:0},Buffer.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},Buffer.prototype.indexOf=function(t,e,r){return bidirectionalIndexOf(this,t,e,r,!0)},Buffer.prototype.lastIndexOf=function(t,e,r){return bidirectionalIndexOf(this,t,e,r,!1)},Buffer.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var f=this.length-e;if((void 0===r||r>f)&&(r=f),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return hexWrite(this,t,e,r);case"utf8":case"utf-8":return utf8Write(this,t,e,r);case"ascii":return asciiWrite(this,t,e,r);case"latin1":case"binary":return latin1Write(this,t,e,r);case"base64":return base64Write(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n;if(Buffer.TYPED_ARRAY_SUPPORT)n=this.subarray(t,e),n.__proto__=Buffer.prototype;else{var f=e-t;n=new Buffer(f,void 0);for(var i=0;i<f;++i)n[i]=this[i+t]}return n},Buffer.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t],f=1,i=0;++i<e&&(f*=256);)n+=this[t+i]*f;return n},Buffer.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t+--e],f=1;e>0&&(f*=256);)n+=this[t+--e]*f;return n},Buffer.prototype.readUInt8=function(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t],f=1,i=0;++i<e&&(f*=256);)n+=this[t+i]*f;return f*=128,n>=f&&(n-=Math.pow(2,8*e)),n},Buffer.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=e,f=1,i=this[t+--n];n>0&&(f*=256);)i+=this[t+--n]*f;return f*=128,i>=f&&(i-=Math.pow(2,8*e)),i},Buffer.prototype.readInt8=function(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,e){return e||checkOffset(t,4,this.length),ieee754.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,e){return e||checkOffset(t,4,this.length),ieee754.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,e){return e||checkOffset(t,8,this.length),ieee754.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,e){return e||checkOffset(t,8,this.length),ieee754.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e|=0,r|=0,!n){checkInt(this,t,e,r,Math.pow(2,8*r)-1,0)}var f=1,i=0;for(this[e]=255&t;++i<r&&(f*=256);)this[e+i]=t/f&255;return e+r},Buffer.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e|=0,r|=0,!n){checkInt(this,t,e,r,Math.pow(2,8*r)-1,0)}var f=r-1,i=1;for(this[e+f]=255&t;--f>=0&&(i*=256);)this[e+f]=t/i&255;return e+r},Buffer.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var f=Math.pow(2,8*r-1);checkInt(this,t,e,r,f-1,-f)}var i=0,o=1,u=0;for(this[e]=255&t;++i<r&&(o*=256);)t<0&&0===u&&0!==this[e+i-1]&&(u=1),this[e+i]=(t/o>>0)-u&255;return e+r},Buffer.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var f=Math.pow(2,8*r-1);checkInt(this,t,e,r,f-1,-f)}var i=r-1,o=1,u=0;for(this[e+i]=255&t;--i>=0&&(o*=256);)t<0&&0===u&&0!==this[e+i+1]&&(u=1),this[e+i]=(t/o>>0)-u&255;return e+r},Buffer.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function(t,e,r){return writeFloat(this,t,e,!0,r)},Buffer.prototype.writeFloatBE=function(t,e,r){return writeFloat(this,t,e,!1,r)},Buffer.prototype.writeDoubleLE=function(t,e,r){return writeDouble(this,t,e,!0,r)},Buffer.prototype.writeDoubleBE=function(t,e,r){return writeDouble(this,t,e,!1,r)},Buffer.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var f,i=n-r;if(this===t&&r<e&&e<n)for(f=i-1;f>=0;--f)t[f+e]=this[f+r];else if(i<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(f=0;f<i;++f)t[f+e]=this[f+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+i),e);return i},Buffer.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var f=t.charCodeAt(0);f<256&&(t=f)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0);var i;if("number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{var o=Buffer.isBuffer(t)?t:utf8ToBytes(new Buffer(t,n).toString()),u=o.length;for(i=0;i<r-e;++i)this[i+e]=o[i%u]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"base64-js":2,"ieee754":8,"isarray":11}],5:[function(require,module,exports){
(function (Buffer){
function isArray(r){return Array.isArray?Array.isArray(r):"[object Array]"===objectToString(r)}function isBoolean(r){return"boolean"==typeof r}function isNull(r){return null===r}function isNullOrUndefined(r){return null==r}function isNumber(r){return"number"==typeof r}function isString(r){return"string"==typeof r}function isSymbol(r){return"symbol"==typeof r}function isUndefined(r){return void 0===r}function isRegExp(r){return"[object RegExp]"===objectToString(r)}function isObject(r){return"object"==typeof r&&null!==r}function isDate(r){return"[object Date]"===objectToString(r)}function isError(r){return"[object Error]"===objectToString(r)||r instanceof Error}function isFunction(r){return"function"==typeof r}function isPrimitive(r){return null===r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||"symbol"==typeof r||void 0===r}function objectToString(r){return Object.prototype.toString.call(r)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=Buffer.isBuffer;
}).call(this,{"isBuffer":require("../../is-buffer/index.js")})

},{"../../is-buffer/index.js":10}],6:[function(require,module,exports){
(function (process,global){
(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){return"object"==typeof t&&null!==t}function r(t){D=t}function o(t){U=t}function i(){return function(){F(s)}}function u(){return function(){setTimeout(s,1)}}function s(){for(var t=0;t<N;t+=2){(0,H[t])(H[t+1]),H[t]=void 0,H[t+1]=void 0}N=0}function c(){}function a(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function l(t){try{return t.then}catch(t){return V.error=t,V}}function p(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function _(t,e,n){U(function(t){var r=!1,o=p(n,e,function(n){r||(r=!0,e!==n?v(t,n):m(t,n))},function(e){r||(r=!0,b(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,b(t,o))},t)}function h(t,e){e._state===Q?m(t,e._result):e._state===R?b(t,e._result):w(e,void 0,function(e){v(t,e)},function(e){b(t,e)})}function d(t,n){if(n.constructor===t.constructor)h(t,n);else{var r=l(n);r===V?b(t,V.error):void 0===r?m(t,n):e(r)?_(t,n,r):m(t,n)}}function v(e,n){e===n?b(e,a()):t(n)?d(e,n):m(e,n)}function y(t){t._onerror&&t._onerror(t._result),g(t)}function m(t,e){t._state===J&&(t._result=e,t._state=Q,0!==t._subscribers.length&&U(g,t))}function b(t,e){t._state===J&&(t._state=R,t._result=e,U(y,t))}function w(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+Q]=n,o[i+R]=r,0===i&&t._state&&U(g,t)}function g(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,u=0;u<e.length;u+=3)r=e[u],o=e[u+n],r?j(n,r,o,i):o(i);t._subscribers.length=0}}function A(){this.error=null}function E(t,e){try{return t(e)}catch(t){return X.error=t,X}}function j(t,n,r,o){var i,u,s,c,a=e(r);if(a){if(i=E(r,o),i===X?(c=!0,u=i.error,i=null):s=!0,n===i)return void b(n,f())}else i=o,s=!0;n._state!==J||(a&&s?v(n,i):c?b(n,u):t===Q?m(n,i):t===R&&b(n,i))}function S(t,e){try{e(function(e){v(t,e)},function(e){b(t,e)})}catch(e){b(t,e)}}function T(t,e){var n=this;n._instanceConstructor=t,n.promise=new t(c),n._validateInput(e)?(n._input=e,n.length=e.length,n._remaining=e.length,n._init(),0===n.length?m(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&m(n.promise,n._result))):b(n.promise,n._validationError())}function P(t){return new Z(this,t).promise}function x(t){function e(t){v(o,t)}function n(t){b(o,t)}var r=this,o=new r(c);if(!L(t))return b(o,new TypeError("You must pass an array to race.")),o;for(var i=t.length,u=0;o._state===J&&u<i;u++)w(r.resolve(t[u]),void 0,e,n);return o}function C(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(c);return v(n,t),n}function M(t){var e=this,n=new e(c);return b(n,t),n}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function k(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function I(t){this._id=ot++,this._state=void 0,this._result=void 0,this._subscribers=[],c!==t&&(e(t)||O(),this instanceof I||k(),S(this,t))}function Y(){var t;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;e&&"[object Promise]"===Object.prototype.toString.call(e.resolve())&&!e.cast||(t.Promise=it)}var q;q=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var F,D,K,L=q,N=0,U=function(t,e){H[N]=t,H[N+1]=e,2===(N+=2)&&(D?D(s):K())},W="undefined"!=typeof window?window:void 0,$=W||{},z=$.MutationObserver||$.WebKitMutationObserver,B="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),G="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,H=new Array(1e3);K=B?function(){var t=process.nextTick,e=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(e)&&"0"===e[1]&&"10"===e[2]&&(t=setImmediate),function(){t(s)}}():z?function(){var t=0,e=new z(s),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():G?function(){var t=new MessageChannel;return t.port1.onmessage=s,function(){t.port2.postMessage(0)}}():void 0===W&&"function"==typeof require?function(){try{var t=require,e=t("vertx");return F=e.runOnLoop||e.runOnContext,i()}catch(t){return u()}}():u();var J=void 0,Q=1,R=2,V=new A,X=new A;T.prototype._validateInput=function(t){return L(t)},T.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},T.prototype._init=function(){this._result=new Array(this.length)};var Z=T;T.prototype._enumerate=function(){for(var t=this,e=t.length,n=t.promise,r=t._input,o=0;n._state===J&&o<e;o++)t._eachEntry(r[o],o)},T.prototype._eachEntry=function(t,e){var r=this,o=r._instanceConstructor;n(t)?t.constructor===o&&t._state!==J?(t._onerror=null,r._settledAt(t._state,e,t._result)):r._willSettleAt(o.resolve(t),e):(r._remaining--,r._result[e]=t)},T.prototype._settledAt=function(t,e,n){var r=this,o=r.promise;o._state===J&&(r._remaining--,t===R?b(o,n):r._result[e]=n),0===r._remaining&&m(o,r._result)},T.prototype._willSettleAt=function(t,e){var n=this;w(t,void 0,function(t){n._settledAt(Q,e,t)},function(t){n._settledAt(R,e,t)})};var tt=P,et=x,nt=C,rt=M,ot=0,it=I;I.all=tt,I.race=et,I.resolve=nt,I.reject=rt,I._setScheduler=r,I._setAsap=o,I._asap=U,I.prototype={constructor:I,then:function(t,e){var n=this,r=n._state;if(r===Q&&!t||r===R&&!e)return this;var o=new this.constructor(c),i=n._result;if(r){var u=arguments[r-1];U(function(){j(r,o,u,i)})}else w(n,o,t,e);return o},catch:function(t){return this.then(null,t)}};var ut=Y,st={Promise:it,polyfill:ut};"function"==typeof define&&define.amd?define(function(){return st}):"undefined"!=typeof module&&module.exports?module.exports=st:void 0!==this&&(this.ES6Promise=st),ut()}).call(this);
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"_process":23}],7:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,i,n,s,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(i=this._events[e],isUndefined(i))return!1;if(isFunction(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(isObject(i))for(s=Array.prototype.slice.call(arguments,1),o=i.slice(),n=o.length,r=0;r<n;r++)o[r].apply(this,s);return!0},EventEmitter.prototype.addListener=function(e,t){var i;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(i=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},EventEmitter.prototype.removeListener=function(e,t){var i,n,s,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,n=-1,i===t||isFunction(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(i)){for(r=s;r-- >0;)if(i[r]===t||i[r].listener&&i[r].listener===t){n=r;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],isFunction(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){return this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)};
},{}],8:[function(require,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),o+=p+N>=1?n/f:n*Math.pow(2,1-N),o*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],9:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],10:[function(require,module,exports){
function isBuffer(f){return!!f.constructor&&"function"==typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}function isSlowBuffer(f){return"function"==typeof f.readFloatLE&&"function"==typeof f.slice&&isBuffer(f.slice(0,0))}module.exports=function(f){return null!=f&&(isBuffer(f)||isSlowBuffer(f)||!!f._isBuffer)};
},{}],11:[function(require,module,exports){
var toString={}.toString;module.exports=Array.isArray||function(r){return"[object Array]"==toString.call(r)};
},{}],12:[function(require,module,exports){
arguments[4][3][0].apply(exports,arguments)
},{"dup":3}],13:[function(require,module,exports){
(function (process,global,__dirname){
!function(){var e="undefined"!=typeof process&&process.versions&&process.versions.node,t=!e&&("undefined"!=typeof window||"undefined"!=typeof self);t&&"undefined"==typeof global&&("undefined"!=typeof window?global=window:"undefined"!=typeof self?global=self:"undefined"!=typeof $&&(global=$));var n=function(n){function r(){}function a(e){for(var t=[],n=Object.keys(e).sort(),r=0;r<n.length;++r){var a=n[r],o=e[a];A(o)||(o=[o]);for(var i=0;i<o.length;++i){var l=o[i];if(null!==l){if(!J(l))throw new Oe("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{code:"invalid language map value",languageMap:e});t.push({"@value":l,"@language":a.toLowerCase()})}}}return t}function o(e,t){if(A(t))for(var n=0;n<t.length;++n)t[n]=o(e,t[n]);else if(X(t))t["@list"]=o(e,t["@list"]);else if(T(t)){G(t)&&(t["@id"]=e.getId(t["@id"]));for(var r=Object.keys(t).sort(),a=0;a<r.length;++a){var i=r[a];"@id"!==i&&(t[i]=o(e,t[i]))}}return t}function i(e,t,r){if(null===r||void 0===r)return null;var a=D(e,t,{vocab:!0});if("@id"===a)return D(e,r,{base:!0});if("@type"===a)return D(e,r,{vocab:!0,base:!0});var o=n.getContextValue(e,t,"@type");if("@id"===o||"@graph"===a&&J(r))return{"@id":D(e,r,{base:!0})};if("@vocab"===o)return{"@id":D(e,r,{vocab:!0,base:!0})};if(_(a))return r;var i={};if(null!==o)i["@type"]=o;else if(J(r)){var l=n.getContextValue(e,t,"@language");null!==l&&(i["@language"]=l)}return-1===["boolean","number","string"].indexOf(typeof r)&&(r=r.toString()),i["@value"]=r,i}function l(e,t,n){for(var r=[],a=Object.keys(e).sort(),o=0;o<a.length;++o)for(var i=a[o],l=e[i],c=Object.keys(l).sort(),d=0;d<c.length;++d){var f=c[d],p=l[f];if("@type"===f)f=xe;else if(_(f))continue;for(var h=0;h<p.length;++h){var v=p[h],g={};if(g.type=0===i.indexOf("_:")?"blank node":"IRI",g.value=i,$(i)){var y={};if(y.type=0===f.indexOf("_:")?"blank node":"IRI",y.value=f,$(f)&&("blank node"!==y.type||n.produceGeneralizedRdf))if(X(v))u(v["@list"],t,g,y,r);else{var m=s(v);m&&r.push({subject:g,predicate:y,object:m})}}}}return r}function u(e,t,n,r,a){for(var o={type:"IRI",value:ge},i={type:"IRI",value:ye},l={type:"IRI",value:me},u=0;u<e.length;++u){var c=e[u],d={type:"blank node",value:t.getId()};a.push({subject:n,predicate:r,object:d}),n=d,r=o;var f=s(c);f&&a.push({subject:n,predicate:r,object:f}),r=i}a.push({subject:n,predicate:r,object:l})}function s(e){var t={};if(Q(e)){t.type="literal";var n=e["@value"],r=e["@type"]||null;V(n)?(t.value=n.toString(),t.datatype=r||de):F(n)||r===fe?(F(n)||(n=parseFloat(n)),t.value=n.toExponential(15).replace(/(\d)0*e\+?/,"$1E"),t.datatype=r||fe):P(n)?(t.value=n.toFixed(0),t.datatype=r||pe):"@language"in e?(t.value=n,t.datatype=r||ke,t.language=e["@language"]):(t.value=n,t.datatype=r||he)}else{var a=T(e)?e["@id"]:e;t.type=0===a.indexOf("_:")?"blank node":"IRI",t.value=a}return"IRI"!==t.type||$(t.value)?t:null}function c(e,t){if("IRI"===e.type||"blank node"===e.type)return{"@id":e.value};var n={"@value":e.value};if(e.language)n["@language"]=e.language;else{var r=e.datatype;if(r||(r=he),t){if(r===de)"true"===n["@value"]?n["@value"]=!0:"false"===n["@value"]&&(n["@value"]=!1);else if(B(n["@value"]))if(r===pe){var a=parseInt(n["@value"],10);a.toFixed(0)===n["@value"]&&(n["@value"]=a)}else r===fe&&(n["@value"]=parseFloat(n["@value"]));-1===[de,pe,fe,he].indexOf(r)&&(n["@type"]=r)}else r!==he&&(n["@type"]=r)}return n}function d(e,t){for(var n=["subject","predicate","object"],r=0;r<n.length;++r){var a=n[r];if(e[a].type!==t[a].type||e[a].value!==t[a].value)return!1}return e.object.language===t.object.language&&e.object.datatype===t.object.datatype}function f(e,t,r,a,o,i){if(A(e))for(var l=0;l<e.length;++l)f(e[l],t,r,a,void 0,i);else{if(!T(e))return void(i&&i.push(e));if(Q(e)){if("@type"in e){var u=e["@type"];0===u.indexOf("_:")&&(e["@type"]=u=a.getId(u))}return void(i&&i.push(e))}if("@type"in e)for(var s=e["@type"],l=0;l<s.length;++l){var u=s[l];0===u.indexOf("_:")&&a.getId(u)}M(o)&&(o=G(e)?a.getId(e["@id"]):e["@id"]),i&&i.push({"@id":o});var c=t[r],d=c[o]=c[o]||{};d["@id"]=o;for(var p=Object.keys(e).sort(),h=0;h<p.length;++h){var v=p[h];if("@id"!==v)if("@reverse"!==v)if("@graph"!==v)if("@type"!==v&&_(v)){if("@index"===v&&v in d&&(e[v]!==d[v]||e[v]["@id"]!==d[v]["@id"]))throw new Oe("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{code:"conflicting indexes",subject:d});d[v]=e[v]}else{var g=e[v];if(0===v.indexOf("_:")&&(v=a.getId(v)),0!==g.length)for(var y=0;y<g.length;++y){var m=g[y];if("@type"===v&&(m=0===m.indexOf("_:")?a.getId(m):m),z(m)||H(m)){var x=G(m)?a.getId(m["@id"]):m["@id"];n.addValue(d,v,{"@id":x},{propertyIsArray:!0,allowDuplicate:!1}),f(m,t,r,a,x)}else if(X(m)){var b=[];f(m["@list"],t,r,a,o,b),m={"@list":b},n.addValue(d,v,m,{propertyIsArray:!0,allowDuplicate:!1})}else f(m,t,r,a,o),n.addValue(d,v,m,{propertyIsArray:!0,allowDuplicate:!1})}else n.addValue(d,v,[],{propertyIsArray:!0})}else{o in t||(t[o]={});var w="@merged"===r?r:o;f(e[v],t,w,a)}else{var j={"@id":o},k=e["@reverse"];for(var I in k)for(var L=k[I],O=0;O<L.length;++O){var E=L[O],S=E["@id"];G(E)&&(S=a.getId(S)),f(E,t,r,a,S),n.addValue(c[S],I,j,{propertyIsArray:!0,allowDuplicate:!1})}}}}}function p(e){for(var t=e["@default"],n=Object.keys(e).sort(),r=0;r<n.length;++r){var a=n[r];if("@default"!==a){var o=e[a],i=t[a];i?"@graph"in i||(i["@graph"]=[]):t[a]=i={"@id":a,"@graph":[]};for(var l=i["@graph"],u=Object.keys(o).sort(),s=0;s<u.length;++s){var c=o[u[s]];H(c)||l.push(c)}}}return t}function h(e,t,n,r,a){m(n),n=n[0];for(var o=e.options,i={embed:y(n,o,"embed"),explicit:y(n,o,"explicit"),requireAll:y(n,o,"requireAll")},l=x(e,t,n,i),u=Object.keys(l).sort(),s=0;s<u.length;++s){var c=u[s],d=l[c];if("@link"===i.embed&&c in e.link)j(r,a,e.link[c]);else{null===a&&(e.uniqueEmbeds={});var f={};if(f["@id"]=c,e.link[c]=f,"@never"===i.embed||g(d,e.subjectStack))j(r,a,f);else{"@last"===i.embed&&(c in e.uniqueEmbeds&&w(e,c),e.uniqueEmbeds[c]={parent:r,property:a}),e.subjectStack.push(d);for(var p=Object.keys(d).sort(),b=0;b<p.length;b++){var k=p[b];if(_(k))f[k]=W(d[k]);else if(!i.explicit||k in n)for(var I=d[k],L=0;L<I.length;++L){var O=I[L];if(X(O)){var E={"@list":[]};j(f,k,E);var S=O["@list"];for(var D in S)if(O=S[D],H(O)){var N=k in n?n[k][0]["@list"]:v(i);h(e,[O["@id"]],N,E,"@list")}else j(E,"@list",W(O))}else if(H(O)){var N=k in n?n[k]:v(i);h(e,[O["@id"]],N,f,k)}else j(f,k,W(O))}}for(var p=Object.keys(n).sort(),b=0;b<p.length;++b){var k=p[b];if(!_(k)){var C=n[k][0];if(!(y(C,o,"omitDefault")||k in f)){var R="@null";"@default"in C&&(R=W(C["@default"])),A(R)||(R=[R]),f[k]=[{"@preserve":R}]}}}j(r,a,f),e.subjectStack.pop()}}}}function v(e){var t={};for(var n in e)void 0!==e[n]&&(t["@"+n]=[e[n]]);return[t]}function g(e,t){for(var n=t.length-1;n>=0;--n)if(t[n]["@id"]===e["@id"])return!0;return!1}function y(e,t,n){var r="@"+n,a=r in e?e[r][0]:t[n];return"embed"===n&&(!0===a?a="@last":!1===a?a="@never":"@always"!==a&&"@never"!==a&&"@link"!==a&&(a="@last")),a}function m(e){if(!A(e)||1!==e.length||!T(e[0]))throw new Oe("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:e})}function x(e,t,n,r){for(var a={},o=0;o<t.length;++o){var i=t[o],l=e.subjects[i];b(l,n,r)&&(a[i]=l)}return a}function b(e,t,r){if("@type"in t&&(1!==t["@type"].length||!T(t["@type"][0]))){for(var a=t["@type"],o=0;o<a.length;++o)if(n.hasValue(e,"@type",a[o]))return!0;return!1}var i=!0,l=!1;for(var u in t){if(_(u)){if("@id"!==u&&"@type"!==u)continue;if(i=!1,"@id"===u&&J(t[u])){if(e[u]!==t[u])return!1;l=!0;continue}}if(i=!1,u in e){if(A(t[u])&&0===t[u].length&&void 0!==e[u])return!1;l=!0}else{var s=A(t[u])&&T(t[u][0])&&"@default"in t[u][0];if(r.requireAll&&!s)return!1}}return i||l}function w(e,t){var r=e.uniqueEmbeds,a=r[t],o=a.parent,i=a.property,l={"@id":t};if(A(o)){for(var u=0;u<o.length;++u)if(n.compareValues(o[u],l)){o[u]=l;break}}else{var s=A(o[i]);n.removeValue(o,i,l,{propertyIsArray:s}),n.addValue(o,i,l,{propertyIsArray:s})}var c=function(e){for(var t=Object.keys(r),n=0;n<t.length;++n){var a=t[n];a in r&&T(r[a].parent)&&r[a].parent["@id"]===e&&(delete r[a],c(a))}};c(t)}function j(e,t,r){T(e)?n.addValue(e,t,r,{propertyIsArray:!0}):e.push(r)}function k(e,t,r){if(A(t)){for(var a=[],o=0;o<t.length;++o){var i=k(e,t[o],r);null!==i&&a.push(i)}t=a}else if(T(t)){if("@preserve"in t)return"@null"===t["@preserve"]?null:t["@preserve"];if(Q(t))return t;if(X(t))return t["@list"]=k(e,t["@list"],r),t;var l=O(e,"@id");if(l in t){var u=t[l];if(u in r.link){var s=r.link[u].indexOf(t);if(-1!==s)return r.link[u][s];r.link[u].push(t)}else r.link[u]=[t]}for(var c in t){var i=k(e,t[c],r),d=n.getContextValue(e,c,"@container");r.compactArrays&&A(i)&&1===i.length&&null===d&&(i=i[0]),t[c]=i}}return t}function I(e,t){return e.length<t.length?-1:t.length<e.length?1:e===t?0:e<t?-1:1}function L(e,t,n,r,a,o){null===o&&(o="@null");var i=[];if("@id"!==o&&"@reverse"!==o||!H(n))i.push(o);else{"@reverse"===o&&i.push("@reverse");var l=O(e,n["@id"],null,{vocab:!0});l in e.mappings&&e.mappings[l]&&e.mappings[l]["@id"]===n["@id"]?i.push.apply(i,["@vocab","@id"]):i.push.apply(i,["@id","@vocab"])}i.push("@none");for(var u=e.inverse[t],s=0;s<r.length;++s){var c=r[s];if(c in u)for(var d=u[c][a],f=0;f<i.length;++f){var p=i[f];if(p in d)return d[p]}}return null}function O(e,t,n,r,a){if(null===t)return t;M(n)&&(n=null),M(a)&&(a=!1),r=r||{};var o=e.getInverse();if(_(t))return t in o?o[t]["@none"]["@type"]["@none"]:t;if(r.vocab&&t in o){var i=e["@language"]||"@none",l=[];T(n)&&"@index"in n&&l.push("@index");var u="@language",s="@null";if(a)u="@type",s="@reverse",l.push("@set");else if(X(n)){"@index"in n||l.push("@list");for(var c=n["@list"],d=0===c.length?i:null,f=null,p=0;p<c.length;++p){var h=c[p],v="@none",g="@none";if(Q(h)?"@language"in h?v=h["@language"]:"@type"in h?g=h["@type"]:v="@null":g="@id",null===d?d=v:v!==d&&Q(h)&&(d="@none"),null===f?f=g:g!==f&&(f="@none"),"@none"===d&&"@none"===f)break}d=d||"@none",f=f||"@none","@none"!==f?(u="@type",s=f):s=d}else Q(n)?"@language"in n&&!("@index"in n)?(l.push("@language"),s=n["@language"]):"@type"in n&&(u="@type",s=n["@type"]):(u="@type",s="@id"),l.push("@set");l.push("@none");var y=L(e,t,n,l,u,s);if(null!==y)return y}if(r.vocab&&"@vocab"in e){var m=e["@vocab"];if(0===t.indexOf(m)&&t!==m){var x=t.substr(m.length);if(!(x in e.mappings))return x}}for(var b=null,w=0,j=[],k=e.fastCurieMap,O=t.length-1;w<O&&t[w]in k;++w)""in(k=k[t[w]])&&j.push(k[""][0]);for(var p=j.length-1;p>=0;--p)for(var E=j[p],S=E.terms,D=0;D<S.length;++D){var N=S[D]+":"+t.substr(E.iri.length),R=!(N in e.mappings)||null===n&&e.mappings[N]["@id"]===t;R&&(null===b||I(N,b)<0)&&(b=N)}return null!==b?b:r.vocab?t:C(e["@base"],t)}function E(e,t,r){if(Q(r)){var a=n.getContextValue(e,t,"@type"),o=n.getContextValue(e,t,"@language"),i=n.getContextValue(e,t,"@container"),l="@index"in r&&"@index"!==i;if(!l&&(r["@type"]===a||r["@language"]===o))return r["@value"];var u=Object.keys(r).length,s=1===u||2===u&&"@index"in r&&!l,c="@language"in e,d=J(r["@value"]),f=e.mappings[t]&&null===e.mappings[t]["@language"];if(s&&(!c||!d||f))return r["@value"];var p={};return l&&(p[O(e,"@index")]=r["@index"]),"@type"in r?p[O(e,"@type")]=O(e,r["@type"],null,{vocab:!0}):"@language"in r&&(p[O(e,"@language")]=r["@language"]),p[O(e,"@value")]=r["@value"],p}var h=D(e,t,{vocab:!0}),a=n.getContextValue(e,t,"@type"),v=O(e,r["@id"],null,{vocab:"@vocab"===a});if("@id"===a||"@vocab"===a||"@graph"===h)return v;var p={};return p[O(e,"@id")]=v,p}function S(e,t,n,r){if(n in r){if(r[n])return;throw new Oe("Cyclical context definition detected.","jsonld.CyclicalContext",{code:"cyclic IRI mapping",context:t,term:n})}if(r[n]=!1,_(n))throw new Oe("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:t,term:n});if(""===n)throw new Oe("Invalid JSON-LD syntax; a term cannot be an empty string.","jsonld.SyntaxError",{code:"invalid term definition",context:t});e.mappings[n]&&delete e.mappings[n];var a=t[n];if(null===a||T(a)&&null===a["@id"])return e.mappings[n]=null,void(r[n]=!0);if(J(a)&&(a={"@id":a}),!T(a))throw new Oe("Invalid JSON-LD syntax; @context property values must be strings or objects.","jsonld.SyntaxError",{code:"invalid term definition",context:t});var o=e.mappings[n]={};if(o.reverse=!1,"@reverse"in a){if("@id"in a)throw new Oe("Invalid JSON-LD syntax; a @reverse term definition must not contain @id.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});var i=a["@reverse"];if(!J(i))throw new Oe("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});var l=D(e,i,{vocab:!0,base:!1},t,r);if(!$(l))throw new Oe("Invalid JSON-LD syntax; a @context @reverse value must be an absolute IRI or a blank node identifier.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});o["@id"]=l,o.reverse=!0}else if("@id"in a){var l=a["@id"];if(!J(l))throw new Oe("Invalid JSON-LD syntax; a @context @id value must be an array of strings or a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});if(l!==n){if(l=D(e,l,{vocab:!0,base:!1},t,r),!$(l)&&!_(l))throw new Oe("Invalid JSON-LD syntax; a @context @id value must be an absolute IRI, a blank node identifier, or a keyword.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});o["@id"]=l}}var u=n.indexOf(":");if(o._termHasColon=-1!==u,!("@id"in o))if(o._termHasColon){var s=n.substr(0,u);if(s in t&&S(e,t,s,r),e.mappings[s]){var c=n.substr(u+1);o["@id"]=e.mappings[s]["@id"]+c}else o["@id"]=n}else{if(!("@vocab"in e))throw new Oe("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t,term:n});o["@id"]=e["@vocab"]+n}if(r[n]=!0,"@type"in a){var d=a["@type"];if(!J(d))throw new Oe("Invalid JSON-LD syntax; an @context @type values must be a string.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if("@id"!==d&&"@vocab"!==d){if(d=D(e,d,{vocab:!0,base:!1},t,r),!$(d))throw new Oe("Invalid JSON-LD syntax; an @context @type value must be an absolute IRI.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if(0===d.indexOf("_:"))throw new Oe("Invalid JSON-LD syntax; an @context @type values must be an IRI, not a blank node identifier.","jsonld.SyntaxError",{code:"invalid type mapping",context:t})}o["@type"]=d}if("@container"in a){var f=a["@container"];if("@list"!==f&&"@set"!==f&&"@index"!==f&&"@language"!==f)throw new Oe("Invalid JSON-LD syntax; @context @container value must be one of the following: @list, @set, @index, or @language.","jsonld.SyntaxError",{code:"invalid container mapping",context:t});if(o.reverse&&"@index"!==f&&"@set"!==f&&null!==f)throw new Oe("Invalid JSON-LD syntax; @context @container value for a @reverse type definition must be @index or @set.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});o["@container"]=f}if("@language"in a&&!("@type"in a)){var p=a["@language"];if(null!==p&&!J(p))throw new Oe("Invalid JSON-LD syntax; @context @language value must be a string or null.","jsonld.SyntaxError",{code:"invalid language mapping",context:t});null!==p&&(p=p.toLowerCase()),o["@language"]=p}var l=o["@id"];if("@context"===l||"@preserve"===l)throw new Oe("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError",{code:"invalid keyword alias",context:t})}function D(e,t,r,a,o){if(null===t||_(t))return t;if(t=String(t),a&&t in a&&!0!==o[t]&&S(e,a,t,o),r=r||{},r.vocab){var i=e.mappings[t];if(null===i)return null;if(i)return i["@id"]}var l=t.indexOf(":");if(-1!==l){var u=t.substr(0,l),s=t.substr(l+1);if("_"===u||0===s.indexOf("//"))return t;a&&u in a&&S(e,a,u,o);var i=e.mappings[u];return i?i["@id"]+s:t}if(r.vocab&&"@vocab"in e)return e["@vocab"]+t;var c=t;return r.base&&(c=n.prependBase(e["@base"],c)),c}function N(e,t){if(null===e)return t;if(-1!==t.indexOf(":"))return t;J(e)&&(e=n.url.parse(e||""));var r=n.url.parse(t),a={protocol:e.protocol||""};if(null!==r.authority)a.authority=r.authority,a.path=r.path,a.query=r.query;else if(a.authority=e.authority,""===r.path)a.path=e.path,null!==r.query?a.query=r.query:a.query=e.query;else{if(0===r.path.indexOf("/"))a.path=r.path;else{var o=e.path;""!==r.path&&(o=o.substr(0,o.lastIndexOf("/")+1),o.length>0&&"/"!==o.substr(-1)&&(o+="/"),o+=r.path),a.path=o}a.query=r.query}a.path=ae(a.path,!!a.authority);var i=a.protocol;return null!==a.authority&&(i+="//"+a.authority),i+=a.path,null!==a.query&&(i+="?"+a.query),null!==r.fragment&&(i+="#"+r.fragment),""===i&&(i="./"),i}function C(e,t){if(null===e)return t;J(e)&&(e=n.url.parse(e||""));var r="";if(""!==e.href?r+=(e.protocol||"")+"//"+(e.authority||""):t.indexOf("//")&&(r+="//"),0!==t.indexOf(r))return t;for(var a=n.url.parse(t.substr(r.length)),o=e.normalizedPath.split("/"),i=a.normalizedPath.split("/"),l=a.fragment||a.query?0:1;o.length>0&&i.length>l&&o[0]===i[0];)o.shift(),i.shift();var u="";if(o.length>0){o.pop();for(var s=0;s<o.length;++s)u+="../"}return u+=i.join("/"),null!==a.query&&(u+="?"+a.query),null!==a.fragment&&(u+="#"+a.fragment),""===u&&(u="./"),u}function R(e){function t(){var e=this;if(e.inverse)return e.inverse;for(var t=e.inverse={},n=e.fastCurieMap={},o={},i=e["@language"]||"@none",l=e.mappings,u=Object.keys(l).sort(I),s=0;s<u.length;++s){var c=u[s],d=l[c];if(null!==d){var f=d["@container"]||"@none",p=d["@id"];A(p)||(p=[p]);for(var h=0;h<p.length;++h){var v=p[h],g=t[v],y=_(v);if(g)y||d._termHasColon||o[v].push(c);else if(t[v]=g={},!y&&!d._termHasColon){o[v]=[c];var m={iri:v,terms:o[v]};v[0]in n?n[v[0]].push(m):n[v[0]]=[m]}if(g[f]||(g[f]={"@language":{},"@type":{}}),g=g[f],d.reverse)a(d,c,g["@type"],"@reverse");else if("@type"in d)a(d,c,g["@type"],d["@type"]);else if("@language"in d){var x=d["@language"]||"@null";a(d,c,g["@language"],x)}else a(d,c,g["@language"],i),a(d,c,g["@type"],"@none"),a(d,c,g["@language"],"@none")}}}for(var b in n)r(n,b,1);return t}function r(e,t,n){for(var a,o,i=e[t],l=e[t]={},u=0;u<i.length;++u)a=i[u].iri,o=n>=a.length?"":a[n],o in l?l[o].push(i[u]):l[o]=[i[u]];for(var t in l)""!==t&&r(l,t,n+1)}function a(e,t,n,r){r in n||(n[r]=t)}function o(){var e={};return e["@base"]=this["@base"],e.mappings=W(this.mappings),e.clone=this.clone,e.inverse=null,e.getInverse=this.getInverse,"@language"in this&&(e["@language"]=this["@language"]),"@vocab"in this&&(e["@vocab"]=this["@vocab"]),e}return{"@base":n.url.parse(e.base||""),mappings:{},inverse:null,getInverse:t,clone:o}}function _(e){if(!J(e))return!1;switch(e){case"@base":case"@context":case"@container":case"@default":case"@embed":case"@explicit":case"@graph":case"@id":case"@index":case"@language":case"@list":case"@omitDefault":case"@preserve":case"@requireAll":case"@reverse":case"@set":case"@type":case"@value":case"@vocab":return!0}return!1}function T(e){return"[object Object]"===Object.prototype.toString.call(e)}function U(e){return T(e)&&0===Object.keys(e).length}function A(e){return Array.isArray(e)}function q(e){if(!J(e)&&!U(e)){var t=!1;if(A(e)){t=!0;for(var n=0;n<e.length;++n)if(!J(e[n])){t=!1;break}}if(!t)throw new Oe('Invalid JSON-LD syntax; "@type" value must a string, an array of strings, or an empty object.',"jsonld.SyntaxError",{code:"invalid type value",value:e})}}function J(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)}function P(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function F(e){return P(e)&&-1!==String(e).indexOf(".")}function B(e){return!isNaN(parseFloat(e))&&isFinite(e)}function V(e){return"boolean"==typeof e||"[object Boolean]"===Object.prototype.toString.call(e)}function M(e){return void 0===e}function z(e){var t=!1;if(T(e)&&!("@value"in e||"@set"in e||"@list"in e)){t=Object.keys(e).length>1||!("@id"in e)}return t}function H(e){return T(e)&&1===Object.keys(e).length&&"@id"in e}function Q(e){return T(e)&&"@value"in e}function X(e){return T(e)&&"@list"in e}function G(e){var t=!1;return T(e)&&(t="@id"in e?0===e["@id"].indexOf("_:"):0===Object.keys(e).length||!("@value"in e||"@set"in e||"@list"in e)),t}function $(e){return J(e)&&-1!==e.indexOf(":")}function W(e){if(e&&"object"==typeof e){var t;if(A(e)){t=[];for(var n=0;n<e.length;++n)t[n]=W(e[n])}else if(T(e)){t={};for(var r in e)t[r]=W(e[r])}else t=e.toString();return t}return e}function Y(e,t,r,a){var o=Object.keys(t).length;if(A(e)){for(var i=0;i<e.length;++i)Y(e[i],t,r,a);return o<Object.keys(t).length}if(T(e)){for(var l in e)if("@context"===l){var u=e[l];if(A(u))for(var s=u.length,i=0;i<s;++i){var c=u[i];J(c)&&(c=n.prependBase(a,c),r?(c=t[c],A(c)?(Array.prototype.splice.apply(u,[i,1].concat(c)),i+=c.length-1,s=u.length):u[i]=c):c in t||(t[c]=!1))}else J(u)&&(u=n.prependBase(a,u),r?e[l]=t[u]:u in t||(t[u]=!1))}else Y(e[l],t,r,a);return o<Object.keys(t).length}return!1}function Z(e,t,n){var r=null,a=t.documentLoader,o=function(e,t,n,a,i){if(Object.keys(t).length>Le)return r=new Oe("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{code:"loading remote context failed",max:Le}),i(r);var l={},u=function(){Y(e,l,!0,a),i(null,e)};if(!Y(e,l,!1,a))return u();var s=[];for(var c in l)!1===l[c]&&s.push(c);for(var d=s.length,f=0;f<s.length;++f)!function(e){if(e in t)return r=new Oe("Cyclical @context URLs detected.","jsonld.ContextUrlError",{code:"recursive context inclusion",url:e}),i(r);var a=W(t);a[e]=!0;var s=function(t,s){if(!r){var c=s?s.document:null;if(!t&&J(c))try{c=JSON.parse(c)}catch(e){t=e}if(t?t=new Oe("Dereferencing a URL did not result in a valid JSON-LD object. Possible causes are an inaccessible URL perhaps due to a same-origin policy (ensure the server uses CORS if you are using client-side JavaScript), too many redirects, a non-JSON response, or more than one HTTP Link Header was provided for a remote context.","jsonld.InvalidUrl",{code:"loading remote context failed",url:e,cause:t}):T(c)||(t=new Oe("Dereferencing a URL did not result in a JSON object. The response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{code:"invalid remote context",url:e,cause:t})),t)return r=t,i(r);c="@context"in c?{"@context":c["@context"]}:{"@context":{}},s.contextUrl&&(A(c["@context"])||(c["@context"]=[c["@context"]]),c["@context"].push(s.contextUrl)),o(c,a,n,e,function(t,n){if(t)return i(t);l[e]=n["@context"],0===(d-=1)&&u()})}},c=n(e,s);c&&"then"in c&&c.then(s.bind(null,null),s)}(s[f])};o(e,{},a,t.base,n)}function K(e){for(var t=/(?:\r\n)|(?:\n)|(?:\r)/g,n=new RegExp("^[ \\t]*(?:#.*)?$"),r=new RegExp('^[ \\t]*(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-z0-9]+)))[ \\t]+(?:<([^:]+:[^>]*)>)[ \\t]+(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-z0-9]+))|(?:"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"(?:(?:\\^\\^(?:<([^:]+:[^>]*)>))|(?:@([a-z]+(?:-[a-z0-9]+)*)))?))[ \\t]*(?:\\.|(?:(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-z0-9]+)))[ \\t]*\\.))[ \\t]*(?:#.*)?$'),a={},o=e.split(t),i=0,l=0;l<o.length;++l){var u=o[l];if(i++,!n.test(u)){var s=u.match(r);if(null===s)throw new Oe("Error while parsing N-Quads; invalid quad.","jsonld.ParseError",{line:i});var c={};if(M(s[1])?c.subject={type:"blank node",value:s[2]}:c.subject={type:"IRI",value:s[1]},c.predicate={type:"IRI",value:s[3]},M(s[4]))if(M(s[5])){c.object={type:"literal"},M(s[7])?M(s[8])?c.object.datatype=he:(c.object.datatype=ke,c.object.language=s[8]):c.object.datatype=s[7];var f=s[6].replace(/\\"/g,'"').replace(/\\t/g,"\t").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\/g,"\\");c.object.value=f}else c.object={type:"blank node",value:s[5]};else c.object={type:"IRI",value:s[4]};var p="@default";if(M(s[9])?M(s[10])||(p=s[10]):p=s[9],p in a){for(var h=!0,v=a[p],g=0;h&&g<v.length;++g)d(v[g],c)&&(h=!1);h&&v.push(c)}else a[p]=[c]}}return a}function ee(e){var t=[];for(var n in e)for(var r=e[n],a=0;a<r.length;++a){var o=r[a];"@default"===n&&(n=null),t.push(te(o,n))}return t.sort().join("")}function te(e,t){var n=e.subject,r=e.predicate,a=e.object,o=t||null;"name"in e&&e.name&&(o=e.name.value);var i="";if("IRI"===n.type?i+="<"+n.value+">":i+=n.value,i+=" ","IRI"===r.type?i+="<"+r.value+">":i+=r.value,i+=" ","IRI"===a.type)i+="<"+a.value+">";else if("blank node"===a.type)i+=a.value;else{var l=a.value.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"');i+='"'+l+'"',a.datatype===ke?a.language&&(i+="@"+a.language):a.datatype!==he&&(i+="^^<"+a.datatype+">")}return null!==o&&void 0!==o&&(0!==o.indexOf("_:")?i+=" <"+o+">":i+=" "+o),i+=" .\n"}function ne(e){var t={};t["@default"]=[];for(var n=e.getSubjects(),r=0;r<n.length;++r){var a=n[r];if(null!==a){var o=e.getSubjectTriples(a);if(null!==o){var i=o.predicates;for(var l in i)for(var u=i[l].objects,s=0;s<u.length;++s){var c=u[s],d={};0===a.indexOf("_:")?d.subject={type:"blank node",value:a}:d.subject={type:"IRI",value:a},0===l.indexOf("_:")?d.predicate={type:"blank node",value:l}:d.predicate={type:"IRI",value:l};var f=c.value;if(c.type===we){se||Re();var p=new se;f="";for(var h=0;h<c.value.length;h++)c.value[h].nodeType===ce.ELEMENT_NODE?f+=p.serializeToString(c.value[h]):c.value[h].nodeType===ce.TEXT_NODE&&(f+=c.value[h].nodeValue)}d.object={},c.type===je?0===c.value.indexOf("_:")?d.object.type="blank node":d.object.type="IRI":(d.object.type="literal",c.type===be?c.language?(d.object.datatype=ke,d.object.language=c.language):d.object.datatype=he:d.object.datatype=c.type),d.object.value=f,t["@default"].push(d)}}}}return t}function re(e){this.prefix=e,this.counter=0,this.existing={}}function ae(e,t){var n="";0===e.indexOf("/")&&(n="/");for(var r=e.split("/"),a=[];r.length>0;)"."===r[0]||""===r[0]&&r.length>1?r.shift():".."!==r[0]?a.push(r.shift()):(r.shift(),t||a.length>0&&".."!==a[a.length-1]?a.pop():a.push(".."));return n+a.join("/")}n.compact=function(e,t,r,a){function o(e,n,r,o){if(e)return a(e);o.compactArrays&&!o.graph&&A(n)?1===n.length?n=n[0]:0===n.length&&(n={}):o.graph&&T(n)&&(n=[n]),T(t)&&"@context"in t&&(t=t["@context"]),t=W(t),A(t)||(t=[t]);var i=t;t=[];for(var l=0;l<i.length;++l)(!T(i[l])||Object.keys(i[l]).length>0)&&t.push(i[l]);var u=t.length>0;if(1===t.length&&(t=t[0]),A(n)){var s=O(r,"@graph"),c=n;n={},u&&(n["@context"]=t),n[s]=c}else if(T(n)&&u){var c=n;n={"@context":t};for(var d in c)n[d]=c[d]}a(null,n,r)}if(arguments.length<2)return n.nextTick(function(){a(new TypeError("Could not compact, too few arguments."))});if("function"==typeof r&&(a=r,r={}),r=r||{},null===t)return n.nextTick(function(){a(new Oe("The compaction context must not be null.","jsonld.CompactError",{code:"invalid local context"}))});if(null===e)return n.nextTick(function(){a(null,null)});"base"in r||(r.base="string"==typeof e?e:""),"compactArrays"in r||(r.compactArrays=!0),"graph"in r||(r.graph=!1),"skipExpansion"in r||(r.skipExpansion=!1),"documentLoader"in r||(r.documentLoader=n.loadDocument),"link"in r||(r.link=!1),r.link&&(r.skipExpansion=!0);!function(e,t,r){if(t.skipExpansion)return n.nextTick(function(){r(null,e)});n.expand(e,t,r)}(e,r,function(e,i){if(e)return a(new Oe("Could not expand input before compaction.","jsonld.CompactError",{cause:e}));var l=R(r);n.processContext(l,t,r,function(e,t){if(e)return a(new Oe("Could not process context before compaction.","jsonld.CompactError",{cause:e}));var n;try{n=(new Ee).compact(t,null,i,r)}catch(e){return a(e)}o(null,n,t,r)})})},n.expand=function(e,t,r){function a(e){"base"in t||(t.base=e.documentUrl||"");var n={document:W(e.document),remoteContext:{"@context":e.contextUrl}};if("expandContext"in t){var a=W(t.expandContext);n.expandContext="object"==typeof a&&"@context"in a?a:{"@context":a}}Z(n,t,function(e,n){if(e)return r(e);var a;try{var o=new Ee,i=R(t),l=n.document,u=n.remoteContext["@context"];n.expandContext&&(i=o.processContext(i,n.expandContext["@context"],t)),u&&(i=o.processContext(i,u,t)),a=o.expand(i,null,l,t,!1),T(a)&&"@graph"in a&&1===Object.keys(a).length?a=a["@graph"]:null===a&&(a=[]),A(a)||(a=[a])}catch(e){return r(e)}r(null,a)})}if(arguments.length<1)return n.nextTick(function(){r(new TypeError("Could not expand, too few arguments."))});"function"==typeof t&&(r=t,t={}),t=t||{},"documentLoader"in t||(t.documentLoader=n.loadDocument),"keepFreeFloatingNodes"in t||(t.keepFreeFloatingNodes=!1),n.nextTick(function(){if("string"==typeof e){var n=function(e,t){if(e)return r(e);try{if(!t.document)throw new Oe("No remote document found at the given URL.","jsonld.NullRemoteDocument");"string"==typeof t.document&&(t.document=JSON.parse(t.document))}catch(e){return r(new Oe("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:e,remoteDoc:t}))}a(t)},o=t.documentLoader(e,n);return void(o&&"then"in o&&o.then(n.bind(null,null),n))}a({contextUrl:null,documentUrl:null,document:e})})},n.flatten=function(e,t,r,a){if(arguments.length<1)return n.nextTick(function(){a(new TypeError("Could not flatten, too few arguments."))});"function"==typeof r?(a=r,r={}):"function"==typeof t&&(a=t,t=null,r={}),r=r||{},"base"in r||(r.base="string"==typeof e?e:""),"documentLoader"in r||(r.documentLoader=n.loadDocument),n.expand(e,r,function(e,o){if(e)return a(new Oe("Could not expand input before flattening.","jsonld.FlattenError",{cause:e}));var i;try{i=(new Ee).flatten(o)}catch(e){return a(e)}if(null===t)return a(null,i);r.graph=!0,r.skipExpansion=!0,n.compact(i,t,r,function(e,t){if(e)return a(new Oe("Could not compact flattened output.","jsonld.FlattenError",{cause:e}));a(null,t)})})},n.frame=function(e,t,r,a){function o(t){var o,i=t.document;i?(o=i["@context"],t.contextUrl?(o?A(o)?o.push(t.contextUrl):o=[o,t.contextUrl]:o=t.contextUrl,i["@context"]=o):o=o||{}):o={},n.expand(e,r,function(e,t){if(e)return a(new Oe("Could not expand input before framing.","jsonld.FrameError",{cause:e}));var l=W(r);l.isFrame=!0,l.keepFreeFloatingNodes=!0,n.expand(i,l,function(e,r){if(e)return a(new Oe("Could not expand frame before framing.","jsonld.FrameError",{cause:e}));var i;try{i=(new Ee).frame(t,r,l)}catch(e){return a(e)}l.graph=!0,l.skipExpansion=!0,l.link={},n.compact(i,o,l,function(e,t,n){if(e)return a(new Oe("Could not compact framed output.","jsonld.FrameError",{cause:e}));var r=O(n,"@graph");l.link={},t[r]=k(n,t[r],l),a(null,t)})})})}if(arguments.length<2)return n.nextTick(function(){a(new TypeError("Could not frame, too few arguments."))});"function"==typeof r&&(a=r,r={}),r=r||{},"base"in r||(r.base="string"==typeof e?e:""),"documentLoader"in r||(r.documentLoader=n.loadDocument),"embed"in r||(r.embed="@last"),r.explicit=r.explicit||!1,"requireAll"in r||(r.requireAll=!0),r.omitDefault=r.omitDefault||!1,n.nextTick(function(){if("string"==typeof t){var e=function(e,t){if(e)return a(e);try{if(!t.document)throw new Oe("No remote document found at the given URL.","jsonld.NullRemoteDocument");"string"==typeof t.document&&(t.document=JSON.parse(t.document))}catch(e){return a(new Oe("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:e,remoteDoc:t}))}o(t)},n=r.documentLoader(t,e);return void(n&&"then"in n&&n.then(e.bind(null,null),e))}o({contextUrl:null,documentUrl:null,document:t})})},n.link=function(e,t,r,a){var o={};t&&(o["@context"]=t),o["@embed"]="@link",n.frame(e,o,r,a)},n.objectify=function(e,t,r,a){"function"==typeof r&&(a=r,r={}),r=r||{},"base"in r||(r.base="string"==typeof e?e:""),"documentLoader"in r||(r.documentLoader=n.loadDocument),n.expand(e,r,function(e,o){if(e)return a(new Oe("Could not expand input before linking.","jsonld.LinkError",{cause:e}));var i;try{i=(new Ee).flatten(o)}catch(e){return a(e)}r.graph=!0,r.skipExpansion=!0,n.compact(i,t,r,function(e,t,r){if(e)return a(new Oe("Could not compact flattened output before linking.","jsonld.LinkError",{cause:e}));var o=O(r,"@graph"),i=t[o][0],l=function(e){if(T(e)||A(e)){if(T(e)){if(l.visited[e["@id"]])return;l.visited[e["@id"]]=!0}for(var t in e){var a=e[t],o="@id"===n.getContextValue(r,t,"@type")
;if(A(a)||T(a)||o)if(J(a)&&o)e[t]=a=i[a],l(a);else if(A(a))for(var u=0;u<a.length;++u)J(a[u])&&o?a[u]=i[a[u]]:T(a[u])&&"@id"in a[u]&&(a[u]=i[a[u]["@id"]]),l(a[u]);else if(T(a)){var s=a["@id"];e[t]=a=i[s],l(a)}}}};l.visited={},l(i),t.of_type={};for(var u in i)if("@type"in i[u]){var s=i[u]["@type"];A(s)||(s=[s]);for(var c=0;c<s.length;++c)s[c]in t.of_type||(t.of_type[s[c]]=[]),t.of_type[s[c]].push(i[u])}a(null,t)})})},n.normalize=function(e,t,r){if(arguments.length<1)return n.nextTick(function(){r(new TypeError("Could not normalize, too few arguments."))});if("function"==typeof t&&(r=t,t={}),t=t||{},"algorithm"in t||(t.algorithm="URGNA2012"),"base"in t||(t.base="string"==typeof e?e:""),"documentLoader"in t||(t.documentLoader=n.loadDocument),"inputFormat"in t){if("application/nquads"!==t.inputFormat)return r(new Oe("Unknown normalization input format.","jsonld.NormalizeError"));var a=K(e);(new Ee).normalize(a,t,r)}else{var o=W(t);delete o.format,o.produceGeneralizedRdf=!1,n.toRDF(e,o,function(e,n){if(e)return r(new Oe("Could not convert input to RDF dataset before normalization.","jsonld.NormalizeError",{cause:e}));(new Ee).normalize(n,t,r)})}},n.fromRDF=function(e,t,r){if(arguments.length<1)return n.nextTick(function(){r(new TypeError("Could not convert from RDF, too few arguments."))});"function"==typeof t&&(r=t,t={}),t=t||{},"useRdfType"in t||(t.useRdfType=!1),"useNativeTypes"in t||(t.useNativeTypes=!1),"format"in t||!J(e)||"format"in t||(t.format="application/nquads"),n.nextTick(function(){function n(e,t,n){(new Ee).fromRDF(e,t,n)}var a;if(t.format){if(!(a=t.rdfParser||ue[t.format]))return r(new Oe("Unknown input format.","jsonld.UnknownFormat",{format:t.format}))}else a=function(){return e};var o=!1;try{e=a(e,function(e,a){if(o=!0,e)return r(e);n(a,t,r)})}catch(e){if(!o)return r(e);throw e}if(e){if("then"in e)return e.then(function(e){n(e,t,r)},r);n(e,t,r)}})},n.toRDF=function(e,t,r){if(arguments.length<1)return n.nextTick(function(){r(new TypeError("Could not convert to RDF, too few arguments."))});"function"==typeof t&&(r=t,t={}),t=t||{},"base"in t||(t.base="string"==typeof e?e:""),"documentLoader"in t||(t.documentLoader=n.loadDocument),n.expand(e,t,function(e,n){if(e)return r(new Oe("Could not expand input before serialization to RDF.","jsonld.RdfError",{cause:e}));var a;try{if(a=Ee.prototype.toRDF(n,t),t.format){if("application/nquads"===t.format)return r(null,ee(a));throw new Oe("Unknown output format.","jsonld.UnknownFormat",{format:t.format})}}catch(e){return r(e)}r(null,a)})},n.createNodeMap=function(e,t,r){if(arguments.length<1)return n.nextTick(function(){r(new TypeError("Could not create node map, too few arguments."))});"function"==typeof t&&(r=t,t={}),t=t||{},"base"in t||(t.base="string"==typeof e?e:""),"documentLoader"in t||(t.documentLoader=n.loadDocument),n.expand(e,t,function(e,n){if(e)return r(new Oe("Could not expand input before creating node map.","jsonld.CreateNodeMapError",{cause:e}));var a;try{a=(new Ee).createNodeMap(n,t)}catch(e){return r(e)}r(null,a)})},n.merge=function(e,t,r,a){function o(e,t){if(!u){if(e)return u=e,a(new Oe("Could not expand input before flattening.","jsonld.FlattenError",{cause:e}));l.push(t),0==--s&&i(l)}}function i(e){var o=!0;"mergeNodes"in r&&(o=r.mergeNodes);var i,l=r.namer||r.issuer||new re("_:b"),u={"@default":{}};try{for(var s=0;s<e.length;++s){var c=e[s];c=n.relabelBlankNodes(c,{issuer:new re("_:b"+s+"-")});var d=o||0===s?u:{"@default":{}};if(f(c,d,"@default",l),d!==u)for(var h in d){var v=d[h];if(h in u){var g=u[h];for(var y in v)y in g||(g[y]=v[y])}else u[h]=v}}i=p(u)}catch(e){return a(e)}for(var m=[],x=Object.keys(i).sort(),b=0;b<x.length;++b){var w=i[x[b]];H(w)||m.push(w)}if(null===t)return a(null,m);r.graph=!0,r.skipExpansion=!0,n.compact(m,t,r,function(e,t){if(e)return a(new Oe("Could not compact merged output.","jsonld.MergeError",{cause:e}));a(null,t)})}if(arguments.length<1)return n.nextTick(function(){a(new TypeError("Could not merge, too few arguments."))});if(!A(e))return n.nextTick(function(){a(new TypeError('Could not merge, "docs" must be an array.'))});"function"==typeof r?(a=r,r={}):"function"==typeof t&&(a=t,t=null,r={}),r=r||{};for(var l=[],u=null,s=e.length,c=0;c<e.length;++c){var d={};for(var h in r)d[h]=r[h];n.expand(e[c],d,o)}},n.relabelBlankNodes=function(e,t){return t=t||{},o(t.namer||t.issuer||new re("_:b"),e)},n.prependBase=function(e,t){return N(e,t)},n.documentLoader=function(t,r){var a=new Oe("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed"});return e?r(a,{contextUrl:null,documentUrl:t,document:null}):n.promisify(function(e){e(a)})},n.loadDocument=function(e,t){var r=n.documentLoader(e,t);r&&"then"in r&&r.then(t.bind(null,null),t)},n.promises=function(e){e=e||{};var t=Array.prototype.slice,r=n.promisify,a=e.api||{},o=e.version||"jsonld.js";"string"==typeof e.api&&(e.version||(o=e.api),a={}),a.expand=function(e){if(arguments.length<1)throw new TypeError("Could not expand, too few arguments.");return r.apply(null,[n.expand].concat(t.call(arguments)))},a.compact=function(e,a){if(arguments.length<2)throw new TypeError("Could not compact, too few arguments.");var o=function(e,t,r,a){"function"==typeof r&&(a=r,r={}),r=r||{},n.compact(e,t,r,function(e,t){a(e,t)})};return r.apply(null,[o].concat(t.call(arguments)))},a.flatten=function(e){if(arguments.length<1)throw new TypeError("Could not flatten, too few arguments.");return r.apply(null,[n.flatten].concat(t.call(arguments)))},a.frame=function(e,a){if(arguments.length<2)throw new TypeError("Could not frame, too few arguments.");return r.apply(null,[n.frame].concat(t.call(arguments)))},a.fromRDF=function(e){if(arguments.length<1)throw new TypeError("Could not convert from RDF, too few arguments.");return r.apply(null,[n.fromRDF].concat(t.call(arguments)))},a.toRDF=function(e){if(arguments.length<1)throw new TypeError("Could not convert to RDF, too few arguments.");return r.apply(null,[n.toRDF].concat(t.call(arguments)))},a.normalize=function(e){if(arguments.length<1)throw new TypeError("Could not normalize, too few arguments.");return r.apply(null,[n.normalize].concat(t.call(arguments)))},"jsonld.js"===o&&(a.link=function(e,a){if(arguments.length<2)throw new TypeError("Could not link, too few arguments.");return r.apply(null,[n.link].concat(t.call(arguments)))},a.objectify=function(e){return r.apply(null,[n.objectify].concat(t.call(arguments)))},a.createNodeMap=function(e){return r.apply(null,[n.createNodeMap].concat(t.call(arguments)))},a.merge=function(e){return r.apply(null,[n.merge].concat(t.call(arguments)))});try{n.Promise=global.Promise||require("es6-promise").Promise}catch(e){var i=function(){throw new Error("Unable to find a Promise implementation.")};for(var l in a)a[l]=i}return a},n.promisify=function(e){if(!n.Promise)try{n.Promise=global.Promise||require("es6-promise").Promise}catch(e){throw new Error("Unable to find a Promise implementation.")}var t=Array.prototype.slice.call(arguments,1);return new n.Promise(function(n,r){e.apply(null,t.concat(function(e,t){e?r(e):n(t)}))})},n.promises({api:n.promises}),r.prototype=n.promises({version:"json-ld-1.0"}),r.prototype.toString=function(){return this instanceof r?"[object JsonLdProcessor]":"[object JsonLdProcessorPrototype]"},n.JsonLdProcessor=r;var oe=!!Object.defineProperty;if(oe)try{Object.defineProperty({},"x",{})}catch(e){oe=!1}oe&&(Object.defineProperty(r,"prototype",{writable:!1,enumerable:!1}),Object.defineProperty(r.prototype,"constructor",{writable:!0,enumerable:!1,configurable:!0,value:r})),t&&void 0===global.JsonLdProcessor&&(oe?Object.defineProperty(global,"JsonLdProcessor",{writable:!0,enumerable:!1,configurable:!0,value:r}):global.JsonLdProcessor=r);var ie="function"==typeof setImmediate&&setImmediate,le=ie?function(e){ie(e)}:function(e){setTimeout(e,0)};"object"==typeof process&&"function"==typeof process.nextTick?n.nextTick=process.nextTick:n.nextTick=le,n.setImmediate=ie?le:n.nextTick,n.parseLinkHeader=function(e){for(var t={},n=e.match(/(?:<[^>]*?>|"[^"]*?"|[^,])+/g),r=/\s*<([^>]*?)>\s*(?:;\s*(.*))?/,a=0;a<n.length;++a){var o=n[a].match(r);if(o){for(var i={target:o[1]},l=o[2],u=/(.*?)=(?:(?:"([^"]*?)")|([^"]*?))\s*(?:(?:;\s*)|$)/g;o=u.exec(l);)i[o[1]]=void 0===o[2]?o[3]:o[2];var s=i.rel||"";A(t[s])?t[s].push(i):t[s]=s in t?[t[s],i]:i}}return t},n.RequestQueue=function(){this._requests={}},n.RequestQueue.prototype.wrapLoader=function(e){return this._loader=e,this._usePromise=1===e.length,this.add.bind(this)},n.RequestQueue.prototype.add=function(e,t){var r=this;if(!t&&!r._usePromise)throw new Error("callback must be specified.");if(r._usePromise)return new n.Promise(function(t,n){var a=r._requests[e];a||(a=r._requests[e]=r._loader(e).then(function(t){return delete r._requests[e],t}).catch(function(t){throw delete r._requests[e],t})),a.then(function(e){t(e)}).catch(function(e){n(e)})});e in r._requests?r._requests[e].push(t):(r._requests[e]=[t],r._loader(e,function(t,n){var a=r._requests[e];delete r._requests[e];for(var o=0;o<a.length;++o)a[o](t,n)}))},n.DocumentCache=function(e){this.order=[],this.cache={},this.size=e||50,this.expires=3e4},n.DocumentCache.prototype.get=function(e){if(e in this.cache){var t=this.cache[e];if(t.expires>=+new Date)return t.ctx;delete this.cache[e],this.order.splice(this.order.indexOf(e),1)}return null},n.DocumentCache.prototype.set=function(e,t){this.order.length===this.size&&delete this.cache[this.order.shift()],this.order.push(e),this.cache[e]={ctx:t,expires:+new Date+this.expires}},n.ActiveContextCache=function(e){this.order=[],this.cache={},this.size=e||100},n.ActiveContextCache.prototype.get=function(e,t){var n=JSON.stringify(e),r=JSON.stringify(t),a=this.cache[n];return a&&r in a?a[r]:null},n.ActiveContextCache.prototype.set=function(e,t,n){if(this.order.length===this.size){var r=this.order.shift();delete this.cache[r.activeCtx][r.localCtx]}var a=JSON.stringify(e),o=JSON.stringify(t);this.order.push({activeCtx:a,localCtx:o}),a in this.cache||(this.cache[a]={}),this.cache[a][o]=W(n)},n.cache={activeCtx:new n.ActiveContextCache},n.documentLoaders={},n.documentLoaders.jquery=function(e,t){function r(r,a){return 0!==r.indexOf("http:")&&0!==r.indexOf("https:")?a(new Oe('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:r}),{contextUrl:null,documentUrl:r,document:null}):t.secure&&0!==r.indexOf("https")?a(new Oe('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:r}),{contextUrl:null,documentUrl:r,document:null}):void e.ajax({url:r,accepts:{json:"application/ld+json, application/json"},headers:{Accept:"application/ld+json, application/json"},dataType:"json",crossDomain:!0,success:function(e,t,o){var i={contextUrl:null,documentUrl:r,document:e},l=o.getResponseHeader("Content-Type"),u=o.getResponseHeader("Link");if(u&&"application/ld+json"!==l){if(u=n.parseLinkHeader(u)[Ie],A(u))return a(new Oe("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:r}),i);u&&(i.contextUrl=u.target)}a(null,i)},error:function(e,t,n){a(new Oe("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:r,cause:n}),{contextUrl:null,documentUrl:r,document:null})}})}t=t||{};var a=new n.RequestQueue;return("usePromise"in t?t.usePromise:"undefined"!=typeof Promise)?a.wrapLoader(function(e){return n.promisify(r,e)}):a.wrapLoader(r)},n.documentLoaders.node=function(e){function t(u,s,c){function d(e,r,o){if(f={contextUrl:null,documentUrl:u,document:o||null},e)return c(new Oe("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:u,cause:e}),f);var i=l.STATUS_CODES[r.statusCode];if(r.statusCode>=400)return c(new Oe("URL could not be dereferenced: "+i,"jsonld.InvalidUrl",{code:"loading document failed",url:u,httpStatusCode:r.statusCode}),f);if(r.headers.link&&"application/ld+json"!==r.headers["content-type"]){var d=n.parseLinkHeader(r.headers.link)[Ie];if(A(d))return c(new Oe("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:u}),f);d&&(f.contextUrl=d.target)}if(r.statusCode>=300&&r.statusCode<400&&r.headers.location)return s.length===a?c(new Oe("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{code:"loading document failed",url:u,httpStatusCode:r.statusCode,redirects:s}),f):-1!==s.indexOf(u)?c(new Oe("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{code:"recursive context inclusion",url:u,httpStatusCode:r.statusCode,redirects:s}),f):(s.push(u),t(r.headers.location,s,c));s.push(u),c(e,f)}if(0!==u.indexOf("http:")&&0!==u.indexOf("https:"))return c(new Oe('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:u}),{contextUrl:null,documentUrl:u,document:null});if(e.secure&&0!==u.indexOf("https"))return c(new Oe('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:u}),{contextUrl:null,documentUrl:u,document:null});var f=null;if(null!==f)return c(null,f);var p={Accept:i};for(var h in e.headers)p[h]=e.headers[h];o({url:u,headers:p,strictSSL:r,followRedirect:!1},d)}e=e||{};var r=!("strictSSL"in e)||e.strictSSL,a="maxRedirects"in e?e.maxRedirects:-1,o="request"in e?e.request:require("request"),i="application/ld+json, application/json",l=require("http"),u=new n.RequestQueue;if(e.usePromise)return u.wrapLoader(function(e){return n.promisify(t,e,[])});var s=e.headers||{};if("Accept"in s||"accept"in s)throw new RangeError('Accept header may not be specified as an option; only "'+i+'" is supported.');return u.wrapLoader(function(e,n){t(e,[],n)})},n.documentLoaders.xhr=function(e){function t(t,a){if(0!==t.indexOf("http:")&&0!==t.indexOf("https:"))return a(new Oe('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:t}),{contextUrl:null,documentUrl:t,document:null});if(e.secure&&0!==t.indexOf("https"))return a(new Oe('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:t}),{contextUrl:null,documentUrl:t,document:null});var o=e.xhr||XMLHttpRequest,i=new o;i.onload=function(){if(i.status>=400)return a(new Oe("URL could not be dereferenced: "+i.statusText,"jsonld.LoadDocumentError",{code:"loading document failed",url:t,httpStatusCode:i.status}),{contextUrl:null,documentUrl:t,document:null});var e,o={contextUrl:null,documentUrl:t,document:i.response},l=i.getResponseHeader("Content-Type");if(r.test(i.getAllResponseHeaders())&&(e=i.getResponseHeader("Link")),e&&"application/ld+json"!==l){if(e=n.parseLinkHeader(e)[Ie],A(e))return a(new Oe("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:t}),o);e&&(o.contextUrl=e.target)}a(null,o)},i.onerror=function(){a(new Oe("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:t}),{contextUrl:null,documentUrl:t,document:null})},i.open("GET",t,!0),i.setRequestHeader("Accept","application/ld+json, application/json"),i.send()}e=e||{};var r=/(^|(\r\n))link:/i,a=new n.RequestQueue;return("usePromise"in e?e.usePromise:"undefined"!=typeof Promise)?a.wrapLoader(function(e){return n.promisify(t,e)}):a.wrapLoader(t)},n.useDocumentLoader=function(e){if(!(e in n.documentLoaders))throw new Oe('Unknown document loader type: "'+e+'"',"jsonld.UnknownDocumentLoader",{type:e});n.documentLoader=n.documentLoaders[e].apply(n,Array.prototype.slice.call(arguments,1))},n.processContext=function(e,t){var r={},a=2;arguments.length>3&&(r=arguments[2]||{},a+=1);var o=arguments[a];if("base"in r||(r.base=""),"documentLoader"in r||(r.documentLoader=n.loadDocument),null===t)return o(null,R(r));t=W(t),T(t)&&"@context"in t||(t={"@context":t}),Z(t,r,function(t,n){if(t)return o(t);try{n=(new Ee).processContext(e,n,r)}catch(e){return o(e)}o(null,n)})},n.hasProperty=function(e,t){var n=!1;if(t in e){var r=e[t];n=!A(r)||r.length>0}return n},n.hasValue=function(e,t,r){var a=!1;if(n.hasProperty(e,t)){var o=e[t],i=X(o);if(A(o)||i){i&&(o=o["@list"]);for(var l=0;l<o.length;++l)if(n.compareValues(r,o[l])){a=!0;break}}else A(r)||(a=n.compareValues(r,o))}return a},n.addValue=function(e,t,r,a){if(a=a||{},"propertyIsArray"in a||(a.propertyIsArray=!1),"allowDuplicate"in a||(a.allowDuplicate=!0),A(r)){0!==r.length||!a.propertyIsArray||t in e||(e[t]=[]);for(var o=0;o<r.length;++o)n.addValue(e,t,r[o],a)}else if(t in e){var i=!a.allowDuplicate&&n.hasValue(e,t,r);A(e[t])||i&&!a.propertyIsArray||(e[t]=[e[t]]),i||e[t].push(r)}else e[t]=a.propertyIsArray?[r]:r},n.getValues=function(e,t){var n=e[t]||[];return A(n)||(n=[n]),n},n.removeProperty=function(e,t){delete e[t]},n.removeValue=function(e,t,r,a){"propertyIsArray"in(a=a||{})||(a.propertyIsArray=!1);var o=n.getValues(e,t).filter(function(e){return!n.compareValues(e,r)});0===o.length?n.removeProperty(e,t):1!==o.length||a.propertyIsArray?e[t]=o:e[t]=o[0]},n.compareValues=function(e,t){return e===t||(!(!Q(e)||!Q(t)||e["@value"]!==t["@value"]||e["@type"]!==t["@type"]||e["@language"]!==t["@language"]||e["@index"]!==t["@index"])||!!(T(e)&&"@id"in e&&T(t)&&"@id"in t)&&e["@id"]===t["@id"])},n.getContextValue=function(e,t,n){var r=null;if(null===t)return r;if("@language"===n&&n in e&&(r=e[n]),e.mappings[t]){var a=e.mappings[t];M(n)?r=a:n in a&&(r=a[n])}return r};var ue={};if(n.registerRDFParser=function(e,t){ue[e]=t},n.unregisterRDFParser=function(e){delete ue[e]},e){if(void 0===se)var se=null;if(void 0===ce)var ce={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}var de="http://www.w3.org/2001/XMLSchema#boolean",fe="http://www.w3.org/2001/XMLSchema#double",pe="http://www.w3.org/2001/XMLSchema#integer",he="http://www.w3.org/2001/XMLSchema#string",ve="http://www.w3.org/1999/02/22-rdf-syntax-ns#",ge=ve+"first",ye=ve+"rest",me=ve+"nil",xe=ve+"type",be=ve+"PlainLiteral",we=ve+"XMLLiteral",je=ve+"object",ke=ve+"langString",Ie="http://www.w3.org/ns/json-ld#context",Le=10,Oe=function(t,n,r){e?(Error.call(this),Error.captureStackTrace(this,this.constructor)):"undefined"!=typeof Error&&(this.stack=(new Error).stack),this.name=n||"jsonld.Error",this.message=t||"An unspecified JSON-LD error occurred.",this.details=r||{}};e?require("util").inherits(Oe,Error):"undefined"!=typeof Error&&(Oe.prototype=new Error);var Ee=function(){};Ee.prototype.compact=function(e,t,r,a){if(A(r)){for(var o=[],i=0;i<r.length;++i){var l=this.compact(e,t,r[i],a);null!==l&&o.push(l)}if(a.compactArrays&&1===o.length){var u=n.getContextValue(e,t,"@container");null===u&&(o=o[0])}return o}if(T(r)){if(a.link&&"@id"in r&&r["@id"]in a.link)for(var s=a.link[r["@id"]],i=0;i<s.length;++i)if(s[i].expanded===r)return s[i].compacted;if(Q(r)||H(r)){var o=E(e,t,r);return a.link&&H(r)&&(r["@id"]in a.link||(a.link[r["@id"]]=[]),a.link[r["@id"]].push({expanded:r,compacted:o})),o}var c="@reverse"===t,o={};a.link&&"@id"in r&&(r["@id"]in a.link||(a.link[r["@id"]]=[]),a.link[r["@id"]].push({expanded:r,compacted:o}));for(var d=Object.keys(r).sort(),f=0;f<d.length;++f){var p=d[f],h=r[p];if("@id"!==p&&"@type"!==p)if("@reverse"!==p)if("@index"!==p)if("@graph"!==p&&"@list"!==p&&_(p)){var v=O(e,p);n.addValue(o,v,h)}else{if(0===h.length){var g=O(e,p,h,{vocab:!0},c);n.addValue(o,g,h,{propertyIsArray:!0})}for(var y=0;y<h.length;++y){var m=h[y],g=O(e,p,m,{vocab:!0},c),u=n.getContextValue(e,g,"@container"),x=X(m),b=null;x&&(b=m["@list"]);var w=this.compact(e,g,x?b:m,a);if(x)if(A(w)||(w=[w]),"@list"!==u){var j={};j[O(e,"@list")]=w,w=j,"@index"in m&&(w[O(e,"@index")]=m["@index"])}else if(g in o)throw new Oe('JSON-LD compact error; property has a "@list" @container rule but there is more than a single @list that matches the compacted term in the document. Compaction might mix unwanted items into the list.',"jsonld.SyntaxError",{code:"compaction to list of lists"});if("@language"===u||"@index"===u){var k;g in o?k=o[g]:o[g]=k={},"@language"===u&&Q(w)&&(w=w["@value"]),n.addValue(k,m[u],w)}else{var I=!a.compactArrays||"@set"===u||"@list"===u||A(w)&&0===w.length||"@list"===p||"@graph"===p;n.addValue(o,g,w,{propertyIsArray:I})}}}else{var u=n.getContextValue(e,t,"@container");if("@index"===u)continue;var v=O(e,p);n.addValue(o,v,h)}else{var L=this.compact(e,"@reverse",h,a);for(var S in L)if(e.mappings[S]&&e.mappings[S].reverse){var D=L[S],u=n.getContextValue(e,S,"@container"),N="@set"===u||!a.compactArrays;n.addValue(o,S,D,{propertyIsArray:N}),delete L[S]}if(Object.keys(L).length>0){var v=O(e,p);n.addValue(o,v,L)}}else{var L;if(J(h))L=O(e,h,null,{vocab:"@type"===p});else{L=[];for(var y=0;y<h.length;++y)L.push(O(e,h[y],null,{vocab:!0}))}var v=O(e,p),I=A(L)&&0===h.length;n.addValue(o,v,L,{propertyIsArray:I})}}return o}return r},Ee.prototype.expand=function(e,t,r,o,l){var u=this;if(null===r||void 0===r)return null;if(!A(r)&&!T(r))return l||null!==t&&"@graph"!==D(e,t,{vocab:!0})?i(e,t,r):null;if(A(r)){var s=[],c=n.getContextValue(e,t,"@container");l=l||"@list"===c;for(var d=0;d<r.length;++d){var f=u.expand(e,t,r[d],o);if(l&&(A(f)||X(f)))throw new Oe("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"});null!==f&&(A(f)?s=s.concat(f):s.push(f))}return s}"@context"in r&&(e=u.processContext(e,r["@context"],o));for(var p=D(e,t,{vocab:!0}),s={},h=Object.keys(r).sort(),v=0;v<h.length;++v){var g,y=h[v],m=r[y];if("@context"!==y){var x=D(e,y,{vocab:!0});if(null!==x&&($(x)||_(x))){if(_(x)){if("@reverse"===p)throw new Oe("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse property.","jsonld.SyntaxError",{code:"invalid reverse property map",value:m});if(x in s)throw new Oe("Invalid JSON-LD syntax; colliding keywords detected.","jsonld.SyntaxError",{code:"colliding keywords",keyword:x})}if("@id"===x&&!J(m)){if(!o.isFrame)throw new Oe('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{code:"invalid @id value",value:m});if(!T(m))throw new Oe('Invalid JSON-LD syntax; "@id" value must be a string or an object.',"jsonld.SyntaxError",{code:"invalid @id value",value:m})}if("@type"===x&&q(m),"@graph"===x&&!T(m)&&!A(m))throw new Oe('Invalid JSON-LD syntax; "@graph" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid @graph value",value:m});if("@value"===x&&(T(m)||A(m)))throw new Oe('Invalid JSON-LD syntax; "@value" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid value object value",value:m});if("@language"===x){if(null===m)continue;if(!J(m))throw new Oe('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{code:"invalid language-tagged string",value:m});m=m.toLowerCase()}if("@index"===x&&!J(m))throw new Oe('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{code:"invalid @index value",value:m});if("@reverse"!==x){var c=n.getContextValue(e,y,"@container");if("@language"===c&&T(m))g=a(m);else if("@index"===c&&T(m))g=function(t){for(var n=[],r=Object.keys(m).sort(),a=0;a<r.length;++a){var i=r[a],l=m[i];A(l)||(l=[l]),l=u.expand(e,t,l,o,!1);for(var s=0;s<l.length;++s){var c=l[s];"@index"in c||(c["@index"]=i),n.push(c)}}return n}(y);else{var b="@list"===x;if(b||"@set"===x){var w=t;if(b&&"@graph"===p&&(w=null),g=u.expand(e,w,m,o,b),b&&X(g))throw new Oe("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"})}else g=u.expand(e,y,m,o,!1)}if(null!==g||"@value"===x)if("@list"===x||X(g)||"@list"!==c||(g=A(g)?g:[g],g={"@list":g}),e.mappings[y]&&e.mappings[y].reverse){var j=s["@reverse"]=s["@reverse"]||{};A(g)||(g=[g]);for(var k=0;k<g.length;++k){var I=g[k];if(Q(I)||X(I))throw new Oe('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:g});n.addValue(j,x,I,{propertyIsArray:!0})}}else{var L=-1===["@index","@id","@type","@value","@language"].indexOf(x);n.addValue(s,x,g,{propertyIsArray:L})}}else{if(!T(m))throw new Oe('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{code:"invalid @reverse value",value:m});if("@reverse"in(g=u.expand(e,"@reverse",m,o)))for(var O in g["@reverse"])n.addValue(s,O,g["@reverse"][O],{propertyIsArray:!0});var j=s["@reverse"]||null;for(var O in g)if("@reverse"!==O){null===j&&(j=s["@reverse"]={}),n.addValue(j,O,[],{propertyIsArray:!0});for(var E=g[O],k=0;k<E.length;++k){var I=E[k];if(Q(I)||X(I))throw new Oe('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:g});n.addValue(j,O,I,{propertyIsArray:!0})}}}}}}h=Object.keys(s);var S=h.length;if("@value"in s){if("@type"in s&&"@language"in s)throw new Oe('Invalid JSON-LD syntax; an element containing "@value" may not contain both "@type" and "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:s});var N=S-1;if("@type"in s&&(N-=1),"@index"in s&&(N-=1),"@language"in s&&(N-=1),0!==N)throw new Oe('Invalid JSON-LD syntax; an element containing "@value" may only have an "@index" property and at most one other property which can be "@type" or "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:s});if(null===s["@value"])s=null;else{if("@language"in s&&!J(s["@value"]))throw new Oe("Invalid JSON-LD syntax; only strings may be language-tagged.","jsonld.SyntaxError",{code:"invalid language-tagged value",element:s});if("@type"in s&&(!$(s["@type"])||0===s["@type"].indexOf("_:")))throw new Oe('Invalid JSON-LD syntax; an element containing "@value" and "@type" must have an absolute IRI for the value of "@type".',"jsonld.SyntaxError",{code:"invalid typed value",element:s})}}else if("@type"in s&&!A(s["@type"]))s["@type"]=[s["@type"]];else if("@set"in s||"@list"in s){if(S>1&&!(2===S&&"@index"in s))throw new Oe('Invalid JSON-LD syntax; if an element has the property "@set" or "@list", then it can have at most one other property that is "@index".',"jsonld.SyntaxError",{code:"invalid set or list object",element:s});"@set"in s&&(s=s["@set"],h=Object.keys(s),S=h.length)}else 1===S&&"@language"in s&&(s=null);return!T(s)||o.keepFreeFloatingNodes||l||null!==t&&"@graph"!==p||(0===S||"@value"in s||"@list"in s||1===S&&"@id"in s)&&(s=null),s},Ee.prototype.createNodeMap=function(e,t){t=t||{};var n=t.namer||t.issuer||new re("_:b"),r={"@default":{}};return f(e,r,"@default",n),p(r)},Ee.prototype.flatten=function(e){for(var t=this.createNodeMap(e),n=[],r=Object.keys(t).sort(),a=0;a<r.length;++a){var o=t[r[a]];H(o)||n.push(o)}return n},Ee.prototype.frame=function(e,t,n){var r={options:n,graphs:{"@default":{},"@merged":{}},subjectStack:[],link:{}},a=new re("_:b");f(e,r.graphs,"@merged",a),r.subjects=r.graphs["@merged"];var o=[];return h(r,Object.keys(r.subjects).sort(),t,o,null),o},Ee.prototype.normalize=function(e,t,n){return"URDNA2015"===t.algorithm?new Se(t).main(e,n):"URGNA2012"===t.algorithm?new De(t).main(e,n):void n(new Error("Invalid RDF Dataset Normalization algorithm: "+t.algorithm))},Ee.prototype.fromRDF=function(e,t,r){var a={},o={"@default":a},i={};for(var l in e){var u=e[l];l in o||(o[l]={}),"@default"===l||l in a||(a[l]={"@id":l});for(var s=o[l],d=0;d<u.length;++d){var f=u[d],p=f.subject.value,h=f.predicate.value,v=f.object;p in s||(s[p]={"@id":p});var g=s[p],y="IRI"===v.type||"blank node"===v.type;if(!y||v.value in s||(s[v.value]={"@id":v.value}),h!==xe||t.useRdfType||!y){var m=c(v,t.useNativeTypes);if(n.addValue(g,h,m,{propertyIsArray:!0}),y)if(v.value===me){var x=s[v.value];"usages"in x||(x.usages=[]),x.usages.push({node:g,property:h,value:m})}else v.value in i?i[v.value]=!1:i[v.value]={node:g,property:h,value:m}}else n.addValue(g,"@type",v.value,{propertyIsArray:!0})}}for(var l in o){var b=o[l];if(me in b){for(var w=b[me],j=0;j<w.usages.length;++j){for(var k=w.usages[j],g=k.node,I=k.property,L=k.value,O=[],E=[],S=Object.keys(g).length;I===ye&&T(i[g["@id"]])&&A(g[ge])&&1===g[ge].length&&A(g[ye])&&1===g[ye].length&&(3===S||4===S&&A(g["@type"])&&1===g["@type"].length&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#List"===g["@type"][0])&&(O.push(g[ge][0]),E.push(g["@id"]),k=i[g["@id"]],g=k.node,I=k.property,L=k.value,S=Object.keys(g).length,0===g["@id"].indexOf("_:")););if(I===ge){if(g["@id"]===me)continue;L=b[L["@id"]][ye][0],O.pop(),E.pop()}delete L["@id"],L["@list"]=O.reverse();for(var D=0;D<E.length;++D)delete b[E[D]]}delete w.usages}}for(var N=[],C=Object.keys(a).sort(),j=0;j<C.length;++j){var R=C[j],g=a[R];if(R in o)for(var u=g["@graph"]=[],b=o[R],_=Object.keys(b).sort(),U=0;U<_.length;++U){var q=b[_[U]];H(q)||u.push(q)}H(g)||N.push(g)}r(null,N)},Ee.prototype.toRDF=function(e,t){var n=new re("_:b"),r={"@default":{}};f(e,r,"@default",n);for(var a={},o=Object.keys(r).sort(),i=0;i<o.length;++i){var u=o[i];("@default"===u||$(u))&&(a[u]=l(r[u],n,t))}return a},Ee.prototype.processContext=function(e,t,r){T(t)&&"@context"in t&&A(t["@context"])&&(t=t["@context"]);var a=A(t)?t:[t];if(0===a.length)return e.clone();for(var o=e,i=0;i<a.length;++i){var l=a[i];if(null!==l){if(T(l)&&"@context"in l&&(l=l["@context"]),!T(l))throw new Oe("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:l});if(n.cache.activeCtx){var u=n.cache.activeCtx.get(e,l);if(u){o=e=u;continue}}e=o,o=o.clone();var s={};if("@base"in l){var c=l["@base"];if(null===c)c=null;else{if(!J(c))throw new Oe('Invalid JSON-LD syntax; the value of "@base" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid base IRI",context:l});if(""!==c&&!$(c))throw new Oe('Invalid JSON-LD syntax; the value of "@base" in a @context must be an absolute IRI or the empty string.',"jsonld.SyntaxError",{code:"invalid base IRI",context:l})}null!==c&&(c=n.url.parse(c||"")),o["@base"]=c,s["@base"]=!0}if("@vocab"in l){var d=l["@vocab"];if(null===d)delete o["@vocab"];else{if(!J(d))throw new Oe('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:l});if(!$(d))throw new Oe('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be an absolute IRI.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:l});o["@vocab"]=d}s["@vocab"]=!0}if("@language"in l){var d=l["@language"];if(null===d)delete o["@language"];else{if(!J(d))throw new Oe('Invalid JSON-LD syntax; the value of "@language" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid default language",context:l});o["@language"]=d.toLowerCase()}s["@language"]=!0}for(var f in l)S(o,l,f,s);n.cache.activeCtx&&n.cache.activeCtx.set(e,l,o)}else o=e=R(r)}return o};var Se=function(){var e={subject:"s",object:"o",name:"g"},t=function(e){e=e||{},this.name="URDNA2015",this.options=e,this.blankNodeInfo={},this.hashToBlankNodes={},this.canonicalIssuer=new re("_:c14n"),this.quads=[],this.schedule={},this.schedule.MAX_DEPTH="maxCallStackDepth"in e?e.maxCallStackDepth:500,this.schedule.MAX_TOTAL_DEPTH="maxTotalCallStackDepth"in e?e.maxCallStackDepth:4294967295,this.schedule.depth=0,this.schedule.totalDepth=0,this.schedule.timeSlice="timeSlice"in e?e.timeSlice:10};return t.prototype.doWork=function(e,t){var r=this.schedule
;if(r.totalDepth>=r.MAX_TOTAL_DEPTH)return t(new Error("Maximum total call stack depth exceeded; normalization aborting."));!function a(){if(r.depth===r.MAX_DEPTH)return r.depth=0,r.running=!1,n.nextTick(a);var o=(new Date).getTime();if(r.running||(r.start=(new Date).getTime(),r.deadline=r.start+r.timeSlice),o<r.deadline)return r.running=!0,r.depth++,r.totalDepth++,e(function(e,n){r.depth--,r.totalDepth--,t(e,n)});r.depth=0,r.running=!1,n.setImmediate(a)}()},t.prototype.forEach=function(e,t,n){var r,a,o=this,i=0;if(A(e))a=e.length,r=function(){return i!==a&&(r.value=e[i++],r.key=i,!0)};else{var l=Object.keys(e);a=l.length,r=function(){return i!==a&&(r.key=l[i++],r.value=e[r.key],!0)}}!function e(a,i){return a?n(a):r()?o.doWork(function(){t(r.value,r.key,e)}):void n()}()},t.prototype.waterfall=function(e,t){var n=this;n.forEach(e,function(e,t,r){n.doWork(e,r)},t)},t.prototype.whilst=function(e,t,n){var r=this;!function a(o){return o?n(o):e()?void r.doWork(t,a):n()}()},t.prototype.main=function(e,t){var n=this;n.schedule.start=(new Date).getTime();var r;if(n.options.format&&"application/nquads"!==n.options.format)return t(new Oe("Unknown output format.","jsonld.UnknownFormat",{format:n.options.format}));var a={};n.waterfall([function(t){n.forEach(e,function(e,t,r){"@default"===t&&(t=null),n.forEach(e,function(e,r,o){null!==t&&(0===t.indexOf("_:")?e.name={type:"blank node",value:t}:e.name={type:"IRI",value:t}),n.quads.push(e),n.forEachComponent(e,function(t){if("blank node"===t.type){var r=t.value;r in n.blankNodeInfo?n.blankNodeInfo[r].quads.push(e):(a[r]=!0,n.blankNodeInfo[r]={quads:[e]})}}),o()},r)},t)},function(e){var t=!0;n.whilst(function(){return t},function(e){t=!1,n.hashToBlankNodes={},n.waterfall([function(e){n.forEach(a,function(e,t,r){n.hashFirstDegreeQuads(t,function(e,a){if(e)return r(e);a in n.hashToBlankNodes?n.hashToBlankNodes[a].push(t):n.hashToBlankNodes[a]=[t],r()})},e)},function(e){var r=Object.keys(n.hashToBlankNodes).sort();n.forEach(r,function(e,r,o){var i=n.hashToBlankNodes[e];if(i.length>1)return o();var l=i[0];n.canonicalIssuer.getId(l),delete a[l],delete n.hashToBlankNodes[e],t=!0,o()},e)}],e)},e)},function(e){var t=Object.keys(n.hashToBlankNodes).sort();n.forEach(t,function(e,t,r){var a=[],o=n.hashToBlankNodes[e];n.waterfall([function(e){n.forEach(o,function(e,t,r){if(n.canonicalIssuer.hasId(e))return r();var o=new re("_:b");o.getId(e),n.hashNDegreeQuads(e,o,function(e,t){if(e)return r(e);a.push(t),r()})},e)},function(e){a.sort(function(e,t){return e.hash<t.hash?-1:e.hash>t.hash?1:0}),n.forEach(a,function(e,t,r){for(var a in e.issuer.existing)n.canonicalIssuer.getId(a);r()},e)}],r)},e)},function(e){var t=[];n.waterfall([function(e){n.forEach(n.quads,function(e,r,a){n.forEachComponent(e,function(e){"blank node"===e.type&&0!==e.value.indexOf(n.canonicalIssuer.prefix)&&(e.value=n.canonicalIssuer.getId(e.value))}),t.push(te(e)),a()},e)},function(e){if(t.sort(),"application/nquads"===n.options.format)return r=t.join(""),e();r=K(t.join("")),e()}],e)}],function(e){t(e,r)})},t.prototype.hashFirstDegreeQuads=function(e,t){var n=this,r=n.blankNodeInfo[e];if("hash"in r)return t(null,r.hash);var a=[],o=r.quads;n.forEach(o,function(t,r,o){var i={predicate:t.predicate};n.forEachComponent(t,function(t,r){i[r]=n.modifyFirstDegreeComponent(e,t,r)}),a.push(te(i)),o()},function(e){if(e)return t(e);a.sort(),r.hash=Ce.hashNQuads(n.name,a),t(null,r.hash)})},t.prototype.modifyFirstDegreeComponent=function(e,t){return"blank node"!==t.type?t:(t=W(t),t.value=t.value===e?"_:a":"_:z",t)},t.prototype.hashRelatedBlankNode=function(e,t,n,r,a){var o,i=this;i.waterfall([function(t){return i.canonicalIssuer.hasId(e)?(o=i.canonicalIssuer.getId(e),t()):n.hasId(e)?(o=n.getId(e),t()):void i.hashFirstDegreeQuads(e,function(e,n){if(e)return t(e);o=n,t()})}],function(e){if(e)return a(e);var n=new Ce(i.name);return n.update(r),"g"!==r&&n.update(i.getRelatedPredicate(t)),n.update(o),a(null,n.digest())})},t.prototype.getRelatedPredicate=function(e){return"<"+e.predicate.value+">"},t.prototype.hashNDegreeQuads=function(e,t,n){var r,a=this,o=new Ce(a.name);a.waterfall([function(n){a.createHashToRelated(e,t,function(e,t){if(e)return n(e);r=t,n()})},function(e){var n=Object.keys(r).sort();a.forEach(n,function(e,n,i){o.update(e);var l,u="",s=new Ne(r[e]);a.whilst(function(){return s.hasNext()},function(e){var n=s.next(),r=t.clone(),o="",i=[];a.waterfall([function(t){a.forEach(n,function(t,n,l){if(a.canonicalIssuer.hasId(t)?o+=a.canonicalIssuer.getId(t):(r.hasId(t)||i.push(t),o+=r.getId(t)),0!==u.length&&o.length>=u.length&&o>u)return e();l()},t)},function(t){a.forEach(i,function(t,n,i){a.hashNDegreeQuads(t,r,function(n,a){return n?i(n):(o+=r.getId(t),o+="<"+a.hash+">",r=a.issuer,0!==u.length&&o.length>=u.length&&o>u?e():void i())})},t)},function(e){(0===u.length||o<u)&&(u=o,l=r),e()}],e)},function(e){if(e)return i(e);o.update(u),t=l,i()})},e)}],function(e){n(e,{hash:o.digest(),issuer:t})})},t.prototype.createHashToRelated=function(t,n,r){var a=this,o={},i=a.blankNodeInfo[t].quads;a.forEach(i,function(r,i,l){a.forEach(r,function(i,l,u){if("predicate"===l||"blank node"!==i.type||i.value===t)return u();var s=i.value,c=e[l];a.hashRelatedBlankNode(s,r,n,c,function(e,t){if(e)return u(e);t in o?o[t].push(s):o[t]=[s],u()})},l)},function(e){r(e,o)})},t.prototype.forEachComponent=function(e,t){for(var n in e)"predicate"!==n&&t(e[n],n,e)},t}(),De=function(){var e=function(e){Se.call(this,e),this.name="URGNA2012"};return e.prototype=new Se,e.prototype.modifyFirstDegreeComponent=function(e,t,n){return"blank node"!==t.type?t:(t=W(t),t.value="name"===n?"_:g":t.value===e?"_:a":"_:z",t)},e.prototype.getRelatedPredicate=function(e){return e.predicate.value},e.prototype.createHashToRelated=function(e,t,n){var r=this,a={},o=r.blankNodeInfo[e].quads;r.forEach(o,function(n,o,i){var l,u;if("blank node"===n.subject.type&&n.subject.value!==e)u=n.subject.value,l="p";else{if("blank node"!==n.object.type||n.object.value===e)return i();u=n.object.value,l="r"}r.hashRelatedBlankNode(u,n,t,l,function(e,t){t in a?a[t].push(u):a[t]=[u],i()})},function(e){n(e,a)})},e}();Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on non-object");var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),n.registerRDFParser("application/nquads",K),n.registerRDFParser("rdfa-api",ne),n.IdentifierIssuer=re,n.UniqueNamer=re,re.prototype.clone=function(){var e=new re(this.prefix);return e.counter=this.counter,e.existing=W(this.existing),e},re.prototype.getId=function(e){if(e&&e in this.existing)return this.existing[e];var t=this.prefix+this.counter;return this.counter+=1,e&&(this.existing[e]=t),t},re.prototype.getName=re.prototype.getName,re.prototype.hasId=function(e){return e in this.existing},re.prototype.isNamed=re.prototype.hasId;var Ne=function(e){this.list=e.sort(),this.done=!1,this.left={};for(var t=0;t<e.length;++t)this.left[e[t]]=!0};Ne.prototype.hasNext=function(){return!this.done},Ne.prototype.next=function(){for(var e=this.list.slice(),t=null,n=0,r=this.list.length,a=0;a<r;++a){var o=this.list[a],i=this.left[o];(null===t||o>t)&&(i&&a>0&&o>this.list[a-1]||!i&&a<r-1&&o>this.list[a+1])&&(t=o,n=a)}if(null===t)this.done=!0;else{var l=this.left[t]?n-1:n+1;this.list[n]=this.list[l],this.list[l]=t;for(var a=0;a<r;++a)this.list[a]>t&&(this.left[this.list[a]]=!this.left[this.list[a]])}return e};var Ce=function(e){if(!(this instanceof Ce))return new Ce(e);if(-1===["URDNA2015","URGNA2012"].indexOf(e))throw new Error("Invalid RDF Dataset Normalization algorithm: "+e);Ce._init.call(this,e)};if(Ce.hashNQuads=function(e,t){for(var n=new Ce(e),r=0;r<t.length;++r)n.update(t[r]);return n.digest()},function(e){if(e){var t=require("crypto");return Ce._init=function(e){e="URDNA2015"===e?"sha256":"sha1",this.md=t.createHash(e)},Ce.prototype.update=function(e){return this.md.update(e,"utf8")},void(Ce.prototype.digest=function(){return this.md.digest("hex")})}Ce._init=function(e){e="URDNA2015"===e?new a.Algorithm:new r.Algorithm,this.md=new n(e)},Ce.prototype.update=function(e){return this.md.update(e)},Ce.prototype.digest=function(){return this.md.digest().toHex()};var n=function(e){if(!(this instanceof n))return new n(e);if(this._algorithm=e,!n._padding||n._padding.length<this._algorithm.blockSize){n._padding=String.fromCharCode(128);for(var t=String.fromCharCode(0),r=64;r>0;)1&r&&(n._padding+=t),(r>>>=1)>0&&(t+=t)}this.start()};n.prototype.start=function(){this.messageLength=0,this.fullMessageLength=[];for(var e=this._algorithm.messageLengthSize/4,t=0;t<e;++t)this.fullMessageLength.push(0);return this._input=new n.ByteBuffer,this.state=this._algorithm.start(),this},n.prototype.update=function(e){e=new n.ByteBuffer(unescape(encodeURIComponent(e))),this.messageLength+=e.length();var t=e.length();t=[t/4294967296>>>0,t>>>0];for(var r=this.fullMessageLength.length-1;r>=0;--r)this.fullMessageLength[r]+=t[1],t[1]=t[0]+(this.fullMessageLength[r]/4294967296>>>0),this.fullMessageLength[r]=this.fullMessageLength[r]>>>0,t[0]=t[1]/4294967296>>>0;for(this._input.putBytes(e.bytes());this._input.length()>=this._algorithm.blockSize;)this.state=this._algorithm.digest(this.state,this._input);return(this._input.read>2048||0===this._input.length())&&this._input.compact(),this},n.prototype.digest=function(){var e=new n.ByteBuffer;e.putBytes(this._input.bytes());var t=this.fullMessageLength[this.fullMessageLength.length-1]+this._algorithm.messageLengthSize,r=t&this._algorithm.blockSize-1;e.putBytes(n._padding.substr(0,this._algorithm.blockSize-r));for(var a=new n.ByteBuffer,o=0;o<this.fullMessageLength.length;++o)a.putInt32(this.fullMessageLength[o]<<3|this.fullMessageLength[o+1]>>>28);this._algorithm.writeMessageLength(e,a);var i=this._algorithm.digest(this.state.copy(),e),l=new n.ByteBuffer;return i.write(l),l},n.ByteBuffer=function(e){this.data="string"==typeof e?e:"",this.read=0},n.ByteBuffer.prototype.putInt32=function(e){this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)},n.ByteBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},n.ByteBuffer.prototype.putBytes=function(e){this.data+=e},n.ByteBuffer.prototype.bytes=function(){return this.data.slice(this.read)},n.ByteBuffer.prototype.length=function(){return this.data.length-this.read},n.ByteBuffer.prototype.compact=function(){this.data=this.data.slice(this.read),this.read=0},n.ByteBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);n<16&&(e+="0"),e+=n.toString(16)}return e};var r={_w:null};r.Algorithm=function(){this.name="sha1",this.blockSize=64,this.digestLength=20,this.messageLengthSize=8},r.Algorithm.prototype.start=function(){return r._w||(r._w=new Array(80)),r._createState()},r.Algorithm.prototype.writeMessageLength=function(e,t){e.putBytes(t.bytes())},r.Algorithm.prototype.digest=function(e,t){for(var n,a,o,i,l,u,s,c,d=t.length(),f=r._w;d>=64;){for(a=e.h0,o=e.h1,i=e.h2,l=e.h3,u=e.h4,c=0;c<16;++c)n=t.getInt32(),f[c]=n,s=l^o&(i^l),n=(a<<5|a>>>27)+s+u+1518500249+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;c<20;++c)n=f[c-3]^f[c-8]^f[c-14]^f[c-16],n=n<<1|n>>>31,f[c]=n,s=l^o&(i^l),n=(a<<5|a>>>27)+s+u+1518500249+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;c<32;++c)n=f[c-3]^f[c-8]^f[c-14]^f[c-16],n=n<<1|n>>>31,f[c]=n,s=o^i^l,n=(a<<5|a>>>27)+s+u+1859775393+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;c<40;++c)n=f[c-6]^f[c-16]^f[c-28]^f[c-32],n=n<<2|n>>>30,f[c]=n,s=o^i^l,n=(a<<5|a>>>27)+s+u+1859775393+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;c<60;++c)n=f[c-6]^f[c-16]^f[c-28]^f[c-32],n=n<<2|n>>>30,f[c]=n,s=o&i|l&(o^i),n=(a<<5|a>>>27)+s+u+2400959708+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;for(;c<80;++c)n=f[c-6]^f[c-16]^f[c-28]^f[c-32],n=n<<2|n>>>30,f[c]=n,s=o^i^l,n=(a<<5|a>>>27)+s+u+3395469782+n,u=l,l=i,i=o<<30|o>>>2,o=a,a=n;e.h0=e.h0+a|0,e.h1=e.h1+o|0,e.h2=e.h2+i|0,e.h3=e.h3+l|0,e.h4=e.h4+u|0,d-=64}return e},r._createState=function(){var e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520};return e.copy=function(){var t=r._createState();return t.h0=e.h0,t.h1=e.h1,t.h2=e.h2,t.h3=e.h3,t.h4=e.h4,t},e.write=function(t){t.putInt32(e.h0),t.putInt32(e.h1),t.putInt32(e.h2),t.putInt32(e.h3),t.putInt32(e.h4)},e};var a={_k:null,_w:null};a.Algorithm=function(){this.name="sha256",this.blockSize=64,this.digestLength=32,this.messageLengthSize=8},a.Algorithm.prototype.start=function(){return a._k||a._init(),a._createState()},a.Algorithm.prototype.writeMessageLength=function(e,t){e.putBytes(t.bytes())},a.Algorithm.prototype.digest=function(e,t){for(var n,r,o,i,l,u,s,c,d,f,p,h,v,g,y,m=t.length(),x=a._k,b=a._w;m>=64;){for(s=0;s<16;++s)b[s]=t.getInt32();for(;s<64;++s)n=b[s-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,r=b[s-15],r=(r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,b[s]=n+b[s-7]+r+b[s-16]|0;for(c=e.h0,d=e.h1,f=e.h2,p=e.h3,h=e.h4,v=e.h5,g=e.h6,y=e.h7,s=0;s<64;++s)i=(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7),l=g^h&(v^g),o=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),u=c&d|f&(c^d),n=y+i+l+x[s]+b[s],r=o+u,y=g,g=v,v=h,h=p+n|0,p=f,f=d,d=c,c=n+r|0;e.h0=e.h0+c|0,e.h1=e.h1+d|0,e.h2=e.h2+f|0,e.h3=e.h3+p|0,e.h4=e.h4+h|0,e.h5=e.h5+v|0,e.h6=e.h6+g|0,e.h7=e.h7+y|0,m-=64}return e},a._createState=function(){var e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225};return e.copy=function(){var t=a._createState();return t.h0=e.h0,t.h1=e.h1,t.h2=e.h2,t.h3=e.h3,t.h4=e.h4,t.h5=e.h5,t.h6=e.h6,t.h7=e.h7,t},e.write=function(t){t.putInt32(e.h0),t.putInt32(e.h1),t.putInt32(e.h2),t.putInt32(e.h3),t.putInt32(e.h4),t.putInt32(e.h5),t.putInt32(e.h6),t.putInt32(e.h7)},e},a._init=function(){a._k=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a._w=new Array(64)}}(e),!se)var Re=function(){se=require("xmldom").XMLSerializer};if(n.url={},n.url.parsers={simple:{keys:["href","scheme","authority","path","query","fragment"],regex:/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},full:{keys:["href","protocol","scheme","authority","auth","user","password","hostname","port","path","directory","file","query","fragment"],regex:/^(([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(?:(((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},n.url.parse=function(e,t){for(var r={},a=n.url.parsers[t||"full"],o=a.regex.exec(e),i=a.keys.length;i--;)r[a.keys[i]]=void 0===o[i]?null:o[i];return r.normalizedPath=ae(r.path,!!r.authority),r},e?n.useDocumentLoader("node"):"undefined"!=typeof XMLHttpRequest&&n.useDocumentLoader("xhr"),e){n.use=function(e){switch(e){case"request":n.request=require("jsonld-request");break;default:throw new Oe("Unknown extension.","jsonld.UnknownExtension",{extension:e})}};var _e={exports:{},filename:__dirname};require("pkginfo")(_e,"version"),n.version=_e.exports.version}return n},r=function(){return n(function(){return r()})};!e&&"function"==typeof define&&define.amd?define([],function(){return n(r),r}):(n(r),"function"==typeof require&&"undefined"!=typeof module&&module.exports&&(module.exports=r),t&&("undefined"==typeof jsonld?jsonld=jsonldjs=r:jsonldjs=r))}();
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},"/node_modules/jsonld/js")

},{"_process":23,"crypto":12,"es6-promise":6,"http":12,"jsonld-request":12,"pkginfo":12,"request":12,"util":12,"xmldom":undefined}],14:[function(require,module,exports){
var globalRequire=require;require=function(){};var exports=module.exports={Lexer:require("./lib/N3Lexer"),Parser:require("./lib/N3Parser"),Writer:require("./lib/N3Writer"),Store:require("./lib/N3Store"),StreamParser:require("./lib/N3StreamParser"),StreamWriter:require("./lib/N3StreamWriter"),Util:require("./lib/N3Util")};Object.keys(exports).forEach(function(e){Object.defineProperty(exports,e,{configurable:!0,enumerable:!0,get:function(){return delete exports[e],exports[e]=globalRequire("./lib/N3"+e)}})});
},{"./lib/N3Lexer":15,"./lib/N3Parser":16,"./lib/N3Store":17,"./lib/N3StreamParser":18,"./lib/N3StreamWriter":19,"./lib/N3Util":20,"./lib/N3Writer":21}],15:[function(require,module,exports){
function N3Lexer(e){if(!(this instanceof N3Lexer))return new N3Lexer(e);if(e&&e.lineMode){this._tripleQuotedString=this._number=this._boolean=/$0^/;var f=this;this._tokenize=this.tokenize,this.tokenize=function(e,u){this._tokenize(e,function(e,t){!e&&/^(?:IRI|prefixed|literal|langcode|type|\.|eof)$/.test(t.type)?u&&u(e,t):u&&u(e||f._syntaxError(t.type,u=null))})}}}var fromCharCode=String.fromCharCode,immediately="function"==typeof setImmediate?setImmediate:function(e){setTimeout(e,0)},escapeSequence=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,escapeReplacements={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"\t",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},illegalIriChars=/[\x00-\x20<>\\"\{\}\|\^\`]/;N3Lexer.prototype={_iri:/^<((?:[^>\\]|\\[uU])+)>/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>/,_unescapedString:/^"[^"\\]+"(?=[^"\\])/,_singleQuotedString:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?=\.?[,;\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=\.?[,;:\s#()\[\]\{\}"'<])/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=[.,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;:\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<:])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(e,f){function u(f){e(f._syntaxError(/^\S*/.exec(t)[0]))}for(var t=this._input;;){for(var i;i=this._newline.exec(t);)t=t.substr(i[0].length,t.length),this._line++;if((i=this._whitespace.exec(t))&&(t=t.substr(i[0].length,t.length)),this._endOfFile.test(t))return f&&e(t=null,{line:this._line,type:"eof",value:"",prefix:""}),this._input=t;var n,r=this._line,d="",s="",a="",c=t[0],o=null,l=0,x=!1;switch(c){case"^":if(1===t.length)break;if("^"!==t[1])return u(this);if(this._prevTokenType="^",t=t.substr(2),"<"!==t[0]){x=!0;break}case"<":if(o=this._unescapedIri.exec(t))d="IRI",s=o[1];else if(o=this._iri.exec(t)){if(null===(n=this._unescape(o[1]))||illegalIriChars.test(n))return u(this);d="IRI",s=n}break;case"_":((o=this._blank.exec(t))||f&&(o=this._blank.exec(t+" ")))&&(d="prefixed",a="_",s=o[1]);break;case'"':case"'":if(o=this._unescapedString.exec(t))d="literal",s=o[0];else if(o=this._singleQuotedString.exec(t)){if(null===(n=this._unescape(o[0])))return u(this);d="literal",s=n.replace(/^'|'$/g,'"')}else if(o=this._tripleQuotedString.exec(t)){if(n=o[1]||o[2],this._line+=n.split(/\r\n|\r|\n/).length-1,null===(n=this._unescape(n)))return u(this);d="literal",s=n.replace(/^'|'$/g,'"')}break;case"@":"literal"===this._prevTokenType&&(o=this._langcode.exec(t))?(d="langcode",s=o[1]):(o=this._keyword.exec(t))&&(d=o[0]);break;case".":if(1===t.length?f:t[1]<"0"||t[1]>"9"){d=".",l=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(o=this._number.exec(t))&&(d="literal",s='"'+o[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(o[1]?"double":/^[+\-]?\d+$/.test(o[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":case"G":case"g":(o=this._sparqlKeyword.exec(t))?d=o[0].toUpperCase():x=!0;break;case"f":case"t":(o=this._boolean.exec(t))?(d="literal",s='"'+o[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):x=!0;break;case"a":(o=this._shortPredicates.exec(t))?(d="abbreviation",s="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):x=!0;break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":l=1,d=c;break;default:x=!0}if(x&&("@prefix"!==this._prevTokenType&&"PREFIX"!==this._prevTokenType||!(o=this._prefix.exec(t))?((o=this._prefixed.exec(t))||f&&(o=this._prefixed.exec(t+" ")))&&(d="prefixed",a=o[1]||"",s=this._unescape(o[2])):(d="prefix",s=o[1]||"")),"^"===this._prevTokenType&&(d="IRI"===d||"prefixed"===d?"type":""),!d)return f||!/^'''|^"""/.test(t)&&/\n|\r/.test(t)?u(this):this._input=t;e(null,{line:r,type:d,value:s,prefix:a}),this._prevTokenType=d,t=t.substr(l||o[0].length,t.length)}},_unescape:function(e){try{return e.replace(escapeSequence,function(e,f,u,t){var i;if(f){if(i=parseInt(f,16),isNaN(i))throw new Error;return fromCharCode(i)}if(u){if(i=parseInt(u,16),isNaN(i))throw new Error;return i<=65535?fromCharCode(i):fromCharCode(55296+(i-=65536)/1024,56320+(1023&i))}var n=escapeReplacements[t];if(!n)throw new Error;return n})}catch(e){return null}},_syntaxError:function(e){return this._input=null,new Error('Syntax error: unexpected "'+e+'" on line '+this._line+".")},tokenize:function(e,f){function u(e){null!==i._input&&(i._input+=e,i._tokenizeToEnd(f,!1))}function t(){null!==i._input&&i._tokenizeToEnd(f,!0)}var i=this;this._line=1,"string"==typeof e?(this._input=e,immediately(function(){i._tokenizeToEnd(f,!0)})):(this._input="",e&&"function"!=typeof e?("function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",u),e.on("end",t)):(this.addChunk=u,this.end=t,f||(f=e)))}},module.exports=N3Lexer;
},{}],16:[function(require,module,exports){
function N3Parser(e){if(!(this instanceof N3Parser))return new N3Parser(e);this._tripleStack=[],this._graph=null,e=e||{},this._setBase(e.documentIRI);var t="string"==typeof e.format&&e.format.match(/\w*$/)[0].toLowerCase(),r="turtle"===t,a="trig"===t,s=/triple/.test(t),i=/quad/.test(t),n=s||i;(this._supportsNamedGraphs=!r)||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(r||a||s),n&&(this._base="",this._resolveIRI=function(e){return this._error("Disallowed relative IRI",e),this._callback=noop,this._subject=null}),this._blankNodePrefix="string"!=typeof e.blankNodePrefix?"":"_:"+e.blankNodePrefix.replace(/^_:/,""),this._lexer=e.lexer||new N3Lexer({lineMode:n})}function noop(){}var N3Lexer=require("./N3Lexer"),RDF_PREFIX="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDF_NIL=RDF_PREFIX+"nil",RDF_FIRST=RDF_PREFIX+"first",RDF_REST=RDF_PREFIX+"rest",absoluteIRI=/^[a-z][a-z0-9+.-]*:/i,schemeAuthority=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,dotSegments=/(?:^|\/)\.\.?(?:$|[\/#?])/,blankNodePrefix=0,blankNodeCount=0;N3Parser._resetBlankNodeIds=function(){blankNodePrefix=blankNodeCount=0},N3Parser.prototype={_setBase:function(e){if(e){if(e.indexOf("#")>=0)throw new Error("Invalid base IRI "+e)}else e=null;(this._base=e)&&(this._basePath=e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(schemeAuthority),this._baseRoot=e[0],this._baseScheme=e[1])},_readInTopContext:function(e){switch(e.type){case"eof":return null!==this._graph?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"@prefix":return this._sparqlStyle=!1,this._readPrefix;case"PREFIX":return this._sparqlStyle=!0,this._readPrefix;case"@base":return this._sparqlStyle=!1,this._readBaseIRI;case"BASE":return this._sparqlStyle=!0,this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}},_readSubject:function(e){switch(this._predicate=null,e.type){case"IRI":null===this._base||absoluteIRI.test(e.value)?this._subject=e.value:this._subject=this._resolveIRI(e);break;case"prefixed":var t=this._prefixes[e.prefix];if(void 0===t)return this._error('Undefined prefix "'+e.prefix+':"',e);this._subject=t+e.value;break;case"[":return this._subject="_:b"+blankNodeCount++,this._tripleStack.push({subject:this._subject,predicate:null,object:null,type:"blank"}),this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:RDF_NIL,predicate:null,object:null,type:"list"}),this._subject=null,this._readListItem;case"}":return this._readPunctuation(e);default:return this._error("Expected subject but got "+e.type,e)}return this._readPredicateOrNamedGraph},_readPredicate:function(e){var t=e.type;switch(t){case"IRI":case"abbreviation":null===this._base||absoluteIRI.test(e.value)?this._predicate=e.value:this._predicate=this._resolveIRI(e);break;case"prefixed":if("_"===e.prefix)return this._error("Disallowed blank node as predicate",e);var r=this._prefixes[e.prefix];if(void 0===r)return this._error('Undefined prefix "'+e.prefix+':"',e);this._predicate=r+e.value;break;case".":case"]":case"}":return null===this._predicate?this._error("Unexpected "+t,e):(this._subject=null,"]"===t?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._readPredicate;default:return this._error('Expected predicate to follow "'+this._subject+'"',e)}return this._readObject},_readObject:function(e){switch(e.type){case"IRI":null===this._base||absoluteIRI.test(e.value)?this._object=e.value:this._object=this._resolveIRI(e);break;case"prefixed":var t=this._prefixes[e.prefix];if(void 0===t)return this._error('Undefined prefix "'+e.prefix+':"',e);this._object=t+e.value;break;case"literal":return this._object=e.value,this._readDataTypeOrLang;case"[":var r="_:b"+blankNodeCount++;return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:r,type:"blank"}),this._subject=r,this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:RDF_NIL,type:"list"}),this._subject=null,this._readListItem;default:return this._error('Expected object to follow "'+this._predicate+'"',e)}return this._getTripleEndReader()},_readPredicateOrNamedGraph:function(e){return"{"===e.type?this._readGraph(e):this._readPredicate(e)},_readGraph:function(e){return"{"!==e.type?this._error("Expected graph but got "+e.type,e):(this._graph=this._subject,this._subject=null,this._readSubject)},_readBlankNodeHead:function(e){return"]"===e.type?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))},_readBlankNodeTail:function(e){if("]"!==e.type)return this._readBlankNodePunctuation(e);null!==this._subject&&this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""});var t=this._tripleStack.pop();return this._subject=t.subject,null!==t.object?(this._predicate=t.predicate,this._object=t.object,this._getTripleEndReader()):null!==this._predicate?this._readPredicate:this._readPredicateOrNamedGraph},_readDataTypeOrLang:function(e){switch(e.type){case"type":var t;if(""===e.prefix)t=null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e);else{var r=this._prefixes[e.prefix];if(void 0===r)return this._error('Undefined prefix "'+e.prefix+':"',e);t=r+e.value}return this._object+="^^"+t,this._getTripleEndReader();case"langcode":return this._object+="@"+e.value.toLowerCase(),this._getTripleEndReader();default:return this._getTripleEndReader().call(this,e)}},_readListItem:function(e){var t=null,r=null,a=this._subject,s=this._tripleStack,i=s[s.length-1],n=this._readListItem;switch(e.type){case"IRI":t=null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e);break;case"prefixed":var l=this._prefixes[e.prefix];if(void 0===l)return this._error('Undefined prefix "'+e.prefix+':"',e);t=l+e.value;break;case"literal":t=e.value,n=this._readDataTypeOrLang;break;case"[":r="_:b"+blankNodeCount++,t="_:b"+blankNodeCount++,s.push({subject:r,predicate:RDF_FIRST,object:t,type:"blank"}),this._subject=t,n=this._readBlankNodeHead;break;case"(":r="_:b"+blankNodeCount++,s.push({subject:r,predicate:RDF_FIRST,object:RDF_NIL,type:"list"}),this._subject=null,n=this._readListItem;break;case")":if(s.pop(),0!==s.length&&"list"===s[s.length-1].type&&this._callback(null,{subject:i.subject,predicate:i.predicate,object:i.object,graph:this._graph||""}),this._subject=i.subject,null===i.predicate){if(n=this._readPredicate,i.subject===RDF_NIL)return n}else if(this._predicate=i.predicate,this._object=i.object,n=this._getTripleEndReader(),i.object===RDF_NIL)return n;r=RDF_NIL;break;default:return this._error('Expected list item instead of "'+e.type+'"',e)}return null===r&&(this._subject=r="_:b"+blankNodeCount++),null===a?i.object===RDF_NIL?i.object=r:i.subject=r:this._callback(null,{subject:a,predicate:RDF_REST,object:r,graph:this._graph||""}),null!==t&&this._callback(null,{subject:r,predicate:RDF_FIRST,object:t,graph:this._graph||""}),n},_readPunctuation:function(e){var t,r=this._subject,a=this._graph;switch(e.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",e);this._graph=null;case".":this._subject=null,t=this._readInTopContext;break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;case"IRI":if(this._supportsQuads&&null===this._graph){a=null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e),r=this._subject,t=this._readQuadPunctuation;break}case"prefixed":if(this._supportsQuads&&null===this._graph){var s=this._prefixes[e.prefix];if(void 0===s)return this._error('Undefined prefix "'+e.prefix+':"',e);a=s+e.value,t=this._readQuadPunctuation;break}default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return null!==r&&this._callback(null,{subject:r,predicate:this._predicate,object:this._object,graph:a||""}),t},_readBlankNodePunctuation:function(e){var t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""}),t},_readQuadPunctuation:function(e){return"."!==e.type?this._error("Expected dot to follow quad",e):this._readInTopContext},_readPrefix:function(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)},_readPrefixIRI:function(e){if("IRI"!==e.type)return this._error('Expected IRI to follow prefix "'+this._prefix+':"',e);var t;return t=null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e),this._prefixes[this._prefix]=t,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation},_readBaseIRI:function(e){if("IRI"!==e.type)return this._error("Expected IRI to follow base declaration",e);try{this._setBase(null===this._base||absoluteIRI.test(e.value)?e.value:this._resolveIRI(e))}catch(t){this._error(t.message,e)}return this._readDeclarationPunctuation},_readNamedGraphLabel:function(e){switch(e.type){case"IRI":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}},_readNamedGraphBlankLabel:function(e){return"]"!==e.type?this._error("Invalid graph label",e):(this._subject="_:b"+blankNodeCount++,this._readGraph)},_readDeclarationPunctuation:function(e){return this._sparqlStyle?this._readInTopContext(e):"."!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext},_getTripleEndReader:function(){var e=this._tripleStack;if(0===e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem}},_error:function(e,t){this._callback(new Error(e+" at line "+t.line+"."))},_resolveIRI:function(e){var t=e.value;switch(t[0]){case void 0:return this._base;case"#":return this._base+t;case"?":return this._base.replace(/(?:\?.*)?$/,t);case"/":return("/"===t[1]?this._baseScheme:this._baseRoot)+this._removeDotSegments(t);default:return this._removeDotSegments(this._basePath+t)}},_removeDotSegments:function(e){if(!dotSegments.test(e))return e;for(var t="",r=e.length,a=-1,s=-1,i=0,n="/";a<r;){switch(n){case":":if(s<0&&"/"===e[++a]&&"/"===e[++a])for(;(s=a+1)<r&&"/"!==e[s];)a=s;break;case"?":case"#":a=r;break;case"/":if("."===e[a+1])switch(n=e[++a+1]){case"/":t+=e.substring(i,a-1),i=a+1;break;case void 0:case"?":case"#":return t+e.substring(i,a)+e.substr(a+1);case".":if(void 0===(n=e[++a+1])||"/"===n||"?"===n||"#"===n){if(t+=e.substring(i,a-2),(i=t.lastIndexOf("/"))>=s&&(t=t.substr(0,i)),"/"!==n)return t+"/"+e.substr(a+1);i=a+1}}}n=e[++a]}return t+e.substring(i)},parse:function(e,t,r){this._readCallback=this._readInTopContext,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix||"_:b"+blankNodePrefix+++"_","function"==typeof e&&(r=t,t=e,e=null),this._callback=t||noop,this._prefixCallback=r||noop;var a=this;this._lexer.tokenize(e,function(e,t){null!==e?(a._callback(e),a._callback=noop):void 0!==a._readCallback&&(a._readCallback=a._readCallback(t))}),e||(this.addChunk=this._lexer.addChunk,this.end=this._lexer.end)}},module.exports=N3Parser;
},{"./N3Lexer":15}],17:[function(require,module,exports){
function N3Store(e,t){if(!(this instanceof N3Store))return new N3Store(e,t);this._size=0,this._graphs=Object.create(null),this._entities=Object.create(null),this._entities["><"]=0,this._entityCount=0,this._blankNodeIndex=0,t||!e||e[0]||(t=e,e=null),this._prefixes=Object.create(null),t&&t.prefixes&&this.addPrefixes(t.prefixes),e&&this.addTriples(e)}var expandPrefixedName=require("./N3Util").expandPrefixedName;N3Store.prototype={get size(){var e=this._size;if(null!==e)return e;var t,i,n=this._graphs;for(var r in n)for(var s in t=n[r].subjects)for(var d in i=t[s])e+=Object.keys(i[d]).length;return this._size=e},_addToIndex:function(e,t,i,n){var r=e[t]||(e[t]={});(r[i]||(r[i]={}))[n]=null},_removeFromIndex:function(e,t,i,n){var r,s=e[t],d=s[i];delete d[n];for(r in d)return;delete s[i];for(r in s)return;delete e[t]},_findInIndex:function(e,t,i,n,r,s,d,a){var o,c,u,h=[],f=Object.keys(this._entities);t&&((o=e,e={})[t]=o[t]);for(var _ in e){var l=f[_];if(c=e[_]){i&&((o=c,c={})[i]=o[i]);for(var x in c){var p=f[x];if(u=c[x])for(var b=(n?n in u?[n]:[]:Object.keys(u)),j=b.length-1;j>=0;j--){var I={subject:"",predicate:"",object:"",graph:a};I[r]=l,I[s]=p,I[d]=f[b[j]],h.push(I)}}}}return h},_countInIndex:function(e,t,i,n){var r,s,d,a=0;t&&((r=e,e={})[t]=r[t]);for(var o in e)if(s=e[o]){i&&((r=s,s={})[i]=r[i]);for(var c in s)(d=s[c])&&(n?n in d&&a++:a+=Object.keys(d).length)}return a},addTriple:function(e,t,i,n){t||(n=e.graph,i=e.object,t=e.predicate,e=e.subject),n=n||"";var r=this._graphs[n];r||(r=this._graphs[n]={subjects:{},predicates:{},objects:{}},Object.freeze(r));var s=this._entities;e=s[e]||(s[e]=++this._entityCount),t=s[t]||(s[t]=++this._entityCount),i=s[i]||(s[i]=++this._entityCount),this._addToIndex(r.subjects,e,t,i),this._addToIndex(r.predicates,t,i,e),this._addToIndex(r.objects,i,e,t),this._size=null},addTriples:function(e){for(var t=e.length-1;t>=0;t--)this.addTriple(e[t])},addPrefix:function(e,t){this._prefixes[e]=t},addPrefixes:function(e){for(var t in e)this.addPrefix(t,e[t])},removeTriple:function(e,t,i,n){t||(n=e.graph,i=e.object,t=e.predicate,e=e.subject),n=n||"";var r,s=this._entities,d=this._graphs;if((e=s[e])&&(t=s[t])&&(i=s[i])&&(r=d[n])){var a,o;if((a=r.subjects[e])&&(o=a[t])&&i in o){this._removeFromIndex(r.subjects,e,t,i),this._removeFromIndex(r.predicates,t,i,e),this._removeFromIndex(r.objects,i,e,t),null!==this._size&&this._size--;for(e in r.subjects)return;delete d[n]}}},removeTriples:function(e){for(var t=e.length-1;t>=0;t--)this.removeTriple(e[t])},find:function(e,t,i,n){var r=this._prefixes;return this.findByIRI(expandPrefixedName(e,r),expandPrefixedName(t,r),expandPrefixedName(i,r),expandPrefixedName(n,r))},findByIRI:function(e,t,i,n){n=n||"";var r=this._graphs[n],s=this._entities;return r?e&&!(e=s[e])?[]:t&&!(t=s[t])?[]:i&&!(i=s[i])?[]:e?i?this._findInIndex(r.objects,i,e,t,"object","subject","predicate",n):this._findInIndex(r.subjects,e,t,null,"subject","predicate","object",n):t?this._findInIndex(r.predicates,t,i,null,"predicate","object","subject",n):i?this._findInIndex(r.objects,i,null,null,"object","subject","predicate",n):this._findInIndex(r.subjects,null,null,null,"subject","predicate","object",n):[]},count:function(e,t,i,n){var r=this._prefixes;return this.countByIRI(expandPrefixedName(e,r),expandPrefixedName(t,r),expandPrefixedName(i,r),expandPrefixedName(n,r))},countByIRI:function(e,t,i,n){n=n||"";var r=this._graphs[n],s=this._entities;return r?e&&!(e=s[e])?0:t&&!(t=s[t])?0:i&&!(i=s[i])?0:e?i?this._countInIndex(r.objects,i,e,t):this._countInIndex(r.subjects,e,t,i):t?this._countInIndex(r.predicates,t,i,e):this._countInIndex(r.objects,i,e,t):0},createBlankNode:function(e){var t,i;if(e)for(t=e="_:"+e,i=1;this._entities[t];)t=e+i++;else do{t="_:b"+this._blankNodeIndex++}while(this._entities[t]);return this._entities[t]=++this._entityCount,t}},module.exports=N3Store;
},{"./N3Util":20}],18:[function(require,module,exports){
function N3StreamParser(r){if(!(this instanceof N3StreamParser))return new N3StreamParser(r);Transform.call(this,{decodeStrings:!0}),this._readableState.objectMode=!0;var e=this,t=new N3Parser(r);t.parse(function(r,t){t&&e.push(t)||r&&e.emit("error",r)},this.emit.bind(this,"prefix")),this._transform=function(r,e,s){t.addChunk(r),s()},this._flush=function(r){t.end(),r()}}var Transform=require("stream").Transform,util=require("util"),N3Parser=require("./N3Parser.js");util.inherits(N3StreamParser,Transform),module.exports=N3StreamParser;
},{"./N3Parser.js":16,"stream":38,"util":43}],19:[function(require,module,exports){
function N3StreamWriter(r){if(!(this instanceof N3StreamWriter))return new N3StreamWriter(r);Transform.call(this,{encoding:"utf8"}),this._writableState.objectMode=!0;var t=this,e=new N3Writer({write:function(r,e,i){t.push(r),i&&i()},end:function(r){t.push(null),r&&r()}},r);this._transform=function(r,t,i){e.addTriple(r,i)},this._flush=function(r){e.end(r)}}var Transform=require("stream").Transform,util=require("util"),N3Writer=require("./N3Writer.js");util.inherits(N3StreamWriter,Transform),module.exports=N3StreamWriter;
},{"./N3Writer.js":21,"stream":38,"util":43}],20:[function(require,module,exports){
function addN3Util(t,e){for(var r in N3Util)e?t.prototype[r]=applyToThis(N3Util[r]):t[r]=N3Util[r];return t}function applyToThis(t){return function(e){return t(this,e)}}var Xsd="http://www.w3.org/2001/XMLSchema#",XsdString=Xsd+"string",XsdInteger=Xsd+"integer",XsdDecimal=Xsd+"decimal",XsdBoolean=Xsd+"boolean",RdfLangString="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",N3Util={isIRI:function(t){if(!t)return t;var e=t[0];return'"'!==e&&"_"!==e},isLiteral:function(t){return t&&'"'===t[0]},isBlank:function(t){return t&&"_:"===t.substr(0,2)},getLiteralValue:function(t){var e=/^"([^]*)"/.exec(t);if(!e)throw new Error(t+" is not a literal");return e[1]},getLiteralType:function(t){var e=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(t);if(!e)throw new Error(t+" is not a literal");return e[1]||(e[2]?RdfLangString:XsdString)},getLiteralLanguage:function(t){var e=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(t);if(!e)throw new Error(t+" is not a literal");return e[1]?e[1].toLowerCase():""},isPrefixedName:function(t){return t&&/^[^:\/"']*:[^:\/"']+$/.test(t)},expandPrefixedName:function(t,e){var r,n,i,a=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]*$/.exec(t);return a&&(r=a[1],n=e[r],i=a.index),void 0===n?t:0===i?n+t.substr(r.length+1):t.substr(0,i+3)+n+t.substr(i+r.length+4)},createIRI:function(t){return t&&'"'===t[0]?N3Util.getLiteralValue(t):t},createLiteral:function(t,e){if(!e)switch(typeof t){case"boolean":e=XsdBoolean;break;case"number":if(isFinite(t)){e=t%1==0?XsdInteger:XsdDecimal;break}default:return'"'+t+'"'}return'"'+t+(/^[a-z]+(-[a-z0-9]+)*$/i.test(e)?'"@'+e.toLowerCase():'"^^'+e)}};module.exports=addN3Util(addN3Util);
},{}],21:[function(require,module,exports){
function N3Writer(e,t){if(!(this instanceof N3Writer))return new N3Writer(e,t);if(e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},e)this._outputStream=e,this._endStream=void 0===t.end||!!t.end;else{var r="";this._outputStream={write:function(e,t,i){r+=e,i&&i()},end:function(e){e&&e(null,r)}},this._endStream=!0}this._subject=null,/triple|quad/i.test(t.format)?this._writeTriple=this._writeTripleLine:(this._graph="",this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes))}function characterReplacer(e){var t=escapeReplacements[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}var N3LiteralMatcher=/^"([^]*)"(?:\^\^(.+)|@([\-a-z]+))?$/i,RDF_PREFIX="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDF_TYPE=RDF_PREFIX+"type",escape=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,escapeAll=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,escapeReplacements={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};N3Writer.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeTriple:function(e,t,r,i,n){try{this._graph!==i&&(this._write((null===this._subject?"":this._graph?"\n}\n":".\n")+(i?this._encodeIriOrBlankNode(i)+" {\n":"")),this._subject=null,this._graph="["!==i[0]?i:"]"),this._subject===e?this._predicate===t?this._write(", "+this._encodeObject(r),n):this._write(";\n    "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(r),n):this._write((null===this._subject?"":".\n")+this._encodeSubject(this._subject=e)+" "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(r),n)}catch(e){n&&n(e)}},_writeTripleLine:function(e,t,r,i,n){delete this._prefixMatch;try{this._write(this._encodeIriOrBlankNode(e)+" "+this._encodeIriOrBlankNode(t)+" "+this._encodeObject(r)+(i?" "+this._encodeIriOrBlankNode(i)+".\n":".\n"),n)}catch(e){n&&n(e)}},_encodeIriOrBlankNode:function(e){var t=e[0];if("["===t||"("===t||"_"===t&&":"===e[1])return e;escape.test(e)&&(e=e.replace(escapeAll,characterReplacer));var r=this._prefixRegex.exec(e);return r?r[1]?this._prefixIRIs[r[1]]+r[2]:e:"<"+e+">"},_encodeLiteral:function(e,t,r){return escape.test(e)&&(e=e.replace(escapeAll,characterReplacer)),r?'"'+e+'"@'+r:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeSubject:function(e){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return"["===e[0]&&(this._subject="]"),this._encodeIriOrBlankNode(e)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return e===RDF_TYPE?"a":this._encodeIriOrBlankNode(e)},_encodeObject:function(e){if('"'!==e[0])return this._encodeIriOrBlankNode(e);var t=N3LiteralMatcher.exec(e);if(!t)throw new Error("Invalid literal: "+e);return this._encodeLiteral(t[1],t[2],t[3])},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},addTriple:function(e,t,r,i,n){void 0===r?this._writeTriple(e.subject,e.predicate,e.object,e.graph||"",t):"string"!=typeof i?this._writeTriple(e,t,r,"",i):this._writeTriple(e,t,r,i,n)},addTriples:function(e){for(var t=0;t<e.length;t++)this.addTriple(e[t])},addPrefix:function(e,t,r){var i={};i[e]=t,this.addPrefixes(i,r)},addPrefixes:function(e,t){var r=this._prefixIRIs,i=!1;for(var n in e){var c=e[n];/[#\/]$/.test(c)&&r[c]!==(n+=":")&&(i=!0,r[c]=n,null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null,this._graph=""),this._write("@prefix "+n+" <"+c+">.\n"))}if(i){var s="",a="";for(var h in r)s+=s?"|"+h:h,a+=(a?"|":"")+r[h];s=s.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+a+")[^/]*$|^("+s+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(i?"\n":"",t)},blank:function(e,t){var r,i,n=e;switch(void 0===e?n=[]:"string"==typeof e?n=[{predicate:e,object:t}]:"length"in e||(n=[e]),i=n.length){case 0:return"[]";case 1:if(r=n[0],"["!==r.object[0])return"[ "+this._encodePredicate(r.predicate)+" "+this._encodeObject(r.object)+" ]";default:for(var c="[",s=0;s<i;s++)r=n[s],r.predicate===e?c+=", "+this._encodeObject(r.object):(c+=(s?";\n  ":"\n  ")+this._encodePredicate(r.predicate)+" "+this._encodeObject(r.object),e=r.predicate);return c+"\n]"}},list:function(e){for(var t=e&&e.length||0,r=new Array(t),i=0;i<t;i++)r[i]=this._encodeObject(e[i]);return"("+r.join(" ")+")"},_prefixRegex:/$0^/,end:function(e){null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null),this._write=this._blockedWrite;var t=e&&function(r,i){t=null,e(r,i)};if(this._endStream)try{return this._outputStream.end(t)}catch(e){}t&&t()}},module.exports=N3Writer;
},{}],22:[function(require,module,exports){
(function (process){
"use strict";function nextTick(e,n,c,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,t,o=arguments.length;switch(o){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick(function(){e.call(null,n)});case 3:return process.nextTick(function(){e.call(null,n,c)});case 4:return process.nextTick(function(){e.call(null,n,c,r)});default:for(s=new Array(o-1),t=0;t<s.length;)s[t++]=arguments[t];return process.nextTick(function(){e.apply(null,s)})}}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=nextTick:module.exports=process.nextTick;
}).call(this,require('_process'))

},{"_process":23}],23:[function(require,module,exports){
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],24:[function(require,module,exports){
module.exports=require("./lib/_stream_duplex.js");
},{"./lib/_stream_duplex.js":25}],25:[function(require,module,exports){
"use strict";function Duplex(e){if(!(this instanceof Duplex))return new Duplex(e);Readable.call(this,e),Writable.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(e){e.end()}function forEach(e,t){for(var r=0,i=e.length;r<i;r++)t(e[r],r)}var processNextTick=require("process-nextick-args"),objectKeys=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};module.exports=Duplex;var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),Duplex.prototype._destroy=function(e,t){this.push(null),this.end(),processNextTick(t,e)};
},{"./_stream_readable":27,"./_stream_writable":29,"core-util-is":5,"inherits":9,"process-nextick-args":22}],26:[function(require,module,exports){
"use strict";function PassThrough(r){if(!(this instanceof PassThrough))return new PassThrough(r);Transform.call(this,r)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(r,s,i){i(null,r)};
},{"./_stream_transform":28,"core-util-is":5,"inherits":9}],27:[function(require,module,exports){
(function (process,global){
"use strict";function _uint8ArrayToBuffer(e){return Buffer.from(e)}function _isUint8Array(e){return Buffer.isBuffer(e)||e instanceof OurUint8Array}function prependListener(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function ReadableState(e,t){Duplex=Duplex||require("./_stream_duplex"),e=e||{},this.objectMode=!!e.objectMode,t instanceof Duplex&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Readable))return new Readable(e);this._readableState=new ReadableState(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),Stream.call(this)}function readableAddChunk(e,t,r,n,a){var i=e._readableState;if(null===t)i.reading=!1,onEofChunk(e,i);else{var d;a||(d=chunkInvalid(i,t)),d?e.emit("error",d):i.objectMode||t&&t.length>0?("string"==typeof t||i.objectMode||Object.getPrototypeOf(t)===Buffer.prototype||(t=_uint8ArrayToBuffer(t)),n?i.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):addChunk(e,i,t,!0):i.ended?e.emit("error",new Error("stream.push() after EOF")):(i.reading=!1,i.decoder&&!r?(t=i.decoder.write(t),i.objectMode||0!==t.length?addChunk(e,i,t,!1):maybeReadMore(e,i)):addChunk(e,i,t,!1))):n||(i.reading=!1)}return needMoreData(i)}function addChunk(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&emitReadable(e)),maybeReadMore(e,t)}function chunkInvalid(e,t){var r;return _isUint8Array(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function needMoreData(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function computeNewHighWaterMark(e){return e>=MAX_HWM?e=MAX_HWM:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function howMuchToRead(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=computeNewHighWaterMark(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function onEofChunk(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,emitReadable(e)}}function emitReadable(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(debug("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?processNextTick(emitReadable_,e):emitReadable_(e))}function emitReadable_(e){debug("emit readable"),e.emit("readable"),flow(e)}function maybeReadMore(e,t){t.readingMore||(t.readingMore=!0,processNextTick(maybeReadMore_,e,t))}function maybeReadMore_(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(debug("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;debug("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&EElistenerCount(e,"data")&&(t.flowing=!0,flow(e))}}function nReadingNextTick(e){debug("readable nexttick read 0"),e.read(0)}function resume(e,t){t.resumeScheduled||(t.resumeScheduled=!0,processNextTick(resume_,e,t))}function resume_(e,t){t.reading||(debug("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),flow(e),t.flowing&&!t.reading&&e.read(0)}function flow(e){var t=e._readableState;for(debug("flow",t.flowing);t.flowing&&null!==e.read(););}function fromList(e,t){if(0===t.length)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=fromListPartial(e,t.buffer,t.decoder),r}function fromListPartial(e,t,r){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?copyFromBufferString(e,t):copyFromBuffer(e,t),n}function copyFromBufferString(e,t){var r=t.head,n=1,a=r.data;for(e-=a.length;r=r.next;){var i=r.data,d=e>i.length?i.length:e;if(d===i.length?a+=i:a+=i.slice(0,e),0===(e-=d)){d===i.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=i.slice(d));break}++n}return t.length-=n,a}function copyFromBuffer(e,t){var r=Buffer.allocUnsafe(e),n=t.head,a=1;for(n.data.copy(r),e-=n.data.length;n=n.next;){var i=n.data,d=e>i.length?i.length:e;if(i.copy(r,r.length-e,0,d),0===(e-=d)){d===i.length?(++a,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=i.slice(d));break}++a}return t.length-=a,r}function endReadable(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,processNextTick(endReadableNT,t,e))}function endReadableNT(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function forEach(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}function indexOf(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}var processNextTick=require("process-nextick-args");module.exports=Readable;var isArray=require("isarray"),Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter,EElistenerCount=function(e,t){return e.listeners(t).length},Stream=require("./internal/streams/stream"),Buffer=require("safe-buffer").Buffer,OurUint8Array=global.Uint8Array||function(){},util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util"),debug=void 0;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var BufferList=require("./internal/streams/BufferList"),destroyImpl=require("./internal/streams/destroy"),StringDecoder;util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),Readable.prototype.destroy=destroyImpl.destroy,Readable.prototype._undestroy=destroyImpl.undestroy,Readable.prototype._destroy=function(e,t){this.push(null),t(e)},Readable.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&(t=t||n.defaultEncoding,t!==n.encoding&&(e=Buffer.from(e,t),t=""),r=!0),readableAddChunk(this,e,t,!1,r)},Readable.prototype.unshift=function(e){return readableAddChunk(this,e,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(e){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(e),this._readableState.encoding=e,this};var MAX_HWM=8388608;Readable.prototype.read=function(e){debug("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return debug("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?endReadable(this):emitReadable(this),null;if(0===(e=howMuchToRead(e,t))&&t.ended)return 0===t.length&&endReadable(this),null;var n=t.needReadable;debug("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&(n=!0,debug("length less than watermark",n)),t.ended||t.reading?(n=!1,debug("reading or ended",n)):n&&(debug("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=howMuchToRead(r,t)));var a;return a=e>0?fromList(e,t):null,null===a?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&endReadable(this)),null!==a&&this.emit("data",a),a},Readable.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(e,t){function r(e,t){debug("onunpipe"),e===l&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,a())}function n(){debug("onend"),e.end()}function a(){debug("cleanup"),e.removeListener("close",o),e.removeListener("finish",u),e.removeListener("drain",c),e.removeListener("error",d),e.removeListener("unpipe",r),l.removeListener("end",n),l.removeListener("end",s),l.removeListener("data",i),b=!0,!h.awaitDrain||e._writableState&&!e._writableState.needDrain||c()}function i(t){debug("ondata"),g=!1,!1!==e.write(t)||g||((1===h.pipesCount&&h.pipes===e||h.pipesCount>1&&-1!==indexOf(h.pipes,e))&&!b&&(debug("false write response, pause",l._readableState.awaitDrain),l._readableState.awaitDrain++,g=!0),l.pause())}function d(t){debug("onerror",t),s(),e.removeListener("error",d),0===EElistenerCount(e,"error")&&e.emit("error",t)}function o(){e.removeListener("finish",u),s()}function u(){debug("onfinish"),e.removeListener("close",o),s()}function s(){debug("unpipe"),l.unpipe(e)}var l=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,debug("pipe count=%d opts=%j",h.pipesCount,t);var f=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr,p=f?n:s;h.endEmitted?processNextTick(p):l.once("end",p),e.on("unpipe",r);var c=pipeOnDrain(l);e.on("drain",c);var b=!1,g=!1;return l.on("data",i),prependListener(e,"error",d),e.once("close",o),e.once("finish",u),e.emit("pipe",l),h.flowing||(debug("pipe resume"),l.resume()),e},Readable.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,a=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<a;i++)n[i].emit("unpipe",this,r);return this}var d=indexOf(t.pipes,e);return-1===d?this:(t.pipes.splice(d,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},Readable.prototype.on=function(e,t){var r=Stream.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&emitReadable(this):processNextTick(nReadingNextTick,this))}return r},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var e=this._readableState;return e.flowing||(debug("resume"),e.flowing=!0,resume(this,e)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(debug("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(a){if(debug("wrapped data"),t.decoder&&(a=t.decoder.write(a)),(!t.objectMode||null!==a&&void 0!==a)&&(t.objectMode||a&&a.length)){n.push(a)||(r=!0,e.pause())}});for(var a in e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var i=0;i<kProxyEvents.length;i++)e.on(kProxyEvents[i],n.emit.bind(n,kProxyEvents[i]));return n._read=function(t){debug("wrapped _read",t),r&&(r=!1,e.resume())},n},Readable._fromList=fromList;
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./_stream_duplex":25,"./internal/streams/BufferList":30,"./internal/streams/destroy":31,"./internal/streams/stream":32,"_process":23,"core-util-is":5,"events":7,"inherits":9,"isarray":11,"process-nextick-args":22,"safe-buffer":37,"string_decoder/":39,"util":3}],28:[function(require,module,exports){
"use strict";function TransformState(r){this.afterTransform=function(t,n){return afterTransform(r,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function afterTransform(r,t,n){var e=r._transformState;e.transforming=!1;var i=e.writecb;if(!i)return r.emit("error",new Error("write callback called multiple times"));e.writechunk=null,e.writecb=null,null!==n&&void 0!==n&&r.push(n),i(t);var a=r._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&r._read(a.highWaterMark)}function Transform(r){if(!(this instanceof Transform))return new Transform(r);Duplex.call(this,r),this._transformState=new TransformState(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,r&&("function"==typeof r.transform&&(this._transform=r.transform),"function"==typeof r.flush&&(this._flush=r.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(r,n){done(t,r,n)}):done(t)})}function done(r,t,n){if(t)return r.emit("error",t);null!==n&&void 0!==n&&r.push(n);var e=r._writableState,i=r._transformState;if(e.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return r.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(r,t){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,r,t)},Transform.prototype._transform=function(r,t,n){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(r,t,n){var e=this._transformState;if(e.writecb=n,e.writechunk=r,e.writeencoding=t,!e.transforming){var i=this._readableState;(e.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform.prototype._read=function(r){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},Transform.prototype._destroy=function(r,t){var n=this;Duplex.prototype._destroy.call(this,r,function(r){t(r),n.emit("close")})};
},{"./_stream_duplex":25,"core-util-is":5,"inherits":9}],29:[function(require,module,exports){
(function (process,global){
"use strict";function WriteReq(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function CorkedRequest(e){var t=this;this.next=null,this.entry=null,this.finish=function(){onCorkedFinish(t,e)}}function _uint8ArrayToBuffer(e){return Buffer.from(e)}function _isUint8Array(e){return Buffer.isBuffer(e)||e instanceof OurUint8Array}function nop(){}function WritableState(e,t){Duplex=Duplex||require("./_stream_duplex"),e=e||{},this.objectMode=!!e.objectMode,t instanceof Duplex&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=!1===e.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(e){if(Duplex=Duplex||require("./_stream_duplex"),!(realHasInstance.call(Writable,this)||this instanceof Duplex))return new Writable(e);this._writableState=new WritableState(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),Stream.call(this)}function writeAfterEnd(e,t){var r=new Error("write after end");e.emit("error",r),processNextTick(t,r)}function validChunk(e,t,r,i){var n=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),processNextTick(i,o),n=!1),n}function decodeChunk(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=Buffer.from(t,r)),t}function writeOrBuffer(e,t,r,i,n,o){if(!r){var s=decodeChunk(t,i,n);i!==s&&(r=!0,n="buffer",i=s)}var a=t.objectMode?1:i.length;t.length+=a;var f=t.length<t.highWaterMark;if(f||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else doWrite(e,t,!1,a,i,n,o);return f}function doWrite(e,t,r,i,n,o,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(n,t.onwrite):e._write(n,o,t.onwrite),t.sync=!1}function onwriteError(e,t,r,i,n){--t.pendingcb,r?(processNextTick(n,i),processNextTick(finishMaybe,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(n(i),e._writableState.errorEmitted=!0,e.emit("error",i),finishMaybe(e,t))}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,t){var r=e._writableState,i=r.sync,n=r.writecb;if(onwriteStateUpdate(r),t)onwriteError(e,r,i,t,n);else{var o=needFinish(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||clearBuffer(e,r),i?asyncWrite(afterWrite,e,r,o,n):afterWrite(e,r,o,n)}}function afterWrite(e,t,r,i){r||onwriteDrain(e,t),t.pendingcb--,i(),finishMaybe(e,t)}function onwriteDrain(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function clearBuffer(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,n=new Array(i),o=t.corkedRequestsFree;o.entry=r;for(var s=0,a=!0;r;)n[s]=r,r.isBuf||(a=!1),r=r.next,s+=1;n.allBuffers=a,doWrite(e,t,!0,t.length,n,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new CorkedRequest(t)}else{for(;r;){var f=r.chunk,u=r.encoding,l=r.callback;if(doWrite(e,t,!1,t.objectMode?1:f.length,f,u,l),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function needFinish(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function callFinal(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),finishMaybe(e,t)})}function prefinish(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,processNextTick(callFinal,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function finishMaybe(e,t){var r=needFinish(t);return r&&(prefinish(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}function endWritable(e,t,r){t.ending=!0,finishMaybe(e,t),r&&(t.finished?processNextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function onCorkedFinish(e,t,r){var i=e.entry;for(e.entry=null;i;){var n=i.callback;t.pendingcb--,n(r),i=i.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}var processNextTick=require("process-nextick-args");module.exports=Writable;var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick,Duplex;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")},Stream=require("./internal/streams/stream"),Buffer=require("safe-buffer").Buffer,OurUint8Array=global.Uint8Array||function(){},destroyImpl=require("./internal/streams/destroy");util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var realHasInstance;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(e){return!!realHasInstance.call(this,e)||e&&e._writableState instanceof WritableState}})):realHasInstance=function(e){return e instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(e,t,r){var i=this._writableState,n=!1,o=_isUint8Array(e)&&!i.objectMode;return o&&!Buffer.isBuffer(e)&&(e=_uint8ArrayToBuffer(e)),"function"==typeof t&&(r=t,t=null),o?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=nop),i.ended?writeAfterEnd(this,r):(o||validChunk(this,i,e,r))&&(i.pendingcb++,n=writeOrBuffer(this,i,o,e,t,r)),n},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||clearBuffer(this,e))},Writable.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Writable.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(e,t,r){var i=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||endWritable(this,i,r)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),Writable.prototype.destroy=destroyImpl.destroy,Writable.prototype._undestroy=destroyImpl.undestroy,Writable.prototype._destroy=function(e,t){this.end(),t(e)};
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./_stream_duplex":25,"./internal/streams/destroy":31,"./internal/streams/stream":32,"_process":23,"core-util-is":5,"inherits":9,"process-nextick-args":22,"safe-buffer":37,"util-deprecate":40}],30:[function(require,module,exports){
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function copyBuffer(t,e,h){t.copy(e,h)}var Buffer=require("safe-buffer").Buffer;module.exports=function(){function t(){_classCallCheck(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,h=""+e.data;e=e.next;)h+=t+e.data;return h},t.prototype.concat=function(t){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var e=Buffer.allocUnsafe(t>>>0),h=this.head,n=0;h;)copyBuffer(h.data,e,n),n+=h.data.length,h=h.next;return e},t}();
},{"safe-buffer":37}],31:[function(require,module,exports){
"use strict";function destroy(t,e){var r=this,i=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;if(i||a)return void(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||processNextTick(emitErrorNT,this,t));this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(processNextTick(emitErrorNT,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(t)})}function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT(t,e){t.emit("error",e)}var processNextTick=require("process-nextick-args");module.exports={destroy:destroy,undestroy:undestroy};
},{"process-nextick-args":22}],32:[function(require,module,exports){
module.exports=require("events").EventEmitter;
},{"events":7}],33:[function(require,module,exports){
module.exports=require("./readable").PassThrough;
},{"./readable":34}],34:[function(require,module,exports){
exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js");
},{"./lib/_stream_duplex.js":25,"./lib/_stream_passthrough.js":26,"./lib/_stream_readable.js":27,"./lib/_stream_transform.js":28,"./lib/_stream_writable.js":29}],35:[function(require,module,exports){
module.exports=require("./readable").Transform;
},{"./readable":34}],36:[function(require,module,exports){
module.exports=require("./lib/_stream_writable.js");
},{"./lib/_stream_writable.js":29}],37:[function(require,module,exports){
function copyProps(f,r){for(var e in f)r[e]=f[e]}function SafeBuffer(f,r,e){return Buffer(f,r,e)}var buffer=require("buffer"),Buffer=buffer.Buffer;Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=buffer:(copyProps(buffer,exports),exports.Buffer=SafeBuffer),copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(f,r,e){if("number"==typeof f)throw new TypeError("Argument must not be a number");return Buffer(f,r,e)},SafeBuffer.alloc=function(f,r,e){if("number"!=typeof f)throw new TypeError("Argument must be a number");var u=Buffer(f);return void 0!==r?"string"==typeof e?u.fill(r,e):u.fill(r):u.fill(0),u},SafeBuffer.allocUnsafe=function(f){if("number"!=typeof f)throw new TypeError("Argument must be a number");return Buffer(f)},SafeBuffer.allocUnsafeSlow=function(f){if("number"!=typeof f)throw new TypeError("Argument must be a number");return buffer.SlowBuffer(f)};
},{"buffer":4}],38:[function(require,module,exports){
function Stream(){EE.call(this)}module.exports=Stream;var EE=require("events").EventEmitter,inherits=require("inherits");inherits(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(e,r){function t(r){e.writable&&!1===e.write(r)&&m.pause&&m.pause()}function n(){m.readable&&m.resume&&m.resume()}function a(){u||(u=!0,e.end())}function o(){u||(u=!0,"function"==typeof e.destroy&&e.destroy())}function i(e){if(s(),0===EE.listenerCount(this,"error"))throw e}function s(){m.removeListener("data",t),e.removeListener("drain",n),m.removeListener("end",a),m.removeListener("close",o),m.removeListener("error",i),e.removeListener("error",i),m.removeListener("end",s),m.removeListener("close",s),e.removeListener("close",s)}var m=this;m.on("data",t),e.on("drain",n),e._isStdio||r&&!1===r.end||(m.on("end",a),m.on("close",o));var u=!1;return m.on("error",i),e.on("error",i),m.on("end",s),m.on("close",s),e.on("close",s),e.emit("pipe",m),e};
},{"events":7,"inherits":9,"readable-stream/duplex.js":24,"readable-stream/passthrough.js":33,"readable-stream/readable.js":34,"readable-stream/transform.js":35,"readable-stream/writable.js":36}],39:[function(require,module,exports){
"use strict";function _normalizeEncoding(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function normalizeEncoding(t){var e=_normalizeEncoding(t);if("string"!=typeof e&&(Buffer.isEncoding===isEncoding||!isEncoding(t)))throw new Error("Unknown encoding: "+t);return e||t}function StringDecoder(t){this.encoding=normalizeEncoding(t);var e;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,e=4;break;case"utf8":this.fillLast=utf8FillLast,e=4;break;case"base64":this.text=base64Text,this.end=base64End,e=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(e)}function utf8CheckByte(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:-1}function utf8CheckIncomplete(t,e,s){var i=e.length-1;if(i<s)return 0;var a=utf8CheckByte(e[i]);return a>=0?(a>0&&(t.lastNeed=a-1),a):--i<s?0:(a=utf8CheckByte(e[i]))>=0?(a>0&&(t.lastNeed=a-2),a):--i<s?0:(a=utf8CheckByte(e[i]),a>=0?(a>0&&(2===a?a=0:t.lastNeed=a-3),a):0)}function utf8CheckExtraBytes(t,e,s){if(128!=(192&e[0]))return t.lastNeed=0,"".repeat(s);if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"".repeat(s+1);if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"".repeat(s+2)}}function utf8FillLast(t){var e=this.lastTotal-this.lastNeed,s=utf8CheckExtraBytes(this,t,e);return void 0!==s?s:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function utf8Text(t,e){var s=utf8CheckIncomplete(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=s;var i=t.length-(s-this.lastNeed);return t.copy(this.lastChar,0,i),t.toString("utf8",e,i)}function utf8End(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"".repeat(this.lastTotal-this.lastNeed):e}function utf16Text(t,e){if((t.length-e)%2==0){var s=t.toString("utf16le",e);if(s){var i=s.charCodeAt(s.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],s.slice(0,-1)}return s}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function utf16End(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var s=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,s)}return e}function base64Text(t,e){var s=(t.length-e)%3;return 0===s?t.toString("base64",e):(this.lastNeed=3-s,this.lastTotal=3,1===s?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-s))}function base64End(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function simpleWrite(t){return t.toString(this.encoding)}function simpleEnd(t){return t&&t.length?this.write(t):""}var Buffer=require("safe-buffer").Buffer,isEncoding=Buffer.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};exports.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(t){if(0===t.length)return"";var e,s;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";s=this.lastNeed,this.lastNeed=0}else s=0;return s<t.length?e?e+this.text(t,s):this.text(t,s):e||""},StringDecoder.prototype.end=utf8End,StringDecoder.prototype.text=utf8Text,StringDecoder.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};
},{"safe-buffer":37}],40:[function(require,module,exports){
(function (global){
function deprecate(r,e){function o(){if(!t){if(config("throwDeprecation"))throw new Error(e);config("traceDeprecation")?console.trace(e):console.warn(e),t=!0}return r.apply(this,arguments)}if(config("noDeprecation"))return r;var t=!1;return o}function config(r){try{if(!global.localStorage)return!1}catch(r){return!1}var e=global.localStorage[r];return null!=e&&"true"===String(e).toLowerCase()}module.exports=deprecate;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],41:[function(require,module,exports){
arguments[4][9][0].apply(exports,arguments)
},{"dup":9}],42:[function(require,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};
},{}],43:[function(require,module,exports){
(function (process,global){
function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var c="",a=!1,l=["{","}"];if(isArray(r)&&(a=!0,l=["[","]"]),isFunction(r)){c=" [Function"+(r.name?": "+r.name:"")+"]"}if(isRegExp(r)&&(c=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(c=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(c=" "+formatError(r)),0===o.length&&(!a||0==r.length))return l[0]+c+l[1];if(t<0)return isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var p;return p=a?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,a)}),e.seen.pop(),reduceToSingleString(p,c,l)}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;s<u;++s)hasOwnProperty(r,String(s))?o.push(formatProperty(e,r,t,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,c;if(c=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=isNull(t)?formatValue(e,c.value,null):formatValue(e,c.value,t-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){var n=0;return e.reduce(function(e,r){return n++,r.indexOf("\n")>=0&&n++,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}for(var t=1,n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(e){return"[Circular]"}default:return e}}),s=n[t];t<i;s=n[++t])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o},exports.deprecate=function(e,r){function t(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(!0===process.noDeprecation)return e;var n=!1;return t};var debugs={},debugEnviron;exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./support/isBuffer":42,"_process":23,"inherits":41}],44:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),ClassOrder=require("./class-order"),Node=require("./node"),BlankNode=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(r.termType=t.termType,e){if("string"!=typeof e)throw console.log("Bad blank id:",e),new Error("Bad id argument to new blank node: "+e);if(e.includes("#")){var n=e.split("#");e=n[n.length-1]}r.id=e}else r.id="n"+t.nextId++;return r.value=r.id,r}return _inherits(t,e),_createClass(t,[{key:"compareTerm",value:function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.id<e.id?-1:this.id>e.id?1:0}},{key:"copy",value:function(e){var r=new t;return e.copyTo(this,r),r}},{key:"toCanonical",value:function(){return"_:"+this.value}},{key:"toString",value:function(){return t.NTAnonymousNodePrefix+this.id}}]),t}(Node);BlankNode.nextId=0,BlankNode.termType="BlankNode",BlankNode.NTAnonymousNodePrefix="_:",BlankNode.prototype.classOrder=ClassOrder.BlankNode,BlankNode.prototype.isBlank=1,BlankNode.prototype.isVar=1,module.exports=BlankNode;
},{"./class-order":45,"./node":60}],45:[function(require,module,exports){
"use strict";var ClassOrder={Literal:1,Collection:3,Graph:4,NamedNode:5,BlankNode:6,Variable:7};module.exports=ClassOrder;
},{}],46:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),BlankNode=require("./blank-node"),ClassOrder=require("./class-order"),Node=require("./node"),Collection=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.termType=t.termType,n.id=BlankNode.nextId++,n.elements=[],n.closed=!1,e&&e.length>0&&e.forEach(function(e){n.elements.push(Node.fromValue(e))}),n}return _inherits(t,e),_createClass(t,[{key:"append",value:function(e){return this.elements.push(e)}},{key:"close",value:function(){return this.closed=!0,this.closed}},{key:"shift",value:function(){return this.elements.shift()}},{key:"substitute",value:function(e){return new t(this.elements.map(function(t){t.substitute(e)}))}},{key:"toNT",value:function(){return BlankNode.NTAnonymousNodePrefix+this.id}},{key:"toString",value:function(){return"("+this.elements.join(" ")+")"}},{key:"unshift",value:function(e){return this.elements.unshift(e)}}]),t}(Node);Collection.termType="Collection",Collection.prototype.classOrder=ClassOrder.Collection,Collection.prototype.compareTerm=BlankNode.prototype.compareTerm,Collection.prototype.isVar=0,module.exports=Collection;
},{"./blank-node":44,"./class-order":45,"./node":60}],47:[function(require,module,exports){
"use strict";function convertToJson(n,o){var r,t=N3.Parser(),e=N3.Writer({format:"N-Quads"});asyncLib.waterfall([function(o){t.parse(n,o)},function(n,o,r){null!==n&&e.addTriple(n),"function"==typeof r&&e.end(r)},function(n,o){try{jsonld.fromRDF(n,{format:"application/nquads"},o)}catch(n){o(n)}},function(n,t){r=JSON.stringify(n),o(null,r)}],function(n,t){o(n,r)})}function convertToNQuads(n,o){var r,t=N3.Parser(),e=N3.Writer({format:"N-Quads"});asyncLib.waterfall([function(o){t.parse(n,o)},function(n,o,r){null!==n&&e.addTriple(n),"function"==typeof r&&e.end(r)},function(n,t){r=n,o(null,r)}],function(n,t){o(n,r)})}module.exports.convertToJson=convertToJson,module.exports.convertToNQuads=convertToNQuads;var asyncLib=require("async"),jsonld=require("jsonld"),N3=require("n3");
},{"async":1,"jsonld":13,"n3":14}],48:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function blankNode(e){return new BlankNode(e)}function collection(e){return new Collection(e)}function defaultGraph(){return new DefaultGraph}function fetcher(e,r){return new Fetcher(e,r)}function graph(){return new _indexedFormula2.default}function lit(e,r,t){return new Literal(""+e,r,t)}function literal(e,r){return"string"==typeof r?-1===r.indexOf(":")?new Literal(e,r):new Literal(e,null,namedNode(r)):new Literal(e,null,r)}function namedNode(e){return new NamedNode(e)}function quad(e,r,t,n){return n=n||new DefaultGraph,new Statement(e,r,t,n)}function st(e,r,t,n){return new Statement(e,r,t,n)}function triple(e,r,t){return quad(e,r,t)}function variable(e){return new Variable(e)}var _indexedFormula=require("./indexed-formula"),_indexedFormula2=_interopRequireDefault(_indexedFormula),BlankNode=require("./blank-node"),Collection=require("./collection"),DefaultGraph=require("./default-graph"),Fetcher=require("./fetcher"),Literal=require("./literal"),NamedNode=require("./named-node"),Statement=require("./statement"),Variable=require("./variable");module.exports.blankNode=blankNode,module.exports.defaultGraph=defaultGraph,module.exports.graph=graph,module.exports.literal=literal,module.exports.namedNode=namedNode,module.exports.quad=quad,module.exports.triple=triple,module.exports.variable=variable,module.exports.collection=collection,module.exports.fetcher=fetcher,module.exports.lit=lit,module.exports.st=st;
},{"./blank-node":44,"./collection":46,"./default-graph":49,"./fetcher":51,"./indexed-formula":53,"./literal":55,"./named-node":58,"./statement":70,"./variable":75}],49:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Node=require("./node"),DefaultGraph=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.termType="DefaultGraph",e.value="",e}return _inherits(t,e),_createClass(t,[{key:"toCanonical",value:function(){return this.value}}]),t}(Node);module.exports=DefaultGraph;
},{"./node":60}],50:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Node=require("./node"),Empty=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.termType=t.termType,e}return _inherits(t,e),_createClass(t,[{key:"toString",value:function(){return"()"}}]),t}(Node);Empty.termType="empty",module.exports=Empty;
},{"./node":60}],51:[function(require,module,exports){
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),log=require("./log"),N3Parser=require("./n3parser"),NamedNode=require("./named-node"),Namespace=require("./namespace"),rdfParse=require("./parse"),parseRDFaDOM=require("./rdfaparser").parseRDFaDOM,RDFParser=require("./rdfxmlparser"),Uri=require("./uri"),Util=require("./util"),serialize=require("./serialize"),Parsable={"text/n3":!0,"text/turtle":!0,"application/rdf+xml":!0,"application/xhtml+xml":!0,"text/html":!0,"application/ld+json":!0},CONTENT_TYPE_BY_EXT={rdf:"application/rdf+xml",owl:"application/rdf+xml",n3:"text/n3",ttl:"text/turtle",nt:"text/n3",acl:"text/n3",html:"text/html",xml:"text/xml"},ns={link:Namespace("http://www.w3.org/2007/ont/link#"),http:Namespace("http://www.w3.org/2007/ont/http#"),httph:Namespace("http://www.w3.org/2007/ont/httph#"),rdf:Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),rdfs:Namespace("http://www.w3.org/2000/01/rdf-schema#"),dc:Namespace("http://purl.org/dc/elements/1.1/"),ldp:Namespace("http://www.w3.org/ns/ldp#")},Handler=function e(t,r){_classCallCheck(this,e),this.response=t,this.dom=r},RDFXMLHandler=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"parse",value:function(e,t,r){var n=e.store;if(this.dom||(this.dom=Util.parseXML(t)),"parsererror"===this.dom.documentElement.nodeName)return e.failFetch(r,"Badly formed XML in "+r.resource.uri,"parse_error");var i=new RDFParser(n);try{i.parse(this.dom,r.original.uri,r.original)}catch(t){return e.failFetch(r,"Syntax error parsing RDF/XML! "+t,"parse_error")}return r.noMeta||n.add(r.original,ns.rdf("type"),ns.link("RDFDocument"),e.appNode),e.doneFetch(r,this.response)}}],[{key:"toString",value:function(){return"RDFXMLHandler"}},{key:"register",value:function(e){e.mediatypes["application/rdf+xml"]={q:.9}}}]),t}(Handler);RDFXMLHandler.pattern=new RegExp("application/rdf\\+xml");var XHTMLHandler=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"parse",value:function(e,t,r){var n=void 0,i=void 0;this.dom||(this.dom=Util.parseXML(t));var s=e.store,a=this.dom.getElementsByTagName("title");a.length>0&&s.add(r.resource,ns.dc("title"),s.literal(a[0].textContent),r.resource);for(var o=this.dom.getElementsByTagName("link"),l=o.length-1;l>=0;l--)n=o[l].getAttribute("rel"),i=!1,n||(n=o[l].getAttribute("rev"),i=!0),n&&e.linkData(r.original,n,o[l].getAttribute("href"),r.resource,i);for(var u=this.dom.getElementsByTagName("script"),d=0;d<u.length;d++){var c=u[d].getAttribute("type");Parsable[c]&&rdfParse(u[d].textContent,s,r.original.uri,c)}if(r.noMeta||s.add(r.resource,ns.rdf("type"),ns.link("WebPage"),e.appNode),!r.noRDFa&&parseRDFaDOM)try{parseRDFaDOM(this.dom,s,r.original.uri)}catch(t){var h="Error trying to parse "+r.resource+" as RDFa:\n"+t+":\n"+t.stack;return e.failFetch(r,h,"parse_error")}return e.doneFetch(r,this.response)}}],[{key:"toString",value:function(){return"XHTMLHandler"}},{key:"register",value:function(e){e.mediatypes["application/xhtml+xml"]={}}}]),t}(Handler);XHTMLHandler.pattern=new RegExp("application/xhtml");var XMLHandler=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"parse",value:function(e,t,r){for(var n=Util.parseXML(t),i=0;i<n.childNodes.length;i++)if(1===n.childNodes[i].nodeType){var s=n.childNodes[i].namespaceURI;if(s&&s===s.rdf){e.addStatus(r.req,"Has XML root element in the RDF namespace, so assume RDF/XML.");var a=new RDFXMLHandler(this.response,n);return a.parse(e,t,r)}break}if(n.doctype&&"html"===n.doctype.name&&n.doctype.publicId.match(/^-\/\/W3C\/\/DTD XHTML/)&&n.doctype.systemId.match(/http:\/\/www.w3.org\/TR\/xhtml/)){e.addStatus(r.req,"Has XHTML DOCTYPE. Switching to XHTML Handler.\n");return new XHTMLHandler(this.response,n).parse(e,t,r)}var o=n.getElementsByTagName("html")[0];if(o){var l=o.getAttribute("xmlns");if(l&&l.match(/^http:\/\/www.w3.org\/1999\/xhtml/)){e.addStatus(r.req,"Has a default namespace for XHTML. Switching to XHTMLHandler.\n");return new XHTMLHandler(this.response,n).parse(e,t,r)}}return e.failFetch(r,"Unsupported dialect of XML: not RDF or XHTML namespace, etc.\n"+t.slice(0,80))}}],[{key:"toString",value:function(){return"XMLHandler"}},{key:"register",value:function(e){e.mediatypes["text/xml"]={q:.5},e.mediatypes["application/xml"]={q:.5}}}]),t}(Handler);XMLHandler.pattern=new RegExp("(text|application)/(.*)xml");var HTMLHandler=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"parse",value:function(e,t,r){var n=e.store;if(t.match(/\s*<\?xml\s+version\s*=[^<>]+\?>/)){e.addStatus(r.req,"Has an XML declaration. We'll assume it's XHTML as the content-type was text/html.\n");return new XHTMLHandler(this.response).parse(e,t,r)}if(t.match(/.*<!DOCTYPE\s+html[^<]+-\/\/W3C\/\/DTD XHTML[^<]+http:\/\/www.w3.org\/TR\/xhtml[^<]+>/)){e.addStatus(r.req,"Has XHTML DOCTYPE. Switching to XHTMLHandler.\n");return new XHTMLHandler(this.response).parse(e,t,r)}if(t.match(/[^(<html)]*<html\s+[^<]*xmlns=['"]http:\/\/www.w3.org\/1999\/xhtml["'][^<]*>/)){e.addStatus(r.req,"Has default namespace for XHTML, so switching to XHTMLHandler.\n");return new XHTMLHandler(this.response).parse(e,t,r)}var i=new RegExp("<title>([\\s\\S]+?)</title>","im").exec(t);return i&&n.add(r.resource,ns.dc("title"),n.literal(i[1]),r.resource),n.add(r.resource,ns.rdf("type"),ns.link("WebPage"),e.appNode),e.addStatus(r.req,"non-XML HTML document, not parsed for data."),e.doneFetch(r,this.response)}}],[{key:"toString",value:function(){return"HTMLHandler"}},{key:"register",value:function(e){e.mediatypes["text/html"]={q:.9}}}]),t}(Handler);HTMLHandler.pattern=new RegExp("text/html");var TextHandler=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"parse",value:function(e,t,r){if(t.match(/\s*<\?xml\s+version\s*=[^<>]+\?>/)){e.addStatus(r.req,"Warning: "+r.resource+" has an XML declaration. We'll assume it's XML but its content-type wasn't XML.\n");return new XMLHandler(this.response).parse(e,t,r)}if(t.slice(0,500).match(/xmlns:/)){e.addStatus(r.req,"May have an XML namespace. We'll assume it's XML but its content-type wasn't XML.\n");return new XMLHandler(this.response).parse(e,t,r)}return e.addStatus(r.req,"Plain text document, no known RDF semantics."),e.doneFetch(r,this.response)}}],[{key:"toString",value:function(){return"TextHandler"}},{key:"register",value:function(e){e.mediatypes["text/plain"]={q:.5}}}]),t}(Handler);TextHandler.pattern=new RegExp("text/plain");var N3Handler=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"parse",value:function(e,t,r){var n=e.store,i=N3Parser(n,n,r.original.uri,r.original.uri,null,null,"",null);try{i.loadBuf(t)}catch(t){var s="Error trying to parse "+r.resource+" as Notation3:\n"+t+":\n"+t.stack;return e.failFetch(r,s,"parse_error")}return e.addStatus(r.req,"N3 parsed: "+i.statementCount+" triples in "+i.lines+" lines."),e.store.add(r.original,ns.rdf("type"),ns.link("RDFDocument"),e.appNode),e.doneFetch(r,this.response)}}],[{key:"toString",value:function(){return"N3Handler"}},{key:"register",value:function(e){e.mediatypes["text/n3"]={q:"1.0"},e.mediatypes["text/turtle"]={q:1}}}]),t}(Handler);N3Handler.pattern=new RegExp("(application|text)/(x-)?(rdf\\+)?(n3|turtle)");var HANDLERS={RDFXMLHandler:RDFXMLHandler,XHTMLHandler:XHTMLHandler,XMLHandler:XMLHandler,HTMLHandler:HTMLHandler,TextHandler:TextHandler,N3Handler:N3Handler},Fetcher=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.store=t,this.timeout=n.timeout||3e4,this._fetch=n.fetch,this._fetch||("undefined"!=typeof window?this._fetch=window.fetch.bind(window):this._fetch=require("node-fetch")),this.appNode=this.store.bnode(),this.store.fetcher=this,this.requested={},this.redirectedTo={},this.fetchQueue={},this.fetchCallbacks={},this.nonexistent={},this.lookedUp={},this.handlers=[],this.mediatypes={"image/*":{q:.9},"*/*":{q:.1}},Util.callbackify(this,["request","fail","refresh","retract","done"]),Object.keys(HANDLERS).map(function(e){return r.addHandler(HANDLERS[e])})}return _createClass(e,[{key:"fetch",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e instanceof Array)return Promise.all(e.map(function(e){return t.fetch(e,Object.assign({},r))}));var n=e.uri||e;return n=n.split("#")[0],r=this.initFetchOptions(n,r),this.pendingFetchPromise(n,r.baseURI,r)}},{key:"pendingFetchPromise",value:function(e,t,r){var n=void 0;return!r.force&&this.fetchQueue[t]?n=this.fetchQueue[t]:(n=Promise.race([this.setRequestTimeout(e,r),this.fetchUri(e,r)]),this.fetchQueue[t]=n,this.cleanupFetchRequest(t,r,this.timeout)),n}},{key:"cleanupFetchRequest",value:function(e,t,r){var n=this;setTimeout(function(){n.isPending(e)||delete n.fetchQueue[e]},r)}},{key:"load",value:function(e,t){return this.fetch(e,t)}},{key:"initFetchOptions",value:function(t,r){var n=this.store;!r.method||"GET"===r.method.toUpperCase()||(r.force=!0),r.resource=n.sym(t),r.baseURI=r.baseURI||t,r.original=n.sym(r.baseURI),r.req=n.bnode(),r.headers=r.headers||{},r.contentType&&(r.headers["content-type"]=r.contentType),r.force&&(r.cache="no-cache");var i=this.acceptString();r.headers.accept=i;var s=e.offlineOverride(t);r.requestedURI=s,e.withCredentials(s,r)&&(r.credentials="include");var a=e.proxyIfNecessary(s);return s!==a&&(r.proxyUsed=!0),r.actualProxyURI=a,r}},{key:"fetchUri",value:function(t,r){var n=this;if(!t)return Promise.reject(new Error("Cannot fetch an empty uri"));if(e.unsupportedProtocol(t))return this.failFetch(r,"Unsupported protocol","unsupported_protocol");var i=this.getState(t);if(r.force)delete this.nonexistent[t];else{if("fetched"===i)return Promise.resolve(this.doneFetch(r,{status:200,ok:!0}));if("failed"===i)return this.failFetch(r,"Previously failed: "+this.requested[t],this.requested[t])}this.fireCallbacks("request",[t]),this.requested[t]=!0,r.noMeta||this.saveRequestMetadata(t,r);var s=r.actualProxyURI;return this._fetch(s,r).then(function(e){return n.handleResponse(e,t,r)}).catch(function(e){return n.handleError(e,t,r)})}},{key:"nowOrWhenFetched",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=e.uri||e,"function"==typeof t?r=t:void 0===t||(t instanceof NamedNode?n.referringTerm=t:n=t),this.fetch(e,n).then(function(e){r&&r(!0,null,e)}).catch(function(e){r(!1,e.message)})}},{key:"addStatus",value:function(e,t){var r=new Date;t="["+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+"."+r.getMilliseconds()+"] "+t;var n=this.store,i=n.the(e,ns.link("status"));i&&i.append?i.append(n.literal(t)):log.warn("web.js: No list to add to: "+i+","+t)}},{key:"failFetch",value:function(e,t,r){return this.addStatus(e.req,t),e.noMeta||this.store.add(e.original,ns.link("error"),t),e.resource.sameTerm(e.original)?console.log("@@ Recording failure for "+e.original+": "+r):console.log("@@ Recording failure original "+e.original+"( as "+e.resource+") : "+r),(!e.method||"GET"===e.method.toUpperCase()||"HEAD"===e.method.toUpperCase())&&(this.requested[Uri.docpart(e.original.uri)]=r,this.fireCallbacks("fail",[e.original.uri,t])),Promise.resolve({ok:!1,error:t,status:r})}},{key:"linkData",value:function(e,t,r,n,i){if(r){var s=this.store,a=void 0,o=s.sym(Uri.join(r,e.uri));if("alternate"===t||"seeAlso"===t||"meta"===t||"describedby"===t){if(o.uri===e.uri)return;a=ns.rdfs("seeAlso")}else a="type"===t?s.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):s.sym(Uri.join(encodeURIComponent(t),"http://www.iana.org/assignments/link-relations/"));i?s.add(o,a,e,n):s.add(e,a,o,n)}}},{key:"parseLinkHeader",value:function(e,t,r){if(e)for(var n=/<[^>]*>\s*(\s*;\s*[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*")))*(,|$)/g,i=/[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*"))/g,s=e.match(n),a=0;a<s.length;a++)for(var o=s[a].split(">"),l=o[0].substring(1),u=o[1],d=u.match(i),c=0;c<d.length;c++){var h=d[c],p=h.split("="),f=p[1].replace(/["']/g,"");this.linkData(t,f,l,r)}}},{key:"doneFetch",value:function(e,t){return this.addStatus(e.req,"Done."),this.requested[e.original.uri]="done",this.fireCallbacks("done",[e.original.uri]),t.req=e.req,t}},{key:"nowKnownAs",value:function(e,t){this.lookedUp[e.uri]?this.lookedUp[t.uri]||this.lookUpThing(t,e):this.lookedUp[t.uri]&&(this.lookedUp[e.uri]||this.lookUpThing(e,t))}},{key:"putBack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e.uri||e;var r=new NamedNode(e).doc();return t.data=serialize(r,this.store,r.uri,t.contentType||"text/turtle"),this.webOperation("PUT",e,t)}},{key:"webCopy",value:function(e,t,r){var n=this;return this.webOperation("GET",e).then(function(e){return n.webOperation("PUT",t,{data:e.responseText,contentType:r})})}},{key:"delete",value:function(e,t){var r=this;return this.webOperation("DELETE",e,t).then(function(t){return r.requested[e]=404,r.nonexistent[e]=!0,r.unload(r.store.sym(e)),t})}},{key:"createContainer",value:function(e,t,r){var n={"content-type":"text/turtle",link:ns.ldp("BasicContainer")+'; rel="type"'};t&&(n.slug=t);var i={headers:n};return r&&(i.body=r),this.webOperation("POST",e,i)}},{key:"webOperation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.method=e,r.body=r.data||r.body,r.force=!0,this.fetch(t,r)}},{key:"lookUpThing",value:function(e,t){var r=this,n=this.store.uris(e);return n=n.map(function(e){return Uri.docpart(e)}),n.forEach(function(e){r.lookedUp[e]=!0}),this.fetch(n,{referringTerm:t})}},{key:"getHeader",value:function(e,t){for(var r=this.store,n=r.each(void 0,ns.link("requestedURI"),e.uri),i=0;i<n.length;i++){var s=n[i];if(void 0!==s){var a=r.any(s,ns.link("response"));if(void 0!==a){var o=r.each(a,ns.httph(t.toLowerCase()));return o.length?o.map(function(e){return e.value}):[]}}}}},{key:"saveRequestMetadata",value:function(e,t){var r=t.req,n=this.store,i=t.referringTerm;this.addStatus(t.req,"Accept: "+t.headers.accept),i&&i.uri&&n.add(e,ns.link("requestedBy"),i.uri,this.appNode),t.original&&t.original.uri!==e&&n.add(r,ns.link("orginalURI"),n.literal(t.original.uri),this.appNode);var s=new Date,a="["+s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()+"] ";n.add(r,ns.rdfs("label"),n.literal(a+" Request for "+e),this.appNode),n.add(r,ns.link("requestedURI"),n.literal(e),this.appNode),n.add(r,ns.link("status"),n.collection(),this.appNode)}},{key:"saveResponseMetadata",value:function(e,t){var r=this.store,n=r.bnode();return r.add(t.req,ns.link("response"),n),r.add(n,ns.http("status"),r.literal(e.status),n),r.add(n,ns.http("statusText"),r.literal(e.statusText),n),t.resource.uri.startsWith("http")?(e.headers.forEach(function(e,i){r.add(n,ns.httph(i),e,n),"content-type"===i&&r.add(t.resource,ns.rdf("type"),Util.mediaTypeClass(e),n)}),n):n}},{key:"objectRefresh",value:function(e){var t=this.store.uris(e);if(void 0!==t)for(var r=0;r<t.length;r++)this.refresh(this.store.sym(Uri.docpart(t[r])))}},{key:"refresh",value:function(e,t){this.fireCallbacks("refresh",arguments),this.nowOrWhenFetched(e,{force:!0,clearPreviousData:!0},t)}},{key:"retract",value:function(e){this.store.removeMany(void 0,void 0,void 0,e),e.uri&&delete this.requested[Uri.docpart(e.uri)],this.fireCallbacks("retract",arguments)}},{key:"getState",value:function(e){return void 0===this.requested[e]?"unrequested":!0===this.requested[e]?"requested":"done"===this.requested[e]?"fetched":"redirected"===this.requested[e]?this.getState(this.redirectedTo[e]):"failed"}},{key:"isPending",value:function(e){return!0===this.requested[e]}},{key:"unload",value:function(e){this.store.removeDocument(e),delete this.requested[e.uri]}},{key:"addHandler",value:function(e){this.handlers.push(e),e.register(this)}},{key:"retryNoCredentials",value:function(e,t){console.log("web: Retrying with no credentials for "+t.resource),t.retriedWithNoCredentials=!0,delete this.requested[e];var r=Object.assign({},t,{withCredentials:!1});return this.addStatus(t.req,"Abort: Will retry with credentials SUPPRESSED to see if that helps"),this.fetch(e,r)}},{key:"isCrossSite",value:function(e){if("undefined"==typeof document||!document.location)return!1;var t=Uri.hostpart,r=""+document.location;return t(r)&&t(e)&&t(r)!==t(e)}},{key:"handleError",value:function(t,r,n){if(this.isCrossSite(r)){if(n.withCredentials&&!n.retriedWithNoCredentials)return this.retryNoCredentials(r,n);var i=e.crossSiteProxy(r);if(i&&!n.proxyUsed)return console.log("web: Direct failed so trying proxy "+i),this.redirectToProxy(i,n)}var s=t.message||t.status+" "+t.statusText;return this.failFetch(n,"Request failed: "+s,t.status)}},{key:"addType",value:function(e,t,r,n){var i=t;if(n){var s=r.any(i,ns.link("requestedURI"));s&&s!==n&&r.add(r.sym(n),ns.rdf("type"),e,this.appNode)}for(;;){var a=r.any(i,ns.link("requestedURI"));if(a&&a.value&&r.add(r.sym(a.value),ns.rdf("type"),e,this.appNode),!(i=r.any(void 0,r.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),i)))break;var o=r.any(i,r.sym("http://www.w3.org/2007/ont/link#response"));if(!o)break;var l=r.any(o,r.sym("http://www.w3.org/2007/ont/http#status"));if(!l)break;if("301"!==l&&"302"!==l)break}}},{key:"handleResponse",value:function(e,t,r){var n=this,i=this.store,s=e.headers,a=r.req,o=this.saveResponseMetadata(e,r),l=this.normalizedContentType(r,s)||"",u=s.get("content-location");if(0===e.status)return console.log("Masked error - status 0 for "+t),this.handleError(e,t,r);if(e.status>=400)return 404===e.status&&(this.nonexistent[r.original.uri]=!0,this.nonexistent[t]=!0),this.saveErrorResponse(e,o).then(function(){var t="HTTP error for "+r.resource+": "+e.status+" "+e.statusText;return n.failFetch(r,t,e.status)});var d=null,c=null;if(u&&(c=Uri.join(u,t))!==t&&(d=c),200===e.status){this.addType(ns.link("Document"),a,i,t),d&&this.addType(ns.link("Document"),a,i,d),r.clearPreviousData&&i.removeDocument(r.resource);var h=l.includes("image/")||l.includes("application/pdf");l&&h&&(this.addType(i.sym("http://purl.org/dc/terms/Image"),a,i,t),d&&this.addType(i.sym("http://purl.org/dc/terms/Image"),a,i,d))}if(u){if(!r.force&&d&&"done"===this.requested[c])return this.doneFetch(r,e);this.requested[c]=!0}this.parseLinkHeader(s.get("link"),r.original,a);var p=this.handlerForContentType(l,e);return p?e.text().then(function(t){return e.responseText=t,p.parse(n,t,r)}):(this.addStatus(a,"Fetch over. No data handled."),this.doneFetch(r,e))}},{key:"saveErrorResponse",value:function(e,t){var r=this.store;return e.text().then(function(e){e.length>10&&r.add(t,ns.http("content"),r.literal(e),t)})}},{key:"handlerForContentType",value:function(e,t){if(!e)return null;var r=this.handlers.find(function(t){return e.match(t.pattern)});return r?new r(t):null}},{key:"guessContentType",value:function(e){return CONTENT_TYPE_BY_EXT[e.split(".").pop()]}},{key:"normalizedContentType",value:function(e,t){if(e.forceContentType)return e.forceContentType;var r=t.get("content-type");if(!r||r.includes("application/octet-stream")){var n=this.guessContentType(e.resource.uri);if(n)return n}var i=Uri.protocol(e.resource.uri);return!r&&["file","chrome"].includes(i)?"text/xml":r}},{key:"redirectToProxy",value:function(e,t){var r=this;this.addStatus(t.req,"BLOCKED -> Cross-site Proxy to <"+e+">"),t.proxyUsed=!0;var n=this.store,i=t.req;t.noMeta||(n.add(i,ns.link("redirectedTo"),n.sym(e),i),this.addStatus(i,"redirected to new request")),this.requested[t.resource.uri]="redirected",this.redirectedTo[t.resource.uri]=e;var s=Object.assign({},t);return s.baseURI=t.resource.uri,this.fetchUri(e,s).then(function(e){return s.noMeta||n.add(i,ns.link("redirectedRequest"),s.req,r.appNode),e})}},{key:"setRequestTimeout",value:function(e,t){var r=this;return new Promise(function(n){setTimeout(function(){!r.isPending(e)||t.retriedWithNoCredentials||t.proxyUsed||n(r.failFetch(t,"Request to "+e+" timed out","timeout"))},r.timeout)})}},{key:"addFetchCallback",value:function(e,t){this.fetchCallbacks[e]?this.fetchCallbacks[e].push(t):this.fetchCallbacks[e]=[t]}},{key:"acceptString",value:function(){var e="";for(var t in this.mediatypes){""!==e&&(e+=", "),e+=t;for(var r in this.mediatypes[t])e+=";"+r+"="+this.mediatypes[t][r]}return e}}],[{key:"crossSiteProxy",value:function(t){return e.crossSiteProxyTemplate?e.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(t)):void 0}},{key:"offlineOverride",value:function(e){var t=e;return"undefined"!=typeof tabulator&&tabulator.preferences.get("offlineModeUsingLocalhost")&&"http://"===t.slice(0,7)&&"localhost/"!==t.slice(7,17)&&(t="http://localhost/"+t.slice(7),log.warn("Localhost kludge for offline use: actually getting <"+t+">")),t}},{key:"proxyIfNecessary",value:function(t){if("undefined"!=typeof tabulator&&tabulator.isExtension)return t;if("undefined"!=typeof $SolidTestEnvironment&&$SolidTestEnvironment.localSiteMap){var r=t.split("/").slice(2),n=function e(t,r){var n=r[t.shift()];return n?"string"==typeof n?n+t.join("/"):t?e(t,n):null:null}(r,$SolidTestEnvironment.localSiteMap);if(n)return n}return e.crossSiteProxyTemplate&&"undefined"!=typeof document&&document.location&&"https:"===(""+document.location).slice(0,6)&&"http:"===t.slice(0,5)?e.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(t)):t}},{key:"unsupportedProtocol",value:function(e){var t=Uri.protocol(e);return"tel"===t||"mailto"===t||"urn"===t}},{key:"withCredentials",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.startsWith("https:");return void 0!==t.withCredentials&&(r=t.withCredentials),r}}]),e}();module.exports=Fetcher,module.exports.HANDLERS=HANDLERS,module.exports.CONTENT_TYPE_BY_EXT=CONTENT_TYPE_BY_EXT;
},{"./log":56,"./n3parser":57,"./named-node":58,"./namespace":59,"./parse":61,"./rdfaparser":65,"./rdfxmlparser":66,"./serialize":67,"./uri":73,"./util":74,"node-fetch":undefined}],52:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),BlankNode=require("./blank-node"),ClassOrder=require("./class-order"),Collection=require("./collection"),Literal=require("./literal"),log=require("./log"),NamedNode=require("./named-node"),Node=require("./node"),Serializer=require("./serialize"),Statement=require("./statement"),Variable=require("./variable"),Formula=function(e){function t(e,r,n,s){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.termType=t.termType,i.statements=e||[],i.constraints=r||[],i.initBindings=n||[],i.optional=s||[],i}return _inherits(t,e),_createClass(t,[{key:"add",value:function(e,t,r,n){return this.statements.push(new Statement(e,t,r,n))}},{key:"addStatement",value:function(e){return this.statements.push(e)}},{key:"bnode",value:function(e){return new BlankNode(e)}},{key:"bottomTypeURIs",value:function(e){var t,r,n,s,i,o,a,u;t=[];for(i in e)if(e.hasOwnProperty(i)){for(u=e[i],a=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),this.sym(i)),r=!0,s=0,o=a.length;s<o;s++)if(n=a[s],n.uri in e){r=!1;break}r&&(t[i]=u)}return t}},{key:"collection",value:function(){return new Collection}},{key:"each",value:function(e,t,r,n){var s,i,o,a,u,l,h,c,f,w=[],m=this.statementsMatching(e,t,r,n,!1);if(null==e)for(i=0,l=m.length;i<l;i++)s=m[i],w.push(s.subject);else if(null==t)for(o=0,h=m.length;o<h;o++)s=m[o],w.push(s.predicate);else if(null==r)for(a=0,c=m.length;a<c;a++)s=m[a],w.push(s.object);else if(null==n)for(u=0,f=m.length;u<f;u++)s=m[u],w.push(s.why);return w}},{key:"equals",value:function(e){return!!e&&this.hashString()===e.hashString()}},{key:"findMembersNT",value:function(e){var t,r,n,s,i,o,a,u,l,h,c,f,w,m,p,d,y,v,g,b,T;v={},v[e.toNT()]=!0,l={},f=this.transitiveClosure(v,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0);for(b in f)if(f.hasOwnProperty(b)){for(w=this.statementsMatching(void 0,this.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),this.fromNT(b)),t=0,n=w.length;t<n;t++)g=w[t],l[g.subject.toNT()]=g;for(m=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#domain"),this.fromNT(b)),r=0,s=m.length;r<s;r++)for(h=m[r],p=this.statementsMatching(void 0,h),u=0,i=p.length;u<i;u++)g=p[u],l[g.subject.toNT()]=g;for(d=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#range"),this.fromNT(b)),c=0,o=d.length;c<o;c++)for(h=d[c],y=this.statementsMatching(void 0,h),T=0,a=y.length;T<a;T++)g=y[T],l[g.object.toNT()]=g}return l}},{key:"findMemberURIs",value:function(e){return this.NTtoURI(this.findMembersNT(e))}},{key:"findSubClassesNT",value:function(e){var t={};return t[e.toNT()]=!0,this.transitiveClosure(t,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0)}},{key:"findSuperClassesNT",value:function(e){var t={};return t[e.toNT()]=!0,this.transitiveClosure(t,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!1)}},{key:"findTypesNT",value:function(e){var t,r,n,s,i,o,a,u,l,h,c,f,w,m,p,d,y;for(c="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",y=[],f=this.statementsMatching(e,void 0,void 0),r=0,s=f.length;r<s;r++)if(d=f[r],d.predicate.uri===c)y[d.object.toNT()]=d;else for(w=this.each(d.predicate,this.sym("http://www.w3.org/2000/01/rdf-schema#domain")),n=0,i=w.length;n<i;n++)h=w[n],y[h.toNT()]=d;for(m=this.statementsMatching(void 0,void 0,e),u=0,o=m.length;u<o;u++)for(d=m[u],p=this.each(d.predicate,this.sym("http://www.w3.org/2000/01/rdf-schema#range")),l=0,a=p.length;l<a;l++)t=p[l],y[t.toNT()]=d;return this.transitiveClosure(y,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!1)}},{key:"findTypeURIs",value:function(e){return this.NTtoURI(this.findTypesNT(e))}},{key:"connectedStatements",value:function(e,t,r){r=r||[];for(var n=[e],s=[],i=[],o=[],a=this;n.length;)!function(e){var u=function(e){"BlankNode"!==e.termType||s[e.value]||(s[e.value]=!0,n.push(e))},l=a.statementsMatching(null,null,e,t).concat(a.statementsMatching(e,null,null,t));l=l.filter(function(e){if(r[e.predicate.uri])return!1;var t=e.toNT();return!i[t]&&(i[t]=!0,!0)}),l.forEach(function(e,t){u(e.subject),u(e.object)}),o=o.concat(l)}(n.shift());return o}},{key:"formula",value:function(){return new t}},{key:"fromNT",value:function(e){var t,r,n;switch(e[0]){case"<":return this.sym(e.slice(1,-1));case'"':if(n=void 0,t=void 0,(r=e.lastIndexOf('"'))<e.length-1)if("@"===e[r+1])n=e.slice(r+2);else{if("^^"!==e.slice(r+1,r+3))throw new Error("Can't convert string from NT: "+e);t=this.fromNT(e.slice(r+3))}return e=e.slice(1,r),e=e.replace(/\\"/g,'"'),e=e.replace(/\\n/g,"\n"),e=e.replace(/\\\\/g,"\\"),this.literal(e,n,t);case"_":return new BlankNode(e.slice(2));case"?":return new Variable(e.slice(1))}throw new Error("Can't convert from NT: "+e)}},{key:"holds",value:function(e,t,r,n){var s;if(1===arguments.length){if(!e)return!0;if(e instanceof Array){for(s=0;s<e.length;s++)if(!this.holds(e[s]))return!1;return!0}if(e instanceof Statement)return this.holds(e.subject,e.predicate,e.object,e.why);if(e.statements)return this.holds(e.statements)}return null!=this.anyStatementMatching(e,t,r,n)}},{key:"holdsStatement",value:function(e){return this.holds(e.subject,e.predicate,e.object,e.why)}},{key:"list",value:function(e){var t=new Collection;return e.forEach(function(e){t.append(e)}),t}},{key:"literal",value:function(e,t,r){return new Literal(""+e,t,r)}},{key:"NTtoURI",value:function(e){var t,r,n={};for(t in e)e.hasOwnProperty(t)&&(r=e[t],"<"===t[0]&&(n[t.slice(1,-1)]=r));return n}},{key:"serialize",value:function(e,t,r){var n,s,i;switch(i=Serializer(this),i.suggestNamespaces(this.namespaces),i.setBase(e),s=r?this.statementsMatching(void 0,void 0,void 0,r):this.statements,null!=t?t:"text/n3"){case"application/rdf+xml":n=i.statementsToXML(s);break;case"text/n3":case"text/turtle":n=i.statementsToN3(s);break;default:throw new Error("serialize: Content-type "+t+" not supported.")}return n}},{key:"substitute",value:function(e){var r=this.statements.map(function(t){return t.substitute(e)});console.log("Formula subs statmnts:"+r);var n=new t;return n.add(r),console.log("indexed-form subs formula:"+n),n}},{key:"sym",value:function(e,t){if(t)throw new Error("This feature (kb.sym with 2 args) is removed. Do not assume prefix mappings.");return new NamedNode(e)}},{key:"the",value:function(e,t,r,n){var s=this.any(e,t,r,n);return null==s&&log.error("No value found for the() {"+e+" "+t+" "+r+"}."),s}},{key:"transitiveClosure",value:function(e,t,r){var n,s,i,o,a,u,l={};Object.assign(l,e);for(var h={};;){if(null==(u=function(){for(var e in l)if(l.hasOwnProperty(e))return e}()))return h;for(a=r?this.each(void 0,t,this.fromNT(u)):this.each(this.fromNT(u),t),s=0,i=a.length;s<i;s++)n=a[s],(o=n.toNT())in h||o in l||(l[o]=l[u]);h[u]=l[u],delete l[u]}}},{key:"topTypeURIs",value:function(e){var t,r,n,s,i,o,a,u;a=[];for(n in e)if(e.hasOwnProperty(n)){for(u=e[n],i=0,o=this.each(this.sym(n),this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf")),t=0,s=o.length;t<s;t++)if(r=o[t],"http://www.w3.org/2000/01/rdf-schema#Resource"!==r.uri){i++;break}i||(a[n]=u)}return a["http://www.w3.org/2000/01/rdf-schema#Resource"]&&delete a["http://www.w3.org/2000/01/rdf-schema#Resource"],a["http://www.w3.org/2002/07/owl#Thing"]&&delete a["http://www.w3.org/2002/07/owl#Thing"],a}},{key:"toString",value:function(){return"{"+this.statements.join("\n")+"}"}},{key:"whether",value:function(e,t,r,n){return this.statementsMatching(e,t,r,n,!1).length}}]),t}(Node);Formula.termType="Graph",Formula.prototype.classOrder=ClassOrder.Graph,Formula.prototype.isVar=0,Formula.prototype.ns=require("./namespace"),Formula.prototype.variable=function(e){return new Variable(e)},module.exports=Formula;
},{"./blank-node":44,"./class-order":45,"./collection":46,"./literal":55,"./log":56,"./named-node":58,"./namespace":59,"./node":60,"./serialize":67,"./statement":70,"./variable":75}],53:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function handle_FP(e,t,n,r){var i=e.any(t,n,void 0);return!!i&&(e.equate(i,r),!0)}function handle_IFP(e,t,n,r){var i=e.any(void 0,n,r);return!!i&&(e.equate(i,t),!0)}function handleRDFType(e,t,n,r,i){e.typeCallback&&e.typeCallback(e,r,i);var a=e.classActions[r.hashString()],s=!1;if(a)for(var o=0;o<a.length;o++)s=s||a[o](e,t,n,r,i);return s}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ArrayIndexOf=require("./util").ArrayIndexOf,Formula=require("./formula"),RDFArrayRemove=require("./util").RDFArrayRemove,Statement=require("./statement"),Node=require("./node"),Variable=require("./variable"),owl_ns="http://www.w3.org/2002/07/owl#",IndexedFormula=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.propertyActions=[],n.classActions=[],n.redirections=[],n.aliases=[],n.HTTPRedirects=[],n.subjectIndex=[],n.predicateIndex=[],n.objectIndex=[],n.whyIndex=[],n.index=[n.subjectIndex,n.predicateIndex,n.objectIndex,n.whyIndex],n.namespaces={},n.features=e||["sameAs","InverseFunctionalProperty","FunctionalProperty"],n.initPropertyActions(n.features),n}return _inherits(t,e),_createClass(t,[{key:"substitute",value:function(e){var n=this.statements.map(function(t){return t.substitute(e)}),r=new t;return r.add(n),r}},{key:"applyPatch",value:function(e,t,n){var r,i=require("./query").Query,a=this,s=null,o=function(i){if(e.delete){r=e.delete,s&&(r=r.substitute(s)),r=r.statements;var o=[],u=r.map(function(e){var n=a.statementsMatching(e.subject,e.predicate,e.object,t);return 0===n.length?(o.push(e),null):n[0]});if(o.length)return n("Could not find to delete: "+o.join("\n or "));u.map(function(e){a.remove(e)})}e.insert&&(r=e.insert,s&&(r=r.substitute(s)),r=r.statements,r.map(function(e){e.why=t,a.add(e.subject,e.predicate,e.object,e.why)})),i()};if(e.where){var u=new i("patch");u.pat=e.where,u.pat.statements.map(function(e){e.why=t});var h=[];a.query(u,function(e){h.push(e)},a.fetcher,function(){return 0===h.length?n("No match found to be patched:"+e.where):h.length>1?n("Patch ambiguous. No patch done."):(s=h[0],void o(n))})}else o(n)}},{key:"declareExistential",value:function(e){return this._existentialVariables||(this._existentialVariables=[]),this._existentialVariables.push(e),e}},{key:"initPropertyActions",value:function(e){this.propertyActions["<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"]=[handleRDFType],ArrayIndexOf(e,"sameAs")>=0&&(this.propertyActions["<http://www.w3.org/2002/07/owl#sameAs>"]=[function(e,t,n,r,i){return e.equate(t,r),!0}]),ArrayIndexOf(e,"InverseFunctionalProperty")>=0&&(this.classActions["<"+owl_ns+"InverseFunctionalProperty>"]=[function(e,t,n,r,i){return e.newPropertyAction(t,handle_IFP)}]),ArrayIndexOf(e,"FunctionalProperty")>=0&&(this.classActions["<"+owl_ns+"FunctionalProperty>"]=[function(e,t,n,r,i){return e.newPropertyAction(t,handle_FP)}])}},{key:"add",value:function(e,n,r,i){var a;if(1===arguments.length){if(e instanceof Array)for(a=0;a<e.length;a++)this.add(e[a]);else e instanceof Statement?this.add(e.subject,e.predicate,e.object,e.why):e instanceof t&&this.add(e.statements);return this}var s,o;i||(i=this.fetcher?this.fetcher.appNode:this.sym("chrome:theSession")),e=Node.fromValue(e),n=Node.fromValue(n),r=Node.fromValue(r),i=Node.fromValue(i),this.predicateCallback&&this.predicateCallback(this,n,i);var u=this.canon(n).hashString();s=this.propertyActions[u];var h=!1;if(s)for(a=0;a<s.length;a++)h=h||s[a](this,e,n,r,i);if(this.holds(e,n,r,i))return null;var c=[this.canon(e).hashString(),u,this.canon(r).hashString(),this.canon(i).hashString()];for(o=new Statement(e,n,r,i),a=0;a<4;a++){var l=this.index[a],f=c[a];l[f]||(l[f]=[]),l[f].push(o)}return this.statements.push(o),o}},{key:"addAll",value:function(e){var t=this;e.forEach(function(e){t.add(e.subject,e.predicate,e.object,e.graph)})}},{key:"any",value:function(e,t,n,r){var i=this.anyStatementMatching(e,t,n,r);if(null!=i)return null==e?i.subject:null==t?i.predicate:null==n?i.object:void 0}},{key:"anyValue",value:function(e,t,n,r){var i=this.any(e,t,n,r);return i?i.value:void 0}},{key:"anyStatementMatching",value:function(e,t,n,r){var i=this.statementsMatching(e,t,n,r,!0);if(i&&0!==i.length)return i[0]}},{key:"canon",value:function(e){if(!e)return e;var t=this.redirections[e.hashString()];return t||e}},{key:"check",value:function(){this.checkStatementList(this.statements);for(var e=0;e<4;e++){var t=this.index[e];for(var n in t)t.hasOwnProperty(n)&&this.checkStatementList(t[n],e)}}},{key:"checkStatementList",value:function(e,t){for(var n,r=["subject","predicate","object","why"],i=" found in "+r[t]+" index.",a=0;a<e.length;a++){n=e[a];for(var s=[n.subject,n.predicate,n.object,n.why],o=function(e,t){for(var n=0;n<e.length;n++)if(e[n].subject.sameTerm(t.subject)&&e[n].predicate.sameTerm(t.predicate)&&e[n].object.sameTerm(t.object)&&e[n].why.sameTerm(t.why))return!0},u=0;u<4;u++){var h=this.canon(s[u]),c=h.hashString();this.index[u][c]&&o(this.index[u][c],n)}if(!o(this.statements,n))throw new Error("Statement list does not statement "+n+"@"+n.why+i)}}},{key:"close",value:function(){return this}},{key:"copyTo",value:function(e,t,n){n||(n=[]);var r=this.statementsMatching(e);-1!==ArrayIndexOf(n,"two-direction")&&r.concat(this.statementsMatching(void 0,void 0,e));for(var i=0;i<r.length;i++){var a=r[i];switch(a.object.termType){case"NamedNode":this.add(t,a.predicate,a.object);break;case"Literal":case"BlankNode":case"Collection":this.add(t,a.predicate,a.object.copy(this))}-1!==ArrayIndexOf(n,"delete")&&this.remove(a)}}},{key:"equate",value:function(e,t){e=this.canon(e),t=this.canon(t);var n=e.compareTerm(t);return!n||(n<0?this.replaceWith(t,e):this.replaceWith(e,t))}},{key:"formula",value:function(e){return new t(e)}},{key:"match",value:function(e,t,n,r){return this.statementsMatching(Node.fromValue(e),Node.fromValue(t),Node.fromValue(n),Node.fromValue(r))}},{key:"mentionsURI",value:function(e){var t="<"+e+">";return!!this.subjectIndex[t]||!!this.objectIndex[t]||!!this.predicateIndex[t]}},{key:"newExistential",value:function(e){if(!e)return this.bnode();var t=this.sym(e);return this.declareExistential(t)}},{key:"newPropertyAction",value:function(e,t){var n=e.hashString();this.propertyActions[n]||(this.propertyActions[n]=[]),this.propertyActions[n].push(t);for(var r=this.statementsMatching(void 0,e,void 0),i=!1,a=0;a<r.length;a++)i=i||t(this,r[a].subject,e,r[a].object);return i}},{key:"newUniversal",value:function(e){var t=this.sym(e);return this._universalVariables||(this._universalVariables=[]),this._universalVariables.push(t),t}},{key:"variable",value:function(e){return new Variable(e)}},{key:"nextSymbol",value:function(e){for(var t=0;;t++){var n=e.uri+"#n"+t;if(!this.mentionsURI(n))return this.sym(n)}}},{key:"query",value:function(e,t,n,r){return require("./query").indexedFormulaQuery.call(this,e,t,n,r)}},{key:"remove",value:function(e){if(e instanceof Array){for(var n=0;n<e.length;n++)this.remove(e[n]);return this}if(e instanceof t)return this.remove(e.statements);var r=this.statementsMatching(e.subject,e.predicate,e.object,e.why);if(!r.length)throw new Error("Statement to be removed is not on store: "+e);return this.removeStatement(r[0]),this}},{key:"removeDocument",value:function(e){for(var t=this.statementsMatching(void 0,void 0,void 0,e).slice(),n=0;n<t.length;n++)this.removeStatement(t[n]);return this}},{key:"removeMany",value:function(e,t,n,r,i){for(var a=this.statementsMatching(e,t,n,r,!1),s=[],o=0;o<a.length;o++)s.push(a[o]);for(i&&(s=s.slice(0,i)),o=0;o<s.length;o++)this.remove(s[o])}},{key:"removeMatches",value:function(e,t,n,r){return this.removeStatements(this.statementsMatching(e,t,n,r)),this}},{key:"removeStatement",value:function(e){for(var t=[e.subject,e.predicate,e.object,e.why],n=0;n<4;n++){var r=this.canon(t[n]),i=r.hashString();this.index[n][i]&&RDFArrayRemove(this.index[n][i],e)}return RDFArrayRemove(this.statements,e),this}},{key:"removeStatements",value:function(e){for(var t=0;t<e.length;t++)this.remove(e[t]);return this}},{key:"replaceWith",value:function(e,t){for(var n=e.hashString(),r=t.hashString(),i=function(e){var t=e[n];if(t){var i=e[r];e[r]=i?t.concat(i):t,delete e[n]}},a=0;a<4;a++)i(this.index[a]);if(this.redirections[n]=t,e.uri){if(this.aliases[r]||(this.aliases[r]=[]),this.aliases[r].push(e),this.aliases[n])for(a=0;a<this.aliases[n].length;a++)this.redirections[this.aliases[n][a].hashString()]=t,this.aliases[r].push(this.aliases[n][a]);this.add(t,this.sym("http://www.w3.org/2007/ont/link#uri"),e.uri),this.fetcher&&this.fetcher.nowKnownAs(e,t)}return i(this.classActions),i(this.propertyActions),!0}},{key:"allAliases",value:function(e){var t=this.aliases[this.canon(e).hashString()]||[];return t.push(this.canon(e)),t}},{key:"sameThings",value:function(e,t){if(e.sameTerm(t))return!0;var n=this.canon(e);if(!n)return!1;var r=this.canon(t);return!!r&&n.uri===r.uri}},{key:"setPrefixForURI",value:function(e,t){"tab"===e&&this.namespaces.tab||"ns"!==e.slice(0,2)&&"default"!==e.slice(0,7)&&(this.namespaces[e]=t)}},{key:"statementsMatching",value:function(e,t,n,r,i){var a,s,o=[e,t,n,r],u=[],h=[],c=[],l=[];for(a=0;a<4;a++)u[a]=this.canon(Node.fromValue(o[a])),u[a]?(l.push(a),h[a]=u[a].hashString()):c.push(a);if(0===l.length)return this.statements;if(1===l.length)return a=l[0],s=this.index[a][h[a]],s&&i&&s.length>1&&(s=s.slice(0,1)),s=s||[];var f,d,v=1e10;for(d=0;d<l.length;d++){if(a=l[d],!(s=this.index[a][h[a]]))return[];s.length<v&&(v=s.length,f=d)}for(var y=l[f],p=this.index[y][h[y]],m=l.slice(0,f).concat(l.slice(f+1)),b=[],g=["subject","predicate","object","why"],w=0;w<p.length;w++){var k=p[w];for(d=0;d<m.length;d++)if(a=m[d],!this.canon(k[g[a]]).sameTerm(u[a])){k=null;break}if(null!=k&&(b.push(k),i))break}return b}},{key:"uris",value:function(e){var t=this.canon(e),n=this.aliases[t.hashString()];if(!t.uri)return[];var r=[t.uri];if(n)for(var i=0;i<n.length;i++)r.push(n[i].uri);return r}},{key:"length",get:function(){return this.statements.length}}]),t}(Formula);exports.default=IndexedFormula,IndexedFormula.handleRDFType=handleRDFType;
},{"./formula":52,"./node":60,"./query":64,"./statement":70,"./util":74,"./variable":75}],54:[function(require,module,exports){
"use strict";var jsonParser=function(){return{parseJSON:function(e,a,r){var t,l,n,v={},i=r.sym(a);for(var o in e){0===o.indexOf("_:")?v[o]?t=v[o]:(t=r.bnode(o),v[o]=t):t=r.sym(o);var d=e[o];for(var s in d){var u=d[s];l=r.sym(s);for(var y in u){var p=u[y];if("uri"===p.type)n=r.sym(p.value),r.add(t,l,n,i);else if("BlankNode"===p.type)v[p.value]?n=v[p.value]:(n=r.bnode(p.value),v[p.value]=n),r.add(t,l,n,i);else{if("Literal"!==p.type)throw new Error("error: unexpected termtype: "+y.type);n=p.datatype?r.literal(p.value,void 0,r.sym(p.datatype)):p.lang?r.literal(p.value,p.lang):r.literal(p.value),r.add(t,l,n,i)}}}}}}}();module.exports=jsonParser;
},{}],55:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),ClassOrder=require("./class-order"),NamedNode=require("./named-node"),Node=require("./node"),XSD=require("./xsd"),Literal=function(e){function t(e,r,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.termType=t.termType,o.value=e,r&&(o.lang=r,n=XSD.langString),n&&(o.datatype=NamedNode.fromValue(n)),o}return _inherits(t,e),_createClass(t,[{key:"copy",value:function(){return new t(this.value,this.lang,this.datatype)}},{key:"equals",value:function(e){return!!e&&(this.termType===e.termType&&this.value===e.value&&this.language===e.language&&(!this.datatype&&!e.datatype||this.datatype&&this.datatype.equals(e.datatype)))}},{key:"toNT",value:function(){if("number"==typeof this.value)return this.toString();if("string"!=typeof this.value)throw new Error("Value of RDF literal is not string or number: "+this.value);var e=this.value;return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\"/g,'\\"'),e=e.replace(/\n/g,"\\n"),e='"'+e+'"',this.language?e+="@"+this.language:this.datatype.equals(XSD.string)||(e+="^^"+this.datatype.toCanonical()),e}},{key:"toString",value:function(){return""+this.value}},{key:"language",get:function(){return this.lang},set:function(e){this.lang=e||""}}],[{key:"fromBoolean",value:function(e){return new t(e?"1":"0",null,XSD.boolean)}},{key:"fromDate",value:function(e){if(!(e instanceof Date))throw new TypeError("Invalid argument to Literal.fromDate()");var r=function(e){return(""+(100+e)).slice(1,3)};return new t(e.getUTCFullYear()+"-"+r(e.getUTCMonth()+1)+"-"+r(e.getUTCDate())+"T"+r(e.getUTCHours())+":"+r(e.getUTCMinutes())+":"+r(e.getUTCSeconds())+"Z",null,XSD.dateTime)}},{key:"fromNumber",value:function(e){if("number"!=typeof e)throw new TypeError("Invalid argument to Literal.fromNumber()");var r=void 0,n=e.toString();return r=n.indexOf("e")<0&&Math.abs(e)<=Number.MAX_SAFE_INTEGER?Number.isInteger(e)?XSD.integer:XSD.decimal:XSD.double,new t(n,null,r)}},{key:"fromValue",value:function(e){if(void 0===e||null===e)return e;if("object"===(void 0===e?"undefined":_typeof(e))&&e.termType)return e;switch(void 0===e?"undefined":_typeof(e)){case"object":if(e instanceof Date)return t.fromDate(e);case"boolean":return t.fromBoolean(e);case"number":return t.fromNumber(e);case"string":return new t(e)}throw new Error("Can't make literal from "+e+" of type "+(void 0===e?"undefined":_typeof(e)))}}]),t}(Node);Literal.termType="Literal",Literal.prototype.classOrder=ClassOrder.Literal,Literal.prototype.datatype=XSD.string,Literal.prototype.lang="",Literal.prototype.isVar=0,module.exports=Literal;
},{"./class-order":45,"./named-node":58,"./node":60,"./xsd":76}],56:[function(require,module,exports){
"use strict";module.exports={debug:function(n){},warn:function(n){},info:function(n){},error:function(n){},success:function(n){},msg:function(n){}};
},{}],57:[function(require,module,exports){
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uri=require("./uri"),ArrayIndexOf=require("./util").ArrayIndexOf,N3Parser=function(){function t(t){return encodeURI(t)}function e(t,e,r,s,n,o,h,a){return new i(t,e,r,s,n,o,h,a)}function i(t,e,i,r,s,n,o,h){void 0===e&&(e=null),void 0===i&&(i=""),void 0===r&&(r=null),void 0===s&&(s=""),void 0===n&&(n=null),void 0===o&&(o=""),void 0===h&&(h=null),this._bindings=new f([]),this._flags=o,""!=i&&(v(i.indexOf(":")>=0,"Document URI not absolute: "+i),this._bindings[""]=i+"#"),this._store=t,s&&t.setGenPrefix(s),this._thisDoc=i,this.source=t.sym(i),this.lines=0,this.statementCount=0,this.startOfLine=0,this.previousLine=0,this._genPrefix=s,this.keywords=new a(["a","this","bind","has","is","of","true","false"]),this.keywordsSet=0,this._anonymousNodes=new f([]),this._variables=new f([]),this._parentVariables=new f([]),this._reason=h,this._reason2=null,y&&(this._reason2=why_BecauseOfData(t.sym(i),this._reason)),this._baseURI=r||(i||null),v(!this._baseURI||this._baseURI.indexOf(":")>=0),this._genPrefix||(this._thisDoc?this._genPrefix=this._thisDoc+"#_g":this._genPrefix=RDFSink_uniqueURI()),null==e?this._thisDoc?this._formula=t.formula(i+"#_formula"):this._formula=t.formula():this._formula=e,this._context=this._formula,this._parentContext=null}function r(t,e,i,r,s){this._str=i.encode("utf-8"),this._str=i,this._i=r,this._why=s,this.lines=e,this._uri=t}function s(t,e,i,r,s){return"Line "+(e+1)+" of <"+t+">: Bad syntax: "+s+'\nat: "'+c(i,r,r+30)+'"'}var n={encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var r=t.charCodeAt(i);r<128?e+=String.fromCharCode(r):r>127&&r<2048?(e+=String.fromCharCode(r>>6|192),e+=String.fromCharCode(63&r|128)):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128),e+=String.fromCharCode(63&r|128))}return e},decode:function(t){for(var e="",i=0;i<t.length;){var r=t.charCodeAt(i);r<128?(e+=String.fromCharCode(r),i++):r>191&&r<224?(e+=String.fromCharCode((31&r)<<6|63&t.charCodeAt(i+1)),i+=2):(e+=String.fromCharCode((15&r)<<12|(63&t.charCodeAt(i+1))<<6|63&t.charCodeAt(i+2)),i+=3)}return e}},o="http://www.w3.org/2000/10/swap/log#",h=function(t){return t},a=function(t){return t},f=function(t){if(t.length>0)throw"missing.js: oops nnonempty dict not imp";return[]},u=function(t){return t.length},c=function(t,e,i){if(void 0===t.slice)throw"@@ mising.js: No .slice function for "+t+" of type "+(void 0===t?"undefined":_typeof(t));return void 0===i||null==i?t.slice(e):t.slice(e,i)},l=Error("dummy error stop iteration"),p=function(t){return this.last=0,this.li=t,this.next=function(){if(this.last==this.li.length)throw l;return this.li[this.last++]},this},d=function(t,e){return t.indexOf(e)},v=function(t,e){if(!t){if(e)throw"python Assertion failed: "+e;throw"(python) Assertion failed."}},_=function(t){return String.fromCharCode(t)};String.prototype.encode=function(t){if("utf-8"!=t)throw"UTF8_converter: can only do utf-8";return n.encode(this)},String.prototype.decode=function(t){if("utf-8"!=t)throw"UTF8_converter: can only do utf-8";return this};var w=function(t,e){return Uri.join(e,t)},y=0,m="\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~",x=m+":",b=(new RegExp("^[ \\t]*(#[^\\n]*)?\\r?\\n","g"),new RegExp("^[ \\t]*(#[^\\n]*)?$","g"),new RegExp("^[ \\t]*","g"),new RegExp("^[-+]?[0-9]+","g"),new RegExp("^([-+]?[0-9]+)(\\.[0-9]+)?(e[-+]?[0-9]+)?","g")),g=new RegExp("^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9](T[0-9][0-9]:[0-9][0-9](:[0-9][0-9](\\.[0-9]*)?)?)?Z?"),S=(new RegExp("^[0-9]+","g"),new RegExp('[\\\\\\r\\n\\"]',"g")),k=new RegExp("^[a-zA-Z0-9]+(-[a-zA-Z0-9]+)*","g");return i.prototype.here=function(t){return this._genPrefix+"_L"+this.lines+"C"+(t-this.startOfLine+1)},i.prototype.formula=function(){return this._formula},i.prototype.loadStream=function(t){return this.loadBuf(t.read())},i.prototype.loadBuf=function(t){return this.startDoc(),this.feed(t),this.endDoc()},i.prototype.feed=function(t){for(var e=t.decode("utf-8"),i=0;i>=0;){var r=this.skipSpace(e,i);if(r<0)return;var i=this.directiveOrStatement(e,r);if(i<0)throw s(this._thisDoc,this.lines,e,r,"expected directive or statement")}},i.prototype.directiveOrStatement=function(t,e){var i=this.skipSpace(t,e);if(i<0)return i;var r=this.directive(t,i);if(r>=0)return this.checkDot(t,r);var r=this.statement(t,i);return r>=0?this.checkDot(t,r):r},i.prototype.tok=function(t,e,i){if("@"==c(e,i,i+1))var i=i+1;else if(ArrayIndexOf(this.keywords,t)<0)return-1;var r=i+u(t);return c(e,i,r)==t&&m.indexOf(e.charAt(r))>=0?r:-1},i.prototype.directive=function(e,i){var r=this.skipSpace(e,i);if(r<0)return r;var n=new a([]),r=this.tok("bind",e,i);if(r>0)throw s(this._thisDoc,this.lines,e,i,"keyword bind is obsolete: use @prefix");var r=this.tok("keywords",e,i);if(r>0){var i=this.commaSeparatedList(e,r,n,!1);if(i<0)throw s(this._thisDoc,this.lines,e,i,"'@keywords' needs comma separated list of words");return this.setKeywords(c(n,null,null)),i}var r=this.tok("forAll",e,i);if(r>0){var i=this.commaSeparatedList(e,r,n,!0);if(i<0)throw s(this._thisDoc,this.lines,e,i,"Bad variable list after @forAll");var o=new p(n);try{for(;;){var h=o.next();(ArrayIndexOf(this._variables,h)<0||ArrayIndexOf(this._parentVariables,h)>=0)&&(this._variables[h]=this._context.newUniversal(h))}}catch(t){if(t!=l)throw t}return i}var r=this.tok("forSome",e,i);if(r>0){var i=this.commaSeparatedList(e,r,n,this.uri_ref2);if(i<0)throw s(this._thisDoc,this.lines,e,i,"Bad variable list after @forSome");var o=new p(n);try{for(;;){var h=o.next();this._context.declareExistential(h)}}catch(t){if(t!=l)throw t}return i}var r=this.tok("prefix",e,i);if(r>=0){var f=new a([]),i=this.qname(e,r,f);if(i<0)throw s(this._thisDoc,this.lines,e,r,"expected qname after @prefix");var r=this.uri_ref2(e,i,f);if(r<0)throw s(this._thisDoc,this.lines,e,i,"expected <uriref> after @prefix _qname_");var u=f[1].uri;if(this._baseURI)var u=w(this._baseURI,u);else v(u.indexOf(":")>=0,"With no base URI, cannot handle relative URI for NS");return v(u.indexOf(":")>=0),this._bindings[f[0][0]]=u,this.bind(f[0][0],t(u)),r}var r=this.tok("base",e,i);if(r>=0){var f=new a([]),i=this.uri_ref2(e,r,f);if(i<0)throw s(this._thisDoc,this.lines,e,r,"expected <uri> after @base ");var u=f[0].uri;if(!this._baseURI)throw s(this._thisDoc,this.lines,e,r,"With no previous base URI, cannot use relative URI in @base  <"+u+">");var u=w(this._baseURI,u);return v(u.indexOf(":")>=0),this._baseURI=u,i}return-1},i.prototype.bind=function(t,e){""==t||this._store.setPrefixForURI(t,e)},i.prototype.setKeywords=function(t){null==t?this.keywordsSet=0:(this.keywords=t,this.keywordsSet=1)},i.prototype.startDoc=function(){},i.prototype.endDoc=function(){return this._formula},i.prototype.makeStatement=function(t){t[0].add(t[2],t[1],t[3],this.source),this.statementCount+=1},i.prototype.statement=function(t,e){var i=new a([]),e=this.object(t,e,i);if(e<0)return e;var r=this.property_list(t,e,i[0]);if(r<0)throw s(this._thisDoc,this.lines,t,e,"expected propertylist");return r},i.prototype.subject=function(t,e,i){return this.item(t,e,i)},i.prototype.verb=function(t,e,i){var r=this.skipSpace(t,e);if(r<0)return r;var n=new a([]),r=this.tok("has",t,e);if(r>=0){var e=this.prop(t,r,n);if(e<0)throw s(this._thisDoc,this.lines,t,r,"expected property after 'has'");return i.push(new h(["->",n[0]])),e}var r=this.tok("is",t,e);if(r>=0){var e=this.prop(t,r,n);if(e<0)throw s(this._thisDoc,this.lines,t,r,"expected <property> after 'is'");var r=this.skipSpace(t,e);if(r<0)throw s(this._thisDoc,this.lines,t,e,"End of file found, expected property after 'is'");var e=r,r=this.tok("of",t,e);if(r<0)throw s(this._thisDoc,this.lines,t,e,"expected 'of' after 'is' <prop>");return i.push(new h(["<-",n[0]])),r}var r=this.tok("a",t,e);if(r>=0)return i.push(new h(["->",this._store.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type")])),r;if("<="==c(t,e,e+2))return i.push(new h(["<-",this._store.sym(o+"implies")])),e+2;if("="==c(t,e,e+1))return">"==c(t,e+1,e+2)?(i.push(new h(["->",this._store.sym(o+"implies")])),e+2):(i.push(new h(["->",this._store.sym("http://www.w3.org/2002/07/owl#sameAs")])),e+1);if(":="==c(t,e,e+2))return i.push(new h(["->",o+"becomes"])),e+2;var r=this.prop(t,e,n);if(r>=0)return i.push(new h(["->",n[0]])),r;if(">-"==c(t,e,e+2)||"<-"==c(t,e,e+2))throw s(this._thisDoc,this.lines,t,r,">- ... -> syntax is obsolete.");return-1},i.prototype.prop=function(t,e,i){return this.item(t,e,i)},i.prototype.item=function(t,e,i){return this.path(t,e,i)},i.prototype.blankNode=function(t){return this._context.bnode(t,this._reason2)},i.prototype.path=function(t,e,i){var r=this.nodeOrLiteral(t,e,i);if(r<0)return r;for(;"!^.".indexOf(c(t,r,r+1))>=0;){var n=c(t,r,r+1);if("."==n){var o=c(t,r+1,r+2);if(!o||x.indexOf(o)>=0&&":?<[{(".indexOf(o)<0)break}var a=i.pop(),f=this.blankNode(this.here(r)),r=this.node(t,r+1,i);if(r<0)throw s(this._thisDoc,this.lines,t,r,"EOF found in middle of path syntax");var u=i.pop();"^"==n?this.makeStatement(new h([this._context,u,f,a])):this.makeStatement(new h([this._context,u,a,f])),i.push(f)}return r},i.prototype.anonymousNode=function(t){var e=this._anonymousNodes[t];if(e)return e;var e=this._store.bnode(t);return this._anonymousNodes[t]=e,e},i.prototype.node=function(t,e,i,r){void 0===r&&(r=null);var n=r,o=this.skipSpace(t,e);if(o<0)return o;var e=o,d=c(t,e,e+1);if("["==d){var v=this.here(e),o=this.skipSpace(t,e+1);if(o<0)throw s(this._thisDoc,this.lines,t,e,"EOF after '['");if("="==c(t,o,o+1)){var e=o+1,_=new a([]),o=this.objectList(t,e,_);if(!(o>=0))throw s(this._thisDoc,this.lines,t,e,"objectList expected after [= ");var n=_[0];if(u(_)>1){var w=new p(_);try{for(;;){var y=w.next();this.makeStatement(new h([this._context,this._store.sym("http://www.w3.org/2002/07/owl#sameAs"),n,y]))}}catch(t){if(t!=l)throw t}}var o=this.skipSpace(t,o);if(o<0)throw s(this._thisDoc,this.lines,t,e,"EOF when objectList expected after [ = ");if(";"==c(t,o,o+1))var o=o+1}if(null==n)var n=this.blankNode(v);var e=this.property_list(t,o,n);if(e<0)throw s(this._thisDoc,this.lines,t,o,"property_list expected");var o=this.skipSpace(t,e);if(o<0)throw s(this._thisDoc,this.lines,t,e,"EOF when ']' expected after [ <propertyList>");if("]"!=c(t,o,o+1))throw s(this._thisDoc,this.lines,t,o,"']' expected");return i.push(n),o+1}if("{"==d){var m=c(t,e+1,e+2);if("$"==m){e+=1;for(var o=e+1,x=new a([]),b=!0;;){var e=this.skipSpace(t,o);if(e<0)throw s(this._thisDoc,this.lines,t,e,"needed '$}', found end.");if("$}"==c(t,e,e+2)){var o=e+2;break}if(b)var b=!1;else{if(","!=c(t,e,e+1))throw s(this._thisDoc,this.lines,t,e,"expected: ','");e+=1}var g=new a([]),o=this.item(t,e,g);if(o<0)throw s(this._thisDoc,this.lines,t,e,"expected item in set or '$}'");x.push(g[0])}return i.push(this._store.newSet(x,this._context)),o}var o=e+1,S=this._parentContext;this._parentContext=this._context;var k=this._anonymousNodes,D=this._parentVariables;this._parentVariables=this._variables,this._anonymousNodes=new f([]),this._variables=this._variables.slice();var O=this._reason2;if(this._reason2=null,null==n)var n=this._store.formula();for(this._context=n;;){var e=this.skipSpace(t,o);if(e<0)throw s(this._thisDoc,this.lines,t,e,"needed '}', found end.");if("}"==c(t,e,e+1)){var o=e+1;break}var o=this.directiveOrStatement(t,e);if(o<0)throw s(this._thisDoc,this.lines,t,e,"expected statement or '}'")}return this._anonymousNodes=k,this._variables=this._parentVariables,this._parentVariables=D,this._context=this._parentContext,this._reason2=O,this._parentContext=S,i.push(n.close()),o}if("("==d){var A=this._store.list,m=c(t,e+1,e+2);if("$"==m){var A=this._store.newSet;e+=1}for(var o=e+1,x=new a([]);;){var e=this.skipSpace(t,o);if(e<0)throw s(this._thisDoc,this.lines,t,e,"needed ')', found end.");if(")"==c(t,e,e+1)){var o=e+1;break}var g=new a([]),o=this.item(t,e,g);if(o<0)throw s(this._thisDoc,this.lines,t,e,"expected item in list or ')'");x.push(g[0])}return i.push(A(x,this._context)),o}var o=this.tok("this",t,e);if(o>=0)throw s(this._thisDoc,this.lines,t,e,"Keyword 'this' was ancient N3. Now use @forSome and @forAll keywords.");var o=this.tok("true",t,e);if(o>=0)return i.push(!0),o;var o=this.tok("false",t,e);if(o>=0)return i.push(!1),o;if(null==n){var o=this.uri_ref2(t,e,i);if(o>=0)return o}return-1},i.prototype.property_list=function(t,e,i){for(;;){var r=this.skipSpace(t,e);if(r<0)throw s(this._thisDoc,this.lines,t,e,"EOF found when expected verb in property list");if(":-"!=c(t,r,r+2)){var e=r,n=new a([]),r=this.verb(t,e,n);if(r<=0)return e;var o=new a([]),e=this.objectList(t,r,o);if(e<0)throw s(this._thisDoc,this.lines,t,r,"objectList expected");var f=new p(o);try{for(;;){var u=f.next(),d=n[0],v=d[0],_=d[1];"->"==v?this.makeStatement(new h([this._context,_,i,u])):this.makeStatement(new h([this._context,_,u,i]))}}catch(t){if(t!=l)throw t}var r=this.skipSpace(t,e);if(r<0)throw s(this._thisDoc,this.lines,t,r,"EOF found in list of objects");if(";"!=c(t,e,e+1))return e;var e=e+1}else{var e=r+2,w=new a([]),r=this.node(t,e,w,i);if(r<0)throw s(this._thisDoc,this.lines,t,e,"bad {} or () or [] node after :- ");var e=r}}},i.prototype.commaSeparatedList=function(t,e,i,r){var n=this.skipSpace(t,e);if(n<0)throw s(this._thisDoc,this.lines,t,n,"EOF found expecting comma sep list");if("."==t.charAt(n))return e;if(r)var n=this.uri_ref2(t,n,i);else var n=this.bareWord(t,n,i);if(n<0)return-1;for(;;){var e=this.skipSpace(t,n);if(e<0)return e;var o=c(t,e,e+1);if(","!=o)return"."!=o?-1:e;if(r)var n=this.uri_ref2(t,e+1,i);else var n=this.bareWord(t,e+1,i);if(n<0)throw s(this._thisDoc,this.lines,t,n,"bad list content")}},i.prototype.objectList=function(t,e,i){var e=this.object(t,e,i);if(e<0)return-1;for(;;){var r=this.skipSpace(t,e);if(r<0)throw s(this._thisDoc,this.lines,t,r,"EOF found after object");if(","!=c(t,r,r+1))return r;var e=this.object(t,r+1,i);if(e<0)return e}},i.prototype.checkDot=function(t,e){var i=this.skipSpace(t,e);if(i<0)return i;if("."==c(t,i,i+1))return i+1;if("}"==c(t,i,i+1))return i;if("]"==c(t,i,i+1))return i;throw s(this._thisDoc,this.lines,t,i,"expected '.' or '}' or ']' at end of statement")},i.prototype.uri_ref2=function(t,e,i){var r=new a([]),n=this.qname(t,e,r);if(n>=0){var o=r[0],h=o[0],f=o[1];if(null==h){v(0,"not used?");var l=this._baseURI+"#"}else{var l=this._bindings[h];if(!l){if("_"==h)return i.push(this.anonymousNode(f)),n;throw s(this._thisDoc,this.lines,t,e,"Prefix "+h+" not bound.")}}var p=this._store.sym(l+f);return ArrayIndexOf(this._variables,p)>=0?i.push(this._variables[p]):i.push(p),n}var e=this.skipSpace(t,e);if(e<0)return-1;if("?"==t.charAt(e)){var d=new a([]),n=this.variable(t,e,d);return n>0?(i.push(d[0]),n):-1}if("<"==t.charAt(e)){for(var e=e+1,_=e;e<u(t);){if(">"==t.charAt(e)){var y=c(t,_,e);if(this._baseURI)var y=w(this._baseURI,y);else v(y.indexOf(":")>=0,"With no base URI, cannot deal with relative URIs");if("#"==c(t,e-1,e)&&"#"!=c(y,-1,null))var y=y+"#";var p=this._store.sym(y);return ArrayIndexOf(this._variables,p)>=0?i.push(this._variables[p]):i.push(p),e+1}var e=e+1}throw s(this._thisDoc,this.lines,t,n,"unterminated URI reference")}if(this.keywordsSet){var d=new a([]),n=this.bareWord(t,e,d);if(n<0)return-1;if(ArrayIndexOf(this.keywords,d[0])>=0)throw s(this._thisDoc,this.lines,t,e,'Keyword "'+d[0]+'" not allowed here.');return i.push(this._store.sym(this._bindings[""]+d[0])),n}return-1},i.prototype.skipSpace=function(t,e){for(var i=" \n\r\t\f\v\u2028\u2029",r=e||0;r<t.length;r++){var s=t.charAt(r);if(i.indexOf(s)<0){if("#"!==t.charAt(r))return r;for(;;r++){if(r===t.length)return-1;if("\n"===t.charAt(r)){this.lines=this.lines+1;break}}}else"\n"===t.charAt(r)&&(this.lines=this.lines+1)}return-1},i.prototype.variable=function(t,e,i){var r=this.skipSpace(t,e);if(r<0)return-1;if("?"!=c(t,r,r+1))return-1;var r=r+1,e=r;if("0123456789-".indexOf(t.charAt(r))>=0)throw s(this._thisDoc,this.lines,t,r,"Varible name can't start with '"+t.charAt(r)+"s'");for(;e<u(t)&&x.indexOf(t.charAt(e))<0;)var e=e+1;if(null==this._parentContext)throw s(this._thisDoc,this.lines,t,r,"Can't use ?xxx syntax for variable in outermost level: "+c(t,r-1,e));return i.push(this._store.variable(c(t,r,e))),e},i.prototype.bareWord=function(t,e,i){var r=this.skipSpace(t,e);if(r<0)return-1;var s=t.charAt(r);if("0123456789-".indexOf(s)>=0)return-1;if(x.indexOf(s)>=0)return-1;for(var e=r;e<u(t)&&x.indexOf(t.charAt(e))<0;)var e=e+1;return i.push(c(t,r,e)),e},i.prototype.qname=function(t,e,i){var e=this.skipSpace(t,e);if(e<0)return-1;var r=t.charAt(e);if("0123456789-+".indexOf(r)>=0)return-1;if(x.indexOf(r)<0)for(var s=r,e=e+1;e<u(t);){var r=t.charAt(e);if(!(x.indexOf(r)<0))break;var s=s+r,e=e+1}else var s="";if(e<u(t)&&":"==t.charAt(e)){for(var n=s,e=e+1,s="";e<u(t);){var r=t.charAt(e);if(!(x.indexOf(r)<0))break;var s=s+r,e=e+1}return i.push(new h([n,s])),e}return s&&this.keywordsSet&&ArrayIndexOf(this.keywords,s)<0?(i.push(new h(["",s])),e):-1},i.prototype.object=function(t,e,i){var r=this.subject(t,e,i);if(r>=0)return r;var r=this.skipSpace(t,e);if(r<0)return-1;var e=r;if('"'==t.charAt(e)){if('"""'==c(t,e,e+3))var s='"""';else var s='"';var e=e+u(s),n=this.strconst(t,e,s),r=n[0],o=n[1];return i.push(this._store.literal(o)),r}return-1},i.prototype.nodeOrLiteral=function(t,e,i){var r=this.node(t,e,i);if(r>=0)return r;var r=this.skipSpace(t,e);if(r<0)return-1;var e=r;if("-+0987654321".indexOf(t.charAt(e))>=0){g.lastIndex=0;var n=g.exec(t.slice(e));if(null!=n){var o=n[0];r=e+o.length,o.indexOf("T")>=0?i.push(this._store.literal(o,void 0,this._store.sym("http://www.w3.org/2001/XMLSchema#dateTime"))):i.push(this._store.literal(o,void 0,this._store.sym("http://www.w3.org/2001/XMLSchema#date")))}else{b.lastIndex=0;var n=b.exec(t.slice(e));if(null==n)throw s(this._thisDoc,this.lines,t,e,"Bad number or date syntax");r=e+b.lastIndex;var o=c(t,e,r);o.indexOf("e")>=0?i.push(this._store.literal(parseFloat(o),void 0,this._store.sym("http://www.w3.org/2001/XMLSchema#double"))):c(t,e,r).indexOf(".")>=0?i.push(this._store.literal(parseFloat(o),void 0,this._store.sym("http://www.w3.org/2001/XMLSchema#decimal"))):i.push(this._store.literal(parseInt(o),void 0,this._store.sym("http://www.w3.org/2001/XMLSchema#integer")))}return r}if('"'==t.charAt(e)){if('"""'==c(t,e,e+3))var h='"""';else var h='"';var e=e+u(h),f=null,l=this.strconst(t,e,h),r=l[0],p=l[1],d=null;if("@"==c(t,r,r+1)){k.lastIndex=0;var n=k.exec(t.slice(r+1));if(null==n)throw s(this._thisDoc,startline,t,e,"Bad language code syntax on string literal, after @");var e=k.lastIndex+r+1,d=c(t,r+1,e),r=e}if("^^"==c(t,r,r+2))var v=new a([]),r=this.uri_ref2(t,r+2,v),f=v[0];return i.push(this._store.literal(p,d,f)),r}return-1},i.prototype.strconst=function(t,e,i){for(var r=e,n="",o=this.lines;r<u(t);){var e=r+u(i);if(c(t,r,e)==i)return new h([e,n]);if('"'!=t.charAt(r)){S.lastIndex=0;if(!S.exec(t.slice(r)))throw s(this._thisDoc,o,t,r,"Closing quote missing in string at ^ in "+c(t,r-20,r)+"^"+c(t,r,r+20));var e=r+S.lastIndex-1,n=n+c(t,r,e),a=t.charAt(e);if('"'!=a)if("\r"!=a){if("\n"==a){if('"'==i)throw s(this._thisDoc,o,t,e,"newline found in string literal");this.lines=this.lines+1;var n=n+a,r=e+1;this.previousLine=this.startOfLine,this.startOfLine=r}else if("\\"==a){var r=e+1,a=c(t,r,r+1);if(!a)throw s(this._thisDoc,o,t,e,"unterminated string literal (2)");var f=d('abfrtvn\\"',a);if(f>=0)var l='a\b\f\r\t\v\n\\"'.charAt(f),n=n+l,r=r+1;else if("u"==a)var p=this.uEscape(t,r+1,o),r=p[0],a=p[1],n=n+a;else{if("U"!=a)throw s(this._thisDoc,this.lines,t,e,"bad escape");var p=this.UEscape(t,r+1,o),r=p[0],a=p[1],n=n+a}}}else var r=e+1;else var r=e}else var n=n+'"',r=r+1}throw s(this._thisDoc,this.lines,t,e,"unterminated string literal")},i.prototype.uEscape=function(t,e,i){for(var r=e,n=0,o=0;n<4;){var a=c(t,r,r+1),f=a.toLowerCase(),r=r+1;if(""==f)throw s(this._thisDoc,i,t,e,"unterminated string literal(3)");var u=d("0123456789abcdef",f);if(u<0)throw s(this._thisDoc,i,t,e,"bad string literal hex escape");var o=16*o+u,n=n+1}var l=String.fromCharCode(o);return new h([r,l])},i.prototype.UEscape=function(t,e,i){for(var r=e,n=0,o="\\U";n<8;){var a=c(t,r,r+1),f=a.toLowerCase(),r=r+1;if(""==f)throw s(this._thisDoc,i,t,e,"unterminated string literal(3)");if(d("0123456789abcdef",f)<0)throw s(this._thisDoc,i,t,e,"bad string literal hex escape");var o=o+f,n=n+1}var u=_("0x"+c(o,2,10)-0);return new h([r,u])},r.prototype.toString=function(){var t=this._str,e=this._i,i=0;if(e>60)var r="...",i=e-60;else var r="";if(u(t)-e>60)var s="...";else var s="";return'Line %i of <%s>: Bad syntax (%s) at ^ in:\n"%s%s^%s%s"'%new h([this.lines+1,this._uri,this._why,r,c(t,i,e),c(t,e,e+60),s])},e}();module.exports=N3Parser;
},{"./uri":73,"./util":74}],58:[function(require,module,exports){
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),ClassOrder=require("./class-order"),Node=require("./node"),NamedNode=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));if(t.termType=r.termType,e&&e.termType===r.termType&&(e=e.value),!e)throw new Error("Missing IRI for NamedNode");if(!e.includes(":"))throw new Error('NamedNode IRI "'+e+'" must be absolute.');if(e.includes(" ")){var n='Error: NamedNode IRI "'+e+'" must not contain unencoded spaces.';throw new Error(n)}return t.value=e,t}return _inherits(r,e),_createClass(r,[{key:"dir",value:function(){var e=this.uri.split("#")[0],t=e.slice(0,-1).lastIndexOf("/"),n=e.indexOf("//");return n>=0&&t<n+2||t<0?null:new r(e.slice(0,t+1))}},{key:"site",value:function(){var e=this.uri.split("#")[0],t=e.indexOf("//");if(t<0)throw new Error("This URI does not have a web site part (origin)");var n=e.indexOf("/",t+2);if(n<0)throw new Error("This URI does not have a web site part. (origin)");return new r(e.slice(0,n+1))}},{key:"doc",value:function(){return this.uri.indexOf("#")<0?this:new r(this.uri.split("#")[0])}},{key:"toString",value:function(){return"<"+this.uri+">"}},{key:"uri",get:function(){return this.value},set:function(e){this.value=e}}],[{key:"fromValue",value:function(e){return void 0===e||null===e?e:e&&e.termType?e:new r(e)}}]),r}(Node);NamedNode.termType="NamedNode",NamedNode.prototype.classOrder=ClassOrder.NamedNode,NamedNode.prototype.isVar=0,module.exports=NamedNode;
},{"./class-order":45,"./node":60}],59:[function(require,module,exports){
"use strict";function Namespace(e){return function(n){return new NamedNode(e+(n||""))}}var NamedNode=require("./named-node");module.exports=Namespace;
},{"./named-node":58}],60:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Node=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"substitute",value:function(e){return console.log("@@@ node substitute"+this),this}},{key:"compareTerm",value:function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.value<e.value?-1:this.value>e.value?1:0}},{key:"equals",value:function(e){return!!e&&(this.termType===e.termType&&this.value===e.value)}},{key:"hashString",value:function(){return this.toCanonical()}},{key:"sameTerm",value:function(e){return this.equals(e)}},{key:"toCanonical",value:function(){return this.toNT()}},{key:"toNT",value:function(){return this.toString()}},{key:"toString",value:function(){throw new Error("Node.toString() is abstract - see the subclasses instead")}}]),e}();module.exports=Node,Node.fromValue=function(e){var t=require("./collection"),r=require("./literal");require("./named-node");return void 0===e||null===e?e:e&&e.termType?e:Array.isArray(e)?new t(e):r.fromValue(e)};
},{"./collection":46,"./literal":55,"./named-node":58}],61:[function(require,module,exports){
"use strict";function parse(e,r,a,t,l){function n(){l&&l(null,r)}function i(e,a){e&&l(e,r);try{c.parse(a,s)}catch(e){l(e,r)}}function s(e,a,t){if(e&&l(e,r),a)d.push(a);else{for(var n=0;n<d.length;n++)p(r,d[n]);l(null,r)}}function p(e,r){var a=o(r.subject),t=o(r.predicate),l=o(r.object),n=null;r.graph&&(n=o(r.graph)),e.add(a,t,l,n)}function o(e){var r;if(N3.Util.isLiteral(e)){r=N3.Util.getLiteralValue(e);var a=N3.Util.getLiteralLanguage(e),t=new NamedNode(N3.Util.getLiteralType(e));return new Literal(r,a,t)}return N3.Util.isIRI(e)?new NamedNode(e):N3.Util.isBlank(e)?(r=e.substring(2,e.length),new BlankNode(r)):null}t=t||"text/turtle";try{if("text/n3"===t||"text/turtle"===t){N3Parser(r,r,a,a,null,null,"",null).loadBuf(e),n()}else if("application/rdf+xml"===t){var u=new RDFParser(r);u.parse(Util.parseXML(e),a,r.sym(a)),n()}else if("application/xhtml+xml"===t)parseRDFaDOM(Util.parseXML(e,{contentType:"application/xhtml+xml"}),r,a),n();else if("text/html"===t)parseRDFaDOM(Util.parseXML(e,{contentType:"text/html"}),r,a),n();else if("application/sparql-update"===t)sparqlUpdateParser(e,r,a),n();else{if("application/ld+json"!==t&&"application/nquads"!==t&&"application/n-quads"!==t)throw new Error("Don't know how to parse "+t+" yet");var c=N3.Parser(),d=[];if("application/ld+json"===t){var f;try{f=JSON.parse(e)}catch(e){return l(e,null)}jsonld.toRDF(f,{format:"application/nquads",base:a},i)}else i(null,e)}}catch(e){!function(e){if("application/ld+json"!==t||"application/nquads"!==t||"application/n-quads"!==t){if(!l)throw new Error("Error trying to parse <"+a+"> as "+t+":\n"+e+":\n"+e.stack);l(e,r)}}(e)}}module.exports=parse;var BlankNode=require("./blank-node"),jsonld=require("jsonld"),Literal=require("./literal"),N3=require("n3"),N3Parser=require("./n3parser"),NamedNode=require("./named-node"),parseRDFaDOM=require("./rdfaparser").parseRDFaDOM,RDFParser=require("./rdfxmlparser"),sparqlUpdateParser=require("./patch-parser"),Util=require("./util");
},{"./blank-node":44,"./literal":55,"./n3parser":57,"./named-node":58,"./patch-parser":62,"./rdfaparser":65,"./rdfxmlparser":66,"./util":74,"jsonld":13,"n3":14}],62:[function(require,module,exports){
"use strict";function sparqlUpdateParser(e,r,t){var a,i,s,n=["INSERT","DELETE","WHERE"],o=Namespace("http://www.w3.org/ns/pim/patch#"),c=N3Parser(r,r,t,t,null,null,"",null),f={},l=function(e,r,t,a,i){return"Line "+(r+1)+" of <"+e+">: Bad syntax:\n   "+i+'\n   at: "'+t.slice(a,a+30)+'"'};a=0;var p=r.sym(t+"#query");for(f.query=p;;){if((i=c.skipSpace(e,a))<0)return f;if(";"===e[i]){if((a=c.skipSpace(e,i+1))<0)return f;i=a}var h=!1;for(s=0;s<n.length;s++){var d=n[s];if(e.slice(i,i+d.length)===d){if((a=c.skipSpace(e,i+d.length))<0)throw l(c._thisDoc,c.lines,e,i+d.length,"found EOF, needed {...} after "+d);if(("INSERT"===d||"DELETE"===d)&&"DATA"===e.slice(a,a+4)){if((i=c.skipSpace(e,a+4))<0)throw l(c._thisDoc,c.lines,e,a+4,"needed {...} after INSERT DATA "+d);a=i}var u=[];if((i=c.node(e,a,u))<0)throw l(c._thisDoc,c.lines,e,a,"bad syntax or EOF in {...} after "+d);f[d.toLowerCase()]=u[0],r.add(p,o(d.toLowerCase()),u[0]),h=!0,a=i}}if(!h&&"@prefix"===e.slice(i,i+7)){if((a=c.directive(e,i))<0)throw l(c._thisDoc,c.lines,e,a,"bad syntax or EOF after @prefix ");a=c.checkDot(e,a),h=!0}if(!h)throw l(c._thisDoc,c.lines,e,i,"Unknown syntax at start of statememt: '"+e.slice(i).slice(0,20)+"'")}}module.exports=sparqlUpdateParser;var N3Parser=require("./n3parser"),Namespace=require("./namespace");
},{"./n3parser":57,"./namespace":59}],63:[function(require,module,exports){
"use strict";function queryToSPARQL(n){function r(n){for(var r=a()+"SELECT ",t=0;t<n.vars.length;t++)r+=n.vars[t]+" ";return r+="\n"}function t(n){var r="",t=n.statements;for(var o in t)log.debug("Found statement: "+t),r+=a()+t[o]+"\n";return r}function o(n){var r="";for(var t in n.constraints){var o=n.constraints[t];r+=a()+"FILTER ( "+o.describe(t)+" ) \n"}return r}function e(n){for(var r="",u=0;u<n.optional.length;u++)log.debug("Found optional query"),r+=a()+"OPTIONAL { \n",i++,r+=t(n.optional[u]),r+=o(n.optional[u]),r+=e(n.optional[u]),i--,r+=a()+"}\n";return r}function u(n){var r=a()+"WHERE \n{ \n";return i++,r+=t(n),r+=o(n),r+=e(n),i--,r+="}"}function a(){for(var n="",r=0;r<i;r++)n+="    ";return n}var i=0;return function(n){return r(n)+u(n.pat)}(n)}var log=require("./log");module.exports=queryToSPARQL;
},{"./log":56}],64:[function(require,module,exports){
"use strict";function _interopRequireDefault(n){return n&&n.__esModule?n:{default:n}}function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function indexedFormulaQuery(n,t,e,r){function o(n,t){return n.nvars!==t.nvars?n.nvars-t.nvars:n.index.length-t.index.length}var i=function(n){var t,e="";for(t in n)n.hasOwnProperty(t)&&(e+="    "+t+" -> "+n[t]);return e},s=function(n){var t,e="Bindings: ",r=n.length;for(t=0;t<r;t++)e+=i(n[t][0])+";\n\t";return e},u=function(n,t,e,r){var o=e[n];if(void 0===o){if(n.isVar){var i=[];return i[n]=t,[[i,null]]}o=n}if(!o.complexType)return r.redirections[o]&&(o=r.redirections[o]),r.redirections[t]&&(t=r.redirections[t]),o.sameTerm(t)?[[[],null]]:[];if(n instanceof Array)return t instanceof Array?a(n,t,e):[];throw new Error("query.js: oops - code not written yet")},a=function n(t,e,r,o){var i;if(t.length!==e.length)return[];if(!t.length)return[[[],null]];var s=u(t[0],e[0],r,o);if(0===s.length)return s;var a,c,l,h,d,f,g,p=[],b=s.length;for(a=0;a<b;a++){c=s[a][0],g=[];for(d in c)c.hasOwnProperty(d)&&(g[d]=c[d]);for(d in r)r.hasOwnProperty(d)&&(g[d]=r[d]);for(i=n(t.slice(1),e.slice(1),g,o),h=i.length,l=0;l<h;l++){f=i[l][0];for(d in c)c.hasOwnProperty(d)&&(f[d]=c[d]);p.push([f,null])}}return p},c=function(n,t){var e=t[n];return void 0===e?n:e},l=function(n,t){var e,r={};for(e in n)n.hasOwnProperty(e)&&(r[e]=n[e]);for(e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r},h=function(n,t){return this.trunkBindings=t,this.originalCallback=n,this.branches=[],this};h.prototype.checkAllDone=function(){var n;for(n=0;n<this.branches.length;n++)if(!this.branches[n].done)return;log.debug("OPTIONAL BIDNINGS ALL DONE:"),this.doCallBacks(this.branches.length-1,this.trunkBindings)},h.prototype.doCallBacks=function(n,t){var e;if(n<0)return this.originalCallback(t);for(e=0;e<this.branches[n].results.length;e++)this.doCallBacks(n-1,l(t,this.branches[n].results[e]))};var d=function(n,t){return this.count=0,this.success=!1,this.done=!1,this.callback=n,this.onDone=t,this};d.prototype.reportMatch=function(n){this.callback(n),this.success=!0},d.prototype.reportDone=function(){this.done=!0,log.info("Mandatory query branch finished.***"),void 0!==this.onDone&&this.onDone()};var f=function(n){return this.count=0,this.done=!1,this.results=[],this.junction=n,n.branches.push(this),this};f.prototype.reportMatch=function(n){this.results.push(n)},f.prototype.reportDone=function(){log.debug("Optional branch finished - results.length = "+this.results.length),0===this.results.length&&(this.results.push({}),log.debug("Optional branch FAILED - that's OK.")),this.done=!0,this.junction.checkAllDone()};var g=function(n,t,e){var r,o,i,s,u;for(t.nvars=0,t.index=null,o=[t.subject,t.predicate,t.object],u=[n.subjectIndex,n.predicateIndex,n.objectIndex],s=0;s<3;s++)if(o[s].isVar&&void 0===e[o[s]])t.nvars++;else{if(r=c(o[s],e),n.redirections[r.hashString()]&&(r=n.redirections[r.hashString()]),!(i=u[s][r.hashString()]))return t.index=[],!1;(null===t.index||t.index.length>i.length)&&(t.index=i)}return null===t.index&&(t.index=n.statements),!0},p=0,b=function n(e,r,o,s,u,a,c){log.debug("Match begins, Branch count now: "+c.count+" for "+c.pattern_debug);var l=e.fetcher?e.fetcher:null,d=r.statements;if(0===d.length){if(log.debug("FOUND MATCH WITH BINDINGS:"+i(o)),0===r.optional.length)c.reportMatch(o);else{log.debug("OPTIONAL: "+r.optional);var g,b=new h(t,o),v=[];for(g=0;g<r.optional.length;g++)v[g]=new f(b),v[g].pattern_debug=r.optional[g];for(g=0;g<r.optional.length;g++)v[g].count=v[g].count+1,n(e,r.optional[g],o,"",u,t,v[g])}return c.count--,void log.debug("Match ends -- success , Branch count now: "+c.count+" for "+c.pattern_debug)}var m,x,w=d.length;if(l){var j=(p++,function(t,i){var h=t.uri.split("#")[0];l.nowOrWhenFetched(h,void 0,function(i,l,h){i&&console.log("Error following link to <"+t.uri+"> in query: "+l),n(e,r,o,s,u,a,c)})});for(x=0;x<w;x++){if(m=d[x],void 0!==o[m.subject]&&o[m.subject].uri&&l&&"unrequested"===l.getState(docpart(o[m.subject].uri)))return void j(o[m.subject]);if(void 0!==o[m.object]&&o[m.object].uri&&l&&"unrequested"===l.getState(docpart(o[m.object].uri)))return void j(o[m.object])}}y(e,r,o,s,u,a,c)},v=function(n,t){var e,r,o=!0;for(e in n)n.hasOwnProperty(e)&&t[e]&&(r=t[e].test)&&!r(n[e])&&(o=!1);return o},y=function(n,t,e,r,u,c,l){var h,d,f,p,y,m,x,w=t.statements,j=w.length;for(h=0;h<j;h++)x=w[h],log.info("match2: item="+x+", bindingsSoFar="+i(e)),g(n,x,e);w.sort(o),x=w[0];var O=n.formula();O.optional=t.optional,O.constraints=t.constraints,O.statements=w.slice(1),log.debug(r+"match2 searching "+x.index.length+" for "+x+"; bindings so far="+i(e));var D,k,B,_=x.index.length,C=0;for(D=0;D<_;D++)for(B=x.index[D],k=a([x.subject,x.predicate,x.object],[B.subject,B.predicate,B.object],e,n),log.info(r+" From first: "+k.length+": "+s(k)),f=k.length,d=0;d<f;d++)if(y=[],m=k[d][0],v(m,t.constraints)){for(p in m)m.hasOwnProperty(p)&&(y[p]=m[p]);for(p in e)e.hasOwnProperty(p)&&(y[p]=e[p]);l.count++,C++,b(n,O,y,r+"  ",u,c,l)}else log.debug("Branch count CS: "+l.count);l.count--,0===C&&log.debug("Match2 fails completely on "+x),log.debug("Match2 ends, Branch count: "+l.count+" for "+l.pattern_debug),0===l.count&&(log.debug("Branch finished."),l.reportDone())},m=this;log.debug("Query on "+this.statements.length);var x=new d(t,r);x.count++,setTimeout(function(){b(m,n.pat,n.pat.initBindings,"",e,t,x)},0)}var _indexedFormula=require("./indexed-formula"),_indexedFormula2=_interopRequireDefault(_indexedFormula),log=require("./log"),docpart=require("./uri").docpart,Query=function n(t,e){_classCallCheck(this,n),this.pat=new _indexedFormula2.default,this.vars=[],this.name=t,this.id=e};module.exports.Query=Query,module.exports.indexedFormulaQuery=indexedFormulaQuery;
},{"./indexed-formula":53,"./log":56,"./uri":73}],65:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),BlankNode=require("./blank-node"),Literal=require("./literal"),rdf=require("./data-factory"),NamedNode=require("./named-node"),Uri=require("./uri"),Util=require("./util");if(void 0===Node)var Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};var RDFaProcessor=function(){function e(t,a){_classCallCheck(this,e),this.options=a||{},this.kb=t,this.target=a.target||{graph:{subjects:{},prefixes:{},terms:{}}},this.blankNodes=[],this.htmlOptions={selfClosing:"br img input area base basefont col colgroup source wbr isindex link meta param hr"},this.theOne="_:"+(new Date).getTime(),this.language=null,this.vocabulary=null,this.blankCounter=0,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}],this.inXHTMLMode=!1,this.absURIRE=/[\w\_\-]+:\S+/,this.finishedHandlers=[],this.init()}return _createClass(e,[{key:"addTriple",value:function(e,t,a,r){var s,i,n,o;s=void 0===t?rdf.namedNode(this.options.base):this.toRDFNodeObject(t),n=this.toRDFNodeObject(a),i=this.toRDFNodeObject(r),o=rdf.namedNode(this.options.base),this.kb.add(s,n,i,o)}},{key:"ancestorPath",value:function(e){for(var t="";e&&e.nodeType!==Node.DOCUMENT_NODE;)t="/"+e.localName+t,e=e.parentNode;return t}},{key:"copyMappings",value:function(e){var t={};for(var a in e)t[a]=e[a];return t}},{key:"copyProperties",value:function(){}},{key:"deriveDateTimeType",value:function(t){for(var a=0;a<e.dateTimeTypes.length;a++){var r=e.dateTimeTypes[a].pattern.exec(t);if(r&&r[0].length===t.length)return e.dateTimeTypes[a].type}return null}},{key:"init",value:function(){}},{key:"newBlankNode",value:function(){return"_:"+ ++this.blankCounter}},{key:"newSubjectOrigin",value:function(e,t){}},{key:"parseCURIE",value:function(t,a,r){var s,i=t.indexOf(":");if(i>=0){var n=t.substring(0,i);if(""===n)return s=a[""],s?s+t.substring(i+1):null;if("_"===n)return"_:"+t.substring(i+1);if(e.NCNAME.test(n)&&(s=a[n]))return s+t.substring(i+1)}return null}},{key:"parseCURIEOrURI",value:function(e,t,a){var r=this.parseCURIE(e,t,a);return r||this.resolveAndNormalize(a,e)}},{key:"parsePredicate",value:function(e,t,a,r,s,i){if(""===e)return null;var n=this.parseTermOrCURIEOrAbsURI(e,t,i?null:a,r,s);return n&&0===n.indexOf("_:")?null:n}},{key:"parsePrefixMappings",value:function(e,t){for(var a=this.tokenize(e),r=null,s=0;s<a.length;s++)":"===a[s][a[s].length-1]?r=a[s].substring(0,a[s].length-1):r&&(t[r]=this.options.base?Uri.join(a[s],this.options.base):a[s],r=null)}},{key:"parseSafeCURIEOrCURIEOrURI",value:function(e,t,a){return e=this.trim(e),"["===e.charAt(0)&&"]"===e.charAt(e.length-1)?(e=e.substring(1,e.length-1),e=e.trim(e),0===e.length?null:"_:"===e?this.theOne:this.parseCURIE(e,t,a)):this.parseCURIEOrURI(e,t,a)}},{key:"parseTermOrCURIEOrAbsURI",value:function(e,t,a,r,s){e=this.trim(e);var i=this.parseCURIE(e,r,s);if(i)return i;if(a){if(t&&!this.absURIRE.exec(e))return t+e;var n=a[e];if(n)return n;if(n=a[e.toLowerCase()])return n}return this.absURIRE.exec(e)?this.resolveAndNormalize(s,e):null}},{key:"parseTermOrCURIEOrURI",value:function(e,t,a,r,s){e=this.trim(e);var i=this.parseCURIE(e,r,s);if(i)return i;var n=a[e];return n||((n=a[e.toLowerCase()])?n:t&&!this.absURIRE.exec(e)?t+e:this.resolveAndNormalize(s,e))}},{key:"parseURI",value:function(e){return e}},{key:"process",value:function(t,a){var r;t.nodeType===Node.DOCUMENT_NODE?(r=t.baseURI,t=t.documentElement,t.baseURI=r,this.setContext(t)):t.parentNode.nodeType===Node.DOCUMENT_NODE&&this.setContext(t);var s=[],i=function(e){if(!e&&a&&a.baseURI)return a.baseURI;var t=e.indexOf("#");return t>=0&&(e=e.substring(0,t)),a&&a.baseURIMap&&(e=a.baseURIMap(e)),e};for(s.push({current:t,context:this.push(null,i(t.baseURI))});s.length>0;){var n=s.shift();if(n.parent){if(n.context.parent&&n.context.parent.listMapping===n.listMapping)continue;for(var o in n.listMapping){var l=n.listMapping[o];if(0!==l.length){for(var h=[],p=0;p<l.length;p++)h.push(this.newBlankNode());for(var u=0;u<h.length;u++)this.addTriple(n.parent,h[u],"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",l[u]),this.addTriple(n.parent,h[u],"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",{type:e.objectURI,value:u+1<h.length?h[u+1]:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"});this.addTriple(n.parent,n.subject,o,{type:e.objectURI,value:h[0]})}else this.addTriple(n.parent,n.subject,o,{type:e.objectURI,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"})}}else{var c=n.current,d=n.context,g=!1,w=null,v=null,b=null,m=d.prefixes,f=!1,R=[],N=d.listMapping,U=!d.parent,I=d.language,y=d.vocabulary;r=this.parseURI(i(c.baseURI)),c.item=null;var T=c.getAttributeNode("vocab");if(T){var M=this.trim(T.value);if(M.length>0){y=M;var O=r.spec;this.addTriple(c,O,"http://www.w3.org/ns/rdfa#usesVocabulary",{type:e.objectURI,value:y})}else y=this.vocabulary}for(var x=0;x<c.attributes.length;x++){var E=c.attributes[x];if("x"===E.nodeName.charAt(0)&&0===E.nodeName.indexOf("xmlns:")){f||(m=this.copyMappings(m),f=!0);var C=E.nodeName.substring(6),L=e.trim(E.value);m[C]=this.options.base?Uri.join(L,this.options.base):L}}var k=c.getAttributeNode("prefix");k&&(f||(m=this.copyMappings(m),f=!0),this.parsePrefixMappings(k.value,m));for(var D=null,j=0;!D&&j<this.langAttributes.length;j++)D=c.getAttributeNodeNS(this.langAttributes[j].namespaceURI,this.langAttributes[j].localName);if(D){var A=e.trim(D.value);I=A.length>0?A:null}var H,_,P=c.getAttributeNode("rel"),X=c.getAttributeNode("rev"),S=c.getAttributeNode("typeof"),F=c.getAttributeNode("property"),z=c.getAttributeNode("datatype"),B=this.inHTMLMode?c.getAttributeNode("datetime"):null,q=c.getAttributeNode("content"),Y=c.getAttributeNode("about"),Z=c.getAttributeNode("src"),G=c.getAttributeNode("resource"),W=c.getAttributeNode("href"),$=c.getAttributeNode("inlist"),V=[];if(P){_=this.tokenize(P.value);for(var J=0;J<_.length;J++)(H=this.parsePredicate(_[J],y,d.terms,m,r,this.inHTMLMode&&null!==F))&&V.push(H)}var K=[];if(X){_=this.tokenize(X.value);for(var Q=0;Q<_.length;Q++)(H=this.parsePredicate(_[Q],y,d.terms,m,r,this.inHTMLMode&&F))&&K.push(H)}if(this.inHTMLMode&&(P||X)&&F&&(0===V.length&&(P=null),0===K.length&&(X=null)),P||X?(Y&&(w=this.parseSafeCURIEOrCURIEOrURI(Y.value,m,r)),S&&(b=w),w||(c.parentNode.nodeType===Node.DOCUMENT_NODE?w=i(c.baseURI):d.parentObject&&(w=i(c.parentNode.baseURI)===d.parentObject?i(c.baseURI):d.parentObject)),G&&(v=this.parseSafeCURIEOrCURIEOrURI(G.value,m,r)),v||(W?v=this.resolveAndNormalize(r,encodeURI(W.value)):Z?v=this.resolveAndNormalize(r,encodeURI(Z.value)):!S||Y||this.inXHTMLMode&&("head"===c.localName||"body"===c.localName)||(v=this.newBlankNode())),!S||Y||!this.inXHTMLMode||"head"!==c.localName&&"body"!==c.localName?S&&!Y&&(b=v):b=w):!F||q||z?(Y&&(w=this.parseSafeCURIEOrCURIEOrURI(Y.value,m,r)),!w&&G&&(w=this.parseSafeCURIEOrCURIEOrURI(G.value,m,r)),!w&&W&&(w=this.resolveAndNormalize(r,encodeURI(W.value))),!w&&Z&&(w=this.resolveAndNormalize(r,encodeURI(Z.value))),w||(c.parentNode.nodeType===Node.DOCUMENT_NODE?w=i(c.baseURI):!this.inXHTMLMode&&!this.inHTMLMode||"head"!==c.localName&&"body"!==c.localName?S?w=this.newBlankNode():d.parentObject&&(w=i(c.parentNode.baseURI)===d.parentObject?i(c.baseURI):d.parentObject,F||(g=!0)):w=i(c.parentNode.baseURI)===d.parentObject?i(c.baseURI):d.parentObject),S&&(b=w)):(Y&&(w=this.parseSafeCURIEOrCURIEOrURI(Y.value,m,r),S&&(b=w)),w||c.parentNode.nodeType!==Node.DOCUMENT_NODE?!w&&d.parentObject&&(w=i(c.parentNode.baseURI)===d.parentObject?i(c.baseURI):d.parentObject):(w=i(c.baseURI),S&&(b=w)),S&&!b&&(G&&(b=this.parseSafeCURIEOrCURIEOrURI(G.value,m,r)),!b&&W&&(b=this.resolveAndNormalize(r,encodeURI(W.value))),!b&&Z&&(b=this.resolveAndNormalize(r,encodeURI(Z.value))),b||!this.inXHTMLMode&&!this.inHTMLMode||"head"!==c.localName&&"body"!==c.localName||(b=w),b||(b=this.newBlankNode()),v=b)),w&&(Y||G||b)){var ee=w;S&&!Y&&!G&&v&&(ee=v),this.newSubjectOrigin(c,ee)}if(b){_=this.tokenize(S.value);for(var te=0;te<_.length;te++){var ae=this.parseTermOrCURIEOrAbsURI(_[te],y,d.terms,m,r);ae&&this.addTriple(c,b,e.typeURI,{type:e.objectURI,value:ae})}}if(w&&w!==d.parentObject&&(N={},U=!0),v){if(P&&$)for(var re=0;re<V.length;re++){var se=N[V[re]];se||(se=[],N[V[re]]=se),se.push({type:e.objectURI,value:v})}else if(P)for(var ie=0;ie<V.length;ie++)this.addTriple(c,w,V[ie],{type:e.objectURI,value:v});if(X)for(var ne=0;ne<K.length;ne++)this.addTriple(c,v,K[ne],{type:e.objectURI,value:w})}else{if(w&&!v&&(P||X)&&(v=this.newBlankNode()),P&&$)for(var oe=0;oe<V.length;oe++){var le=N[V[oe]];le||(le=[],N[H]=le),R.push({predicate:V[oe],list:le})}else if(P)for(var he=0;he<V.length;he++)R.push({predicate:V[he],forward:!0});if(X)for(var pe=0;pe<K.length;pe++)R.push({predicate:K[pe],forward:!1})}if(F){var ue=null,ce=null;z?(ue=""===z.value?e.PlainLiteralURI:this.parseTermOrCURIEOrAbsURI(z.value,y,d.terms,m,r),ce=B&&!q?B.value:ue===e.XMLLiteralURI||ue===e.HTMLLiteralURI?null:q?q.value:c.textContent):q?(ue=e.PlainLiteralURI,ce=q.value):B?(ce=B.value,(ue=e.deriveDateTimeType(ce))||(ue=e.PlainLiteralURI)):P||X||(G&&(ce=this.parseSafeCURIEOrCURIEOrURI(G.value,m,r)),!ce&&W?ce=this.resolveAndNormalize(r,encodeURI(W.value)):!ce&&Z&&(ce=this.resolveAndNormalize(r,encodeURI(Z.value))),ce&&(ue=e.objectURI)),ue||(S&&!Y?(ue=e.objectURI,ce=b):(ce=c.textContent,this.inHTMLMode&&"time"===c.localName&&(ue=e.deriveDateTimeType(ce)),ue||(ue=e.PlainLiteralURI))),_=this.tokenize(F.value);for(var de=0;de<_.length;de++){var ge=this.parsePredicate(_[de],y,d.terms,m,r);if(ge)if($){var we=N[ge];we||(we=[],N[ge]=we),we.push(ue===e.XMLLiteralURI||ue===e.HTMLLiteralURI?{type:ue,value:c.childNodes}:{type:ue||e.PlainLiteralURI,value:ce,language:I})}else ue===e.XMLLiteralURI||ue===e.HTMLLiteralURI?this.addTriple(c,w,ge,{type:ue,value:c.childNodes}):this.addTriple(c,w,ge,{type:ue||e.PlainLiteralURI,value:ce,language:I})}}if(w&&!g)for(var ve=0;ve<d.incomplete.length;ve++)d.incomplete[ve].list?d.incomplete[ve].list.push({type:e.objectURI,value:w}):d.incomplete[ve].forward?this.addTriple(c,d.subject,d.incomplete[ve].predicate,{type:e.objectURI,value:w}):this.addTriple(c,w,d.incomplete[ve].predicate,{type:e.objectURI,value:d.subject});var be=null,me=w;g?(be=this.push(d,d.subject),be.parentObject=i(c.parentNode.baseURI)===d.parentObject?i(c.baseURI):d.parentObject,be.incomplete=d.incomplete,be.language=I,be.prefixes=m,be.vocabulary=y):(be=this.push(d,w),be.parentObject=v||(w||d.subject),be.prefixes=m,be.incomplete=R,v&&(me=v,N={},U=!0),be.listMapping=N,be.language=I,be.vocabulary=y),U&&s.unshift({parent:c,context:d,subject:me,listMapping:N});for(var fe=c.lastChild;fe;fe=fe.previousSibling)fe.nodeType===Node.ELEMENT_NODE&&(fe.baseURI=c.baseURI,s.unshift({current:fe,context:be}))}}this.inHTMLMode&&this.copyProperties();for(var Re=0;Re<this.finishedHandlers.length;Re++)this.finishedHandlers[Re](t)}},{key:"push",value:function(e,t){return{parent:e,subject:t||(e?e.subject:null),parentObject:null,incomplete:[],listMapping:e?e.listMapping:{},language:e?e.language:this.language,prefixes:e?e.prefixes:this.target.graph.prefixes,terms:e?e.terms:this.target.graph.terms,vocabulary:e?e.vocabulary:this.vocabulary}}},{key:"resolveAndNormalize",value:function(e,t){return Uri.join(t,e)}},{key:"setContext",value:function(e){"html"===e.localName&&"XHTML+RDFa 1.1"===e.getAttribute("version")?this.setXHTMLContext():"html"===e.localName||"http://www.w3.org/1999/xhtml"===e.namespaceURI?"undefined"!=typeof document&&document.doctype?"-//W3C//DTD XHTML+RDFa 1.0//EN"===document.doctype.publicId&&"http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd"===document.doctype.systemId?(console.log("WARNING: RDF 1.0 is not supported.  Defaulting to HTML5 mode."),this.setHTMLContext()):"-//W3C//DTD XHTML+RDFa 1.1//EN"===document.doctype.publicId&&"http://www.w3.org/MarkUp/DTD/xhtml-rdfa-2.dtd"===document.doctype.systemId?this.setXHTMLContext():this.setHTMLContext():this.setHTMLContext():this.setXMLContext()}},{key:"setHTMLContext",value:function(){this.setInitialContext(),this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}],this.inXHTMLMode=!1,this.inHTMLMode=!0}},{key:"setInitialContext",value:function(){this.vocabulary=null,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}]}},{key:"setXHTMLContext",value:function(){this.setInitialContext(),this.inXHTMLMode=!0,this.inHTMLMode=!1,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}],this.target.graph.terms.alternate="http://www.w3.org/1999/xhtml/vocab#alternate",this.target.graph.terms.appendix="http://www.w3.org/1999/xhtml/vocab#appendix",this.target.graph.terms.bookmark="http://www.w3.org/1999/xhtml/vocab#bookmark",this.target.graph.terms.cite="http://www.w3.org/1999/xhtml/vocab#cite",this.target.graph.terms.chapter="http://www.w3.org/1999/xhtml/vocab#chapter",this.target.graph.terms.contents="http://www.w3.org/1999/xhtml/vocab#contents",this.target.graph.terms.copyright="http://www.w3.org/1999/xhtml/vocab#copyright",this.target.graph.terms.first="http://www.w3.org/1999/xhtml/vocab#first",this.target.graph.terms.glossary="http://www.w3.org/1999/xhtml/vocab#glossary",this.target.graph.terms.help="http://www.w3.org/1999/xhtml/vocab#help",this.target.graph.terms.icon="http://www.w3.org/1999/xhtml/vocab#icon",this.target.graph.terms.index="http://www.w3.org/1999/xhtml/vocab#index",this.target.graph.terms.last="http://www.w3.org/1999/xhtml/vocab#last",this.target.graph.terms.license="http://www.w3.org/1999/xhtml/vocab#license",this.target.graph.terms.meta="http://www.w3.org/1999/xhtml/vocab#meta",this.target.graph.terms.next="http://www.w3.org/1999/xhtml/vocab#next",this.target.graph.terms.prev="http://www.w3.org/1999/xhtml/vocab#prev",this.target.graph.terms.previous="http://www.w3.org/1999/xhtml/vocab#previous",this.target.graph.terms.section="http://www.w3.org/1999/xhtml/vocab#section",this.target.graph.terms.stylesheet="http://www.w3.org/1999/xhtml/vocab#stylesheet",this.target.graph.terms.subsection="http://www.w3.org/1999/xhtml/vocab#subsection",this.target.graph.terms.start="http://www.w3.org/1999/xhtml/vocab#start",this.target.graph.terms.top="http://www.w3.org/1999/xhtml/vocab#top",this.target.graph.terms.up="http://www.w3.org/1999/xhtml/vocab#up",this.target.graph.terms.p3pv1="http://www.w3.org/1999/xhtml/vocab#p3pv1",this.target.graph.terms.related="http://www.w3.org/1999/xhtml/vocab#related",this.target.graph.terms.role="http://www.w3.org/1999/xhtml/vocab#role",this.target.graph.terms.transformation="http://www.w3.org/1999/xhtml/vocab#transformation"}},{key:"setXMLContext",value:function(){this.setInitialContext(),this.inXHTMLMode=!1,this.inHTMLMode=!1}},{key:"tokenize",value:function(e){return this.trim(e).split(/\s+/)}},{key:"toRDFNodeObject",value:function(t){if(void 0!==t){if("string"==typeof t)return"_:"===t.substring(0,2)?(void 0===this.blankNodes[t.substring(2)]&&(this.blankNodes[t.substring(2)]=new BlankNode(t.substring(2))),this.blankNodes[t.substring(2)]):rdf.namedNode(t);switch(t.type){case e.objectURI:return"_:"===t.value.substring(0,2)?(void 0===this.blankNodes[t.value.substring(2)]&&(this.blankNodes[t.value.substring(2)]=new BlankNode(t.value.substring(2))),this.blankNodes[t.value.substring(2)]):rdf.namedNode(t.value);case e.PlainLiteralURI:return new Literal(t.value,t.language||"");case e.XMLLiteralURI:case e.HTMLLiteralURI:var a="";return Object.keys(t.value).forEach(function(e){a+=Util.domToString(t.value[e],this.htmlOptions)}),new Literal(a,"",new NamedNode(t.type));default:return new Literal(t.value,"",new NamedNode(t.type))}}}},{key:"trim",value:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}],[{key:"parseRDFaDOM",value:function(t,a,r){var s=new e(a,{base:r});t.baseURI=r,s.process(t)}}]),e}();RDFaProcessor.XMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral",RDFaProcessor.HTMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#HTML",RDFaProcessor.PlainLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral",RDFaProcessor.objectURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#object",RDFaProcessor.typeURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",RDFaProcessor.nameChar="[-A-Z_a-z-----------0-F.0-9--]",RDFaProcessor.nameStartChar="[A-Za-z------------------------------------------------------------------------------------------------------------------------------------------------------_]",RDFaProcessor.NCNAME=new RegExp("^"+RDFaProcessor.nameStartChar+RDFaProcessor.nameChar+"*$"),RDFaProcessor.dateTimeTypes=[{pattern:/-?P(?:[0-9]+Y)?(?:[0-9]+M)?(?:[0-9]+D)?(?:T(?:[0-9]+H)?(?:[0-9]+M)?(?:[0-9]+(?:\.[0-9]+)?S)?)?/,type:"http://www.w3.org/2001/XMLSchema#duration"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]-[0-9][0-9]T(?:[0-1][0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9](?:\.[0-9]+)?(?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#dateTime"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]-[0-9][0-9](?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#date"},{pattern:/(?:[0-1][0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9](?:\.[0-9]+)?(?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#time"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]/,type:"http://www.w3.org/2001/XMLSchema#gYearMonth"},{pattern:/-?[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9]/,type:"http://www.w3.org/2001/XMLSchema#gYear"}],module.exports=RDFaProcessor;
},{"./blank-node":44,"./data-factory":48,"./literal":55,"./named-node":58,"./uri":73,"./util":74}],66:[function(require,module,exports){
"use strict";var uriUtil=require("./uri"),RDFParser=function(e){var t={};t.ns={RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#"},t.nodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},this.frameFactory=function(e,i,n){return{NODE:1,ARC:2,parent:i,parser:e,store:e.store,element:n,lastChild:0,base:null,lang:null,node:null,nodeType:null,listIndex:1,rdfid:null,datatype:null,collection:!1,terminateFrame:function(){this.collection&&this.node.close()},addSymbol:function(e,t){t=uriUtil.join(t,this.base),this.node=this.store.sym(t),this.nodeType=e},loadTriple:function(){if(this.parent.parent.collection?this.parent.parent.node.append(this.node):this.store.add(this.parent.parent.node,this.parent.node,this.node,this.parser.why),null!=this.parent.rdfid){var e=this.store.sym(uriUtil.join("#"+this.parent.rdfid,this.base));this.store.add(e,this.store.sym(t.ns.RDF+"type"),this.store.sym(t.ns.RDF+"Statement"),this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"subject"),this.parent.parent.node,this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"predicate"),this.parent.node,this.parser.why),this.store.add(e,this.store.sym(t.ns.RDF+"object"),this.node,this.parser.why)}},isTripleToLoad:function(){return null!=this.parent&&null!=this.parent.parent&&this.nodeType===this.NODE&&this.parent.nodeType===this.ARC&&this.parent.parent.nodeType===this.NODE},addNode:function(e){this.addSymbol(this.NODE,e),this.isTripleToLoad()&&this.loadTriple()},addCollection:function(){this.nodeType=this.NODE,this.node=this.store.collection(),this.collection=!0,this.isTripleToLoad()&&this.loadTriple()},addCollectionArc:function(){this.nodeType=this.ARC},addBNode:function(e){null!=e?null!=this.parser.bnodes[e]?this.node=this.parser.bnodes[e]:this.node=this.parser.bnodes[e]=this.store.bnode():this.node=this.store.bnode(),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()},addArc:function(e){e===t.ns.RDF+"li"&&(e=t.ns.RDF+"_"+this.parent.listIndex,this.parent.listIndex++),this.addSymbol(this.ARC,e)},addLiteral:function(e){this.parent.datatype?this.node=this.store.literal(e,"",this.store.sym(this.parent.datatype)):this.node=this.store.literal(e,this.lang),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()}}},this.getAttributeNodeNS=function(e,t,i){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,i);else for(var s,r=e.attributes,o=0;o<r.length;++o)if(s=r[o],s.namespaceURI===t&&(s.prefix?s.prefix+":"+i:i)===s.nodeName){n=s;break}return n},this.store=e,this.bnodes={},this.why=null,this.reify=!1,this.parse=function(e,i,n){var s=e.childNodes;this.cleanParser();var r;if(e.nodeType===t.nodeType.DOCUMENT){for(var o=0;o<s.length;o++)if(s[o].nodeType===t.nodeType.ELEMENT){r=s[o];break}}else{if(e.nodeType!==t.nodeType.ELEMENT)throw new Error("RDFParser: can't find root in "+i+". Halting. ");r=e}this.why=n;var a=this.frameFactory(this);return this.base=i,a.base=i,a.lang=null,this.parseDOM(this.buildFrame(a,r)),!0},this.parseDOM=function(e){for(var i,n=function(e){var t="";if(null==e.namespaceURI)throw new Error("RDF/XML syntax error: No namespace for "+e.localName+" in "+this.base);return e.namespaceURI&&(t+=e.namespaceURI),e.localName?t+=e.localName:e.nodeName&&(e.nodeName.indexOf(":")>=0?t+=e.nodeName.split(":")[1]:t+=e.nodeName),t}.bind(this),s=!0;e.parent;){var r=e.element,o=r.attributes;if(r.nodeType===t.nodeType.TEXT||r.nodeType===t.nodeType.CDATA_SECTION)e.parent.nodeType===e.NODE&&(e.addArc(t.ns.RDF+"value"),e=this.buildFrame(e)),e.addLiteral(r.nodeValue);else if(n(r)!==t.ns.RDF+"RDF")if(e.parent&&e.parent.collection&&(e.addCollectionArc(),e=this.buildFrame(e,e.element),e.parent.element=null),e.parent&&e.parent.nodeType&&e.parent.nodeType!==e.ARC){e.addArc(n(r)),this.reify&&(i=this.getAttributeNodeNS(r,t.ns.RDF,"ID"))&&(e.rdfid=i.nodeValue,r.removeAttributeNode(i));var a=this.getAttributeNodeNS(r,t.ns.RDF,"parseType"),d=this.getAttributeNodeNS(r,t.ns.RDF,"datatype");if(d&&(e.datatype=d.nodeValue,r.removeAttributeNode(d)),a){var l=a.nodeValue;"Literal"===l?(e.datatype=t.ns.RDF+"XMLLiteral",e=this.buildFrame(e),e.addLiteral(r),s=!1):"Resource"===l?(e=this.buildFrame(e,e.element),e.parent.element=null,e.addBNode()):"Collection"===l&&(e=this.buildFrame(e,e.element),e.parent.element=null,e.addCollection()),r.removeAttributeNode(a)}if(0!==o.length){var h=this.getAttributeNodeNS(r,t.ns.RDF,"resource"),p=this.getAttributeNodeNS(r,t.ns.RDF,"nodeID");e=this.buildFrame(e),h?(e.addNode(h.nodeValue),r.removeAttributeNode(h)):p?(e.addBNode(p.nodeValue),r.removeAttributeNode(p)):e.addBNode();for(var u=o.length-1;u>=0;u--){var N=this.buildFrame(e);N.addArc(n(o[u])),n(o[u])===t.ns.RDF+"type"?this.buildFrame(N).addNode(o[u].nodeValue):this.buildFrame(N).addLiteral(o[u].nodeValue)}}else 0===r.childNodes.length&&this.buildFrame(e).addLiteral("")}else{var T=this.getAttributeNodeNS(r,t.ns.RDF,"about");if(i=this.getAttributeNodeNS(r,t.ns.RDF,"ID"),T&&i)throw new Error("RDFParser: "+r.nodeName+" has both rdf:id and rdf:about. Halting. Only one of these properties may be specified on a node.");if(!T&&i)e.addNode("#"+i.nodeValue),r.removeAttributeNode(i);else if(null==T&&null==i){var m=this.getAttributeNodeNS(r,t.ns.RDF,"nodeID");m?(e.addBNode(m.nodeValue),r.removeAttributeNode(m)):e.addBNode()}else e.addNode(T.nodeValue),r.removeAttributeNode(T);var y=this.getAttributeNodeNS(r,t.ns.RDF,"type");t.ns.RDF+"Description"!==n(r)&&(y={nodeValue:n(r)}),null!=y&&(this.store.add(e.node,this.store.sym(t.ns.RDF+"type"),this.store.sym(uriUtil.join(y.nodeValue,e.base)),this.why),y.nodeName&&r.removeAttributeNode(y));for(var b=o.length-1;b>=0;b--)this.store.add(e.node,this.store.sym(n(o[b])),this.store.literal(o[b].nodeValue,e.lang),this.why)}for(r=e.element;e.parent;){for(var c=e;null==r;)e=e.parent,r=e.element;var f=r.childNodes&&r.childNodes[e.lastChild];if(f&&s){if((f.nodeType===t.nodeType.ELEMENT||f.nodeType===t.nodeType.TEXT||f.nodeType===t.nodeType.CDATA_SECTION)&&(f.nodeType!==t.nodeType.TEXT&&f.nodeType!==t.nodeType.CDATA_SECTION||1===r.childNodes.length)){e.lastChild++,e=this.buildFrame(c,r.childNodes[e.lastChild-1]);break}e.lastChild++}else{if(e.terminateFrame(),!(e=e.parent))break;r=e.element,s=!0}}}},this.cleanParser=function(){this.bnodes={},this.why=null},this.buildFrame=function(e,i){var n=this.frameFactory(this,e,i);if(e&&(n.base=e.base,n.lang=e.lang),!i||i.nodeType===t.nodeType.TEXT||i.nodeType===t.nodeType.CDATA_SECTION)return n;var s=i.attributes,r=i.getAttributeNode("xml:base");null!=r&&(n.base=r.nodeValue,i.removeAttribute("xml:base"));var o=i.getAttributeNode("xml:lang");null!=o&&(n.lang=o.nodeValue,i.removeAttribute("xml:lang"));for(var a=s.length-1;a>=0;a--)if("xml"===s[a].nodeName.substr(0,3)){if("xmlns:"===s[a].name.slice(0,6)){var d=s[a].nodeValue;this.base&&(d=uriUtil.join(d,this.base)),this.store.setPrefixForURI(s[a].name.slice(6),d)}i.removeAttributeNode(s[a])}return n}};module.exports=RDFParser;
},{"./uri":73}],67:[function(require,module,exports){
"use strict";function serialize(e,t,s,a,r,n){function i(e,t){return r?void r(e,t):t}s=s||e.uri,n=n||{},a=a||"text/turtle";var l=null;try{var o=Serializer(t);n.flags&&o.setFlags(n.flags);var u,c=t.statementsMatching(void 0,void 0,void 0,e);switch(o.suggestNamespaces(t.namespaces),o.setBase(s),a){case"application/rdf+xml":return l=o.statementsToXML(c),i(null,l);case"text/n3":case"application/n3":return l=o.statementsToN3(c),i(null,l);case"text/turtle":case"application/x-turtle":return o.setFlags("si"),l=o.statementsToN3(c),i(null,l);case"application/n-triples":return o.setFlags("deinprstux"),l=o.statementsToNTriples(c),i(null,l);case"application/ld+json":o.setFlags("deinprstux"),u=o.statementsToNTriples(c),convert.convertToJson(u,r);break;case"application/n-quads":case"application/nquads":return o.setFlags("deinprstux q"),l=o.statementsToNTriples(c),i(null,l);default:throw new Error("Serialize: Content-type "+a+" not supported for data write.")}}catch(e){if(r)return r(e);throw e}}module.exports=serialize;var convert=require("./convert"),Serializer=require("./serializer");
},{"./convert":47,"./serializer":68}],68:[function(require,module,exports){
"use strict";var NamedNode=require("./named-node"),BlankNode=require("./blank-node"),Uri=require("./uri"),Util=require("./util"),XSD=require("./xsd"),Serializer=function(){function e(e){return encodeURI(e)}function t(e){for(var t,r="",i=0;i<e.length;i++)t=e.charCodeAt(i),r+=t>65535?"\\U"+("00000000"+t.toString(16)).slice(-8):t>126?"\\u"+("0000"+t.toString(16)).slice(-4):e[i];return r}var r=function(e){this.flags="",this.base=null,this.prefixes=[],this.namespaces=[],this.suggestPrefix("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.suggestPrefix("xml","reserved:reservedForFutureUse"),this.namespacesUsed=[],this.keywords=["a"],this.prefixchars="abcdefghijklmnopqustuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",this.incoming=null,this.formulas=[],this.store=e};return r.prototype.setBase=function(e){return this.base=e,this},r.prototype.setFlags=function(e){return this.flags=e||"",this},r.prototype.toStr=function(e){var t=e.toNT();return"Graph"===e.termType&&(this.formulas[t]=e),t},r.prototype.fromStr=function(e){if("{"===e[0]){var t=this.formulas[e];return t||console.log("No formula object for "+e),t}return this.store.fromNT(e)},r.prototype.suggestPrefix=function(e,t){"default"!==e.slice(0,7)&&"ns"!==e.slice(0,2)&&e&&t&&(e in this.namespaces||t in this.prefixes||(this.prefixes[t]=e,this.namespaces[e]=t))},r.prototype.suggestNamespaces=function(e){for(var t in e)return this.suggestPrefix(t,e[t]),this},r.prototype.checkIntegrity=function(){var e,t;for(e in this.namespaces)if(this.prefixes[this.namespaces[e]]!==e)throw new Error("Serializer integity error 1: "+e+", "+this.namespaces[e]+", "+this.prefixes[this.namespaces[e]]+"!");for(t in this.prefixes)if(this.namespaces[this.prefixes[t]]!==t)throw new Error("Serializer integity error 2: "+t+", "+this.prefixs[t]+", "+this.namespaces[this.prefixes[t]]+"!")},r.prototype.makeUpPrefix=function(e){function t(t){return!!r.prototype.validPrefix.test(t)&&("ns"!==t&&(!(t in this.namespaces)&&(this.prefixes[e]=t,this.namespaces[t]=e,t)))}var i=e,n=t.bind(this);"#/".indexOf(i[i.length-1])>=0&&(i=i.slice(0,-1));var s=i.lastIndexOf("/");s>=0&&(i=i.slice(s+1));for(var a=0;a<i.length&&this.prefixchars.indexOf(i[a]);)a++;if(i=i.slice(0,a),i.length<6&&n(i))return i;if(n(i.slice(0,3)))return i.slice(0,3);if(n(i.slice(0,2)))return i.slice(0,2);if(n(i.slice(0,4)))return i.slice(0,4);if(n(i.slice(0,1)))return i.slice(0,1);if(n(i.slice(0,5)))return i.slice(0,5);r.prototype.validPrefix.test(i)||(i="n");for(var o=0;;o++)if(n(i.slice(0,3)+o))return i.slice(0,3)+o},r.prototype.rootSubjects=function(e){for(var t={},r={},i={},n=0;n<e.length;n++){var s=e[n],a=function(e){t.hasOwnProperty(e)||(t[e]=[]),t[e].push(s.subject)};[s.subject,s.predicate,s.object].map(function(e){"BlankNode"===e.termType?i[e.toNT()]=!0:"Collection"===e.termType&&e.elements.forEach(function(e){a(e)})}),a(e[n].object);var o=r[this.toStr(s.subject)];o||(o=[]),o.push(s),r[this.toStr(s.subject)]=o}var c=[];for(var f in r)if(r.hasOwnProperty(f)){var u=this.fromStr(f);"BlankNode"===u.termType&&t[u]&&1===t[u].length||c.push(u)}this.incoming=t;for(var h={},l=0;l<c.length;l++)h[c[l].toNT()]=!0;return{roots:c,subjects:r,rootsHash:h,incoming:t}},r.prototype.toN3=function(e){return this.statementsToN3(e.statements)},r.prototype._notQNameChars="\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~",r.prototype._notNameChars=r.prototype._notQNameChars+":",r.prototype.explicitURI=function(r){return"<"+(r=this.flags.indexOf("r")<0&&this.base?Uri.refTo(this.base,r):this.flags.indexOf("u")>=0?t(r):e(r))+">"},r.prototype.statementsToNTriples=function(e){var t=e.slice();t.sort();for(var r="",i="http://www.w3.org/1999/02/22-rdf-syntax-ns#",n=this,s=this.store,a=function e(t){if("Collection"!==t.termType)return n.atomicTermToN3(t);for(var a=t.elements,o=s.sym(i+"nill"),c=a.length-1;c>=0;c--){var f=new BlankNode;r+=e(f)+" "+e(s.sym(i+"first"))+" "+e(a[c])+".\n",r+=e(f)+" "+e(s.sym(i+"rest"))+" "+e(o)+".\n",o=f}return n.atomicTermToN3(o)},o=0;o<t.length;o++){var c=t[o],f="";f+=a(c.subject)+" ",f+=a(c.predicate)+" ",f+=a(c.object)+" ",this.flags.indexOf("q")>=0&&(f+=a(c.why)+" "),f+=".\n",r+=f}return r},r.prototype.statementsToN3=function(e){function t(e){for(var t=this.rootSubjects(e),r=t.roots,n=[],s=0;s<r.length;s++){var a=r[s];n.push(i(a,t))}return n}function i(e,t){return"BlankNode"!==e.termType||t.incoming[e]?[v(e,t)].concat([g(e,t)]).concat(["."]):m(e,t,!0).concat(["."])}function n(e,t){var r=[],i=null,n=t.subjects[this.toStr(e)]||[];if(void 0===n)throw new Error("Cant find statements for "+e);for(var s=[],a=0;a<n.length;a++){var o=n[a];o.predicate.uri===i?s.push(","):(i&&(r=r.concat([s]).concat([";"]),s=[]),r.push(h[o.predicate.uri]?h[o.predicate.uri]:v(o.predicate,t))),i=o.predicate.uri,s.push(m(o.object,t))}return r=r.concat([s])}function s(e,t,r){return"BlankNode"!==e.termType||!r&&void 0!==t.rootsHash[e.toNT()]?v(e,t):t.subjects[this.toStr(e)]?["[",g(e,t),"]"]:"[]"}function a(e,t){var r,i;switch(e.termType){case"Graph":return i=["{"],i=i.concat(d(e.statements)),i.concat(["}"]);case"Collection":for(i=["("],r=0;r<e.elements.length;r++)i.push([m(e.elements[r],t)]);return i.push(")"),i;default:return this.atomicTermToN3(e)}}function o(){var e="";this.defaultNamespace&&(e+="@prefix : "+this.explicitURI(this.defaultNamespace)+".\n");for(var t in this.prefixes)this.prefixes.hasOwnProperty(t)&&this.namespacesUsed[t]&&(e+="@prefix "+this.prefixes[t]+": "+this.explicitURI(t)+".\n");return e+"\n"}var c=this.store,f={"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"aaa:00"},u=function(e,t){return Util.heavyCompareSPO(e,t,c,f)};e.sort(u),this.base&&!this.defaultNamespace&&(this.defaultNamespace=this.base+"#");var h={};this.flags.indexOf("s")<0&&(h["http://www.w3.org/2002/07/owl#sameAs"]="="),this.flags.indexOf("t")<0&&(h["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"]="a"),this.flags.indexOf("i")<0&&(h["http://www.w3.org/2000/10/swap/log#implies"]="=>");var l=function(e){for(var t="",r=0;r<e;r++)t+=" ";return t},p=function e(t){for(var r="",i=0;i<t.length;i++){var n=t[i],s="string"==typeof n?n:e(n);if(0!==i){var a=r.slice(-1)||" ";","===s||";"===s||("."!==s||"0123456789.".includes(a))&&(r+=" ")}r+=s}return r},d=t.bind(this),g=n.bind(this),m=s.bind(this);r.prototype.termToN3=v;var v=a.bind(this),w=o.bind(this),b=d(e);return w()+function e(t,r){var i="",n=1e5;void 0===r&&(r=-1);for(var s=0;s<t.length;s++){var a=t[s];if("string"!=typeof a){var o=e(a,r+1);if(o.length<10*(80-4*r)&&o.indexOf('"""')<0){var c=p(a);c.length<80-4*r&&(a=c,o="")}o&&(n=1e4),i+=o}if("string"==typeof a){if(1===a.length&&"\n"===i.slice(-1)&&",.;".indexOf(a)>=0){i=i.slice(0,-1)+a+"\n",n+=1;continue}if(n<4*r+4||n+a.length+1<80&&";.".indexOf(i[i.length-2])<0)i=i.slice(0,-1)+" "+a+"\n",n+=a.length+1;else{var f=l(4*r)+a;i+=f+"\n",n=f.length,r<0&&(i+="\n",n=1e5)}}}return i}(b)},r.prototype.atomicTermToN3=function(e,t){switch(e.termType){case"BlankNode":case"Variable":return e.toNT();case"Literal":var r=e.value.toString();if(e.datatype&&this.flags.indexOf("x")<0)switch(e.datatype.uri){case"http://www.w3.org/2001/XMLSchema#integer":return r;case"http://www.w3.org/2001/XMLSchema#decimal":return r.indexOf(".")<0&&(r+=".0"),r;case"http://www.w3.org/2001/XMLSchema#double":return r.indexOf(".")<0&&(r+=".0"),r.indexOf("e")<0&&(r+="e0"),r;case"http://www.w3.org/2001/XMLSchema#boolean":return e.value?"true":"false"}var i=this.stringToN3(e.value);return e.language?i+="@"+e.language:e.datatype.equals(XSD.string)||(i+="^^"+this.atomicTermToN3(e.datatype,t)),i;case"NamedNode":return this.symbolToN3(e);default:throw new Error("Internal: atomicTermToN3 cannot handle "+e+" of termType: "+e.termType)}},r.prototype.validPrefix=new RegExp(/^[a-zA-Z][a-zA-Z0-9]*$/),r.prototype.forbidden1=new RegExp(/[\\"\b\f\r\v\t\n\u0080-\uffff]/gm),r.prototype.forbidden3=new RegExp(/[\\"\b\f\r\v\u0080-\uffff]/gm),r.prototype.stringToN3=function(e,t){t||(t="e");var i,n,s,a,o,c="";for(e.length>20&&'"'!==e.slice(-1)&&t.indexOf("n")<0&&(e.indexOf("\n")>0||e.indexOf('"')>0)?(a='"""',o=r.prototype.forbidden3):(a='"',o=r.prototype.forbidden1),i=0;i<e.length;){o.lastIndex=0;if(null==o.exec(e.slice(i)))break;n=i+o.lastIndex-1,c+=e.slice(i,n);var f=e[n];'"'===f&&'"""'===a&&'"""'!==e.slice(n,n+3)?c+=f:(s='\b\f\r\t\v\n\\"'.indexOf(f),s>=0?c+="\\"+'bfrtvn\\"'[s]:t.indexOf("e")>=0?c+="\\u"+("000"+f.charCodeAt(0).toString(16).toLowerCase()).slice(-4):c+=f),i=n+1}return a+c+e.slice(i)+a},r.prototype.symbolToN3=function(e){var t=e.uri,i=t.indexOf("#");if(i<0&&this.flags.indexOf("/")<0&&(i=t.lastIndexOf("/")),i>=0&&this.flags.indexOf("p")<0&&(0===t.indexOf("http")||0===t.indexOf("ws")||0===t.indexOf("file"))){for(var n=!0,s=i+1;s<t.length;s++)if(r.prototype._notNameChars.indexOf(t[s])>=0){n=!1;break}if(n){var a=t.slice(i+1),o=t.slice(0,i+1);if(this.defaultNamespace&&this.defaultNamespace===o&&this.flags.indexOf("d")<0)return this.flags.indexOf("k")>=0&&this.keyords.indexOf(a)<0?a:":"+a;var c=this.prefixes[o];if(c||(c=this.makeUpPrefix(o)),c)return this.namespacesUsed[o]=!0,c+":"+a}}return this.explicitURI(t)},r.prototype.writeStore=function(e){var t=this.store,r=t.fetcher,i=r&&r.appNode,n=this.store.index[3];for(var s in n){var a=t.fromNT(s);i&&a.sameTerm(i)||e("\n"+this.atomicTermToN3(a)+" "+this.atomicTermToN3(t.sym("http://www.w3.org/2000/10/swap/log#semantics"))+" { "+this.statementsToN3(t.statementsMatching(void 0,void 0,void 0,a))+" }.\n")}t.statementsMatching(void 0,t.sym("http://www.w3.org/2007/ont/link#requestedURI")).map(function(r){e("\n<"+r.object.value+"> log:metadata {\n");var i=t.statementsMatching(void 0,void 0,void 0,r.subject);e(this.statementsToN3(this.statementsToN3(i))),e("}.\n")});var o=[];i&&o.push(i);var c=[];o.map(function(e){c=c.concat(t.statementsMatching(void 0,void 0,void 0,e))}),e(this.statementsToN3(c))},r.prototype.statementsToXML=function(e){function t(e){this.suggestPrefix("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#");for(var t=this.rootSubjects(e),r=t.roots,i=[],n=0;n<r.length;n++){var s=r[n];i.push(g(s,t))}return i}function i(e){return void 0===e?"@@@undefined@@@@":e.replace(/[&<"]/g,function(e){switch(e[0]){case"&":return"&amp;";case"<":return"&lt;";case'"':return"&quot;"}})}function n(e){return i(this.base?Util.uri.refTo(this.base,e.uri):e.uri)}function s(e,t){var r,n,s,o,c=[],f=t.subjects[this.toStr(e)];if(void 0===f)return m(e,t);f.sort(function(e,t){var r=e.predicate.uri,i=t.predicate.uri;if(r.substring(0,u.length)===u||i.substring(0,u.length)===u)return r.localeCompare(i);var n=r.substring(u.length),s=i.substring(u.length),a=parseInt(n,10),o=parseInt(s,10);return isNaN(a)||isNaN(o)||a!==n||o!==s?r.localeCompare(i):a-o});for(var h=0;h<f.length;h++)if(s=f[h],"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"!==s.predicate.uri||r||"symbol"!==s.object.termType){if(o=s.predicate,o.uri.substr(0,u.length)===u){var l=o.uri.substr(u.length),p=parseInt(l,10);l===p.toString()&&(o=new NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#li"))}switch(n=v(o),s.object.termType){case"BlankNode":c=1===t.incoming[s.object].length?c.concat(["<"+n+' rdf:parseType="Resource">',g(s.object,t),"</"+n+">"]):c.concat(["<"+n+' rdf:nodeID="'+s.object.toNT().slice(2)+'"/>']);break;case"NamedNode":c=c.concat(["<"+n+' rdf:resource="'+d(s.object)+'"/>']);break;case"Literal":c=c.concat(["<"+n+(s.object.datatype.equals(XSD.string)?"":' rdf:datatype="'+i(s.object.datatype.uri)+'"')+(s.object.language?' xml:lang="'+s.object.language+'"':"")+">"+i(s.object.value)+"</"+n+">"]);break;case"Collection":c=c.concat(["<"+n+' rdf:parseType="Collection">',a(s.object,t),"</"+n+">"]);break;default:throw new Error("Can't serialize object of type "+s.object.termType+" into XML")}}else r=s.object;var w=r?v(r):"rdf:Description",b="";return"BlankNode"===e.termType?t.incoming[e]&&1===t.incoming[e].length||(b=' rdf:nodeID="'+e.toNT().slice(2)+'"'):b=' rdf:about="'+d(e)+'"',["<"+w+b+">"].concat([c]).concat(["</"+w+">"])}function a(e,t){for(var r=[],i=0;i<e.elements.length;i++)r.push(g(e.elements[i],t));return r}function o(e,t){var r=[],n=t.subjects[this.toStr(e)];if(!n)return r;n.sort();for(var s=0;s<n.length;s++){var o=n[s];switch(o.object.termType){case"BlankNode":r=t.rootsHash[o.object.toNT()]?r.concat(["<"+v(o.predicate)+' rdf:nodeID="'+o.object.toNT().slice(2)+'">',"</"+v(o.predicate)+">"]):r.concat(["<"+v(o.predicate)+' rdf:parseType="Resource">',m(o.object,t),"</"+v(o.predicate)+">"]);break;case"NamedNode":r=r.concat(["<"+v(o.predicate)+' rdf:resource="'+d(o.object)+'"/>']);break;case"Literal":r=r.concat(["<"+v(o.predicate)+(o.object.datatype.equals(XSD.string)?"":' rdf:datatype="'+i(o.object.datatype.value)+'"')+(o.object.language?' xml:lang="'+o.object.language+'"':"")+">"+i(o.object.value)+"</"+v(o.predicate)+">"]);break;case"Collection":r=r.concat(["<"+v(o.predicate)+' rdf:parseType="Collection">',a(o.object,t),"</"+v(o.predicate)+">"]);break;default:throw new Error("Can't serialize object of type "+o.object.termType+" into XML")}}return r}function c(e){var t=e.uri,i=t.indexOf("#");if(i<0&&this.flags.indexOf("/")<0&&(i=t.lastIndexOf("/")),i<0)throw new Error("Cannot make qname out of <"+t+">");for(var n=i+1;n<t.length;n++)if(r.prototype._notNameChars.indexOf(t[n])>=0)throw new Error('Invalid character "'+t[n]+'" cannot be in XML qname for URI: '+t);var s=t.slice(i+1),a=t.slice(0,i+1);if(this.defaultNamespace&&this.defaultNamespace===a&&this.flags.indexOf("d")<0)return s;var o=this.prefixes[a];return o||(o=this.makeUpPrefix(a)),f[a]=!0,o+":"+s}var f=[];f["http://www.w3.org/1999/02/22-rdf-syntax-ns#"]=!0;var u="http://www.w3.org/1999/02/22-rdf-syntax-ns#_",h=function(e){for(var t="",r=0;r<e;r++)t+=" ";return t},l=function e(t){for(var r="",i=0;i<t.length;i++){var n=t[i];r+="string"==typeof n?n:e(n)}return r},p=t.bind(this),d=n.bind(this),g=s.bind(this),m=o.bind(this),v=c.bind(this),w=p(e),b="<rdf:RDF";this.defaultNamespace&&(b+=' xmlns="'+i(this.defaultNamespace)+'"');for(var y in f)if(f.hasOwnProperty(y)){var x=this.base&&this.flags.includes("z")?Util.uri.refTo(this.base,y):y;b+="\n xmlns:"+this.prefixes[y]+'="'+i(x)+'"'}b+=">";var N=[b,w,"</rdf:RDF>"];return function e(t,r){var i,n="",s=1e5;r||(r=0);for(var a=0;a<t.length;a++){var o=t[a];if("string"!=typeof o){var c=e(o,r+1);c.length<10*(80-4*r)&&c.indexOf('"""')<0&&(i=l(o),i.length<80-4*r&&(o="   "+i,c="")),c&&(s=1e4),n+=c}"string"==typeof o&&(s<4*r+4?(n=n.slice(0,-1)+" "+o+"\n",s+=o.length+1):(i=h(4*r)+o,n+=i+"\n",s=i.length))}return n}(N,-1)},function(e){return new r(e)}}();module.exports=Serializer;
},{"./blank-node":44,"./named-node":58,"./uri":73,"./util":74,"./xsd":76}],69:[function(require,module,exports){
"use strict";function SPARQLToQuery(e,r,n){function t(e){if(Q[e])return Q[e];var r=n.variable(e);return Q[e]=r,r}function o(e){return"string"==typeof e&&e.match(/[^ \n\t]/)}function i(e){return"string"==typeof e&&e.match(/^[\?\$]/)}function a(e){return"string"==typeof e?e.replace(/^&lt;/,"<").replace(/&gt;$/,">"):e}function l(e){return"string"==typeof e&&e.match(/^<[^>]*>$/)}function c(e){return"string"==typeof e&&(e.match(/^_:/)||e.match(/^$/))}function s(e){return"string"==typeof e&&e.match(/:$/)}function f(e){return"string"==typeof e&&e.match(/^:|^[^_][^:]*:/)}function u(e){return e.split(":")[0]}function g(e){return e.split(":")[1]}function p(e){return l(e)?e.slice(1,e.length-1):e}function d(e){var r=-1===e.indexOf("'")?null:e.indexOf("'"),t=-1===e.indexOf('"')?null:e.indexOf('"');if(!r&&!t){var o=new Array(1);return o[0]=e,o}var i,a,l=new Array(2);if(!r||t&&t<r)i='"',a=t;else{if(t&&!(r&&r<t))return log.error("SQARQL QUERY OOPS!"),l;i="'",a=r}l[0]=e.slice(0,a);var c=e.slice(a+1).indexOf(i);if(-1===c)return log.error("SPARQL parsing error: no matching parentheses in literal "+e),e;var s;return e.slice(c+a+2).match(/^\^\^/)?(s=e.slice(c+a+2).indexOf(" "),l[1]=n.literal(e.slice(a+1,a+1+c),"",n.sym(p(e.slice(a+4+c,a+2+c+s)))),l=l.concat(d(e.slice(c+a+3+s)))):e.slice(c+a+2).match(/^@/)?(s=e.slice(c+a+2).indexOf(" "),l[1]=n.literal(e.slice(a+1,a+1+c),e.slice(a+3+c,a+2+c+s),null),l=l.concat(d(e.slice(c+a+2+s)))):(l[1]=n.literal(e.slice(a+1,a+1+c),"",null),log.info("Literal found: "+l[1]),l=l.concat(d(e.slice(c+a+2)))),l}function h(e){e=e.replace(/\(/g," ( ").replace(/\)/g," ) ").replace(/</g," <").replace(/>/g,"> ").replace(/{/g," { ").replace(/}/g," } ").replace(/[\t\n\r]/g," ").replace(/; /g," ; ").replace(/\. /g," . ").replace(/, /g," , "),log.info("New str into spaceDelimit: \n"+e);var r=[],n=e.split(" ");for(var t in n)o(n[t])&&(r=r.concat(n[t]));return r}function v(e){for(var r=e,n=0;n<r.length;n++)if("a"===r[n]&&(r[n]="<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"),"is"===r[n]&&"of"===r[n+2]){r.splice(n,1),r.splice(n+1,1);var t=r[n-1];r[n-1]=r[n+1],r[n+1]=t}return r}function y(e){for(var r=[],o=0;o<e.length;o++)"string"==typeof e[o]?(e[o]=a(e[o]),i(e[o])?r[o]=t(e[o].slice(1)):c(e[o])?(log.info(e[o]+" was identified as a bnode."),r[o]=n.bnode()):l(e[o])?(log.info(e[o]+" was identified as a symbol."),r[o]=n.sym(p(e[o]))):f(e[o])?(log.info(e[o]+" was identified as a prefixed symbol"),O[u(e[o])]?r[o]=n.sym(e[o]=O[u(e[o])]+g(e[o])):(log.error("SPARQL error: "+e[o]+" with prefix "+u(e[o])+" does not have a correct prefix entry."),r[o]=e[o])):r[o]=e[o]):r[o]=e[o];return r}function w(e,r){for(var n=0;n<r.length;n++)if("string"==typeof r[n]&&r[n].toLowerCase()===e.toLowerCase())return n;return null}function m(e,r){for(var n=[],t=0;t<r.length;t++)"string"==typeof r[t]&&r[t].toLowerCase()===e.toLowerCase()&&n.push(t);return n}function b(e,r,n){log.info("Looking for a close bracket of type "+n+" in "+e);for(var t=0,o=0;o<e.length;o++)if(e[o]===r&&t++,e[o]===n&&t--,t<0)return o;return log.error("Statement had no close parenthesis in SPARQL query"),0}function L(e){return this.describe=function(r){return r+" = "+e.toNT()},this.test=function(r){return e.sameTerm(r)},this}function R(e){this.describe=function(r){return"REGEXP( '"+e+"' , "+r+" )"},this.test=function(r){var n=e,t=new RegExp(n);return!!r.value&&t.test(r.value)}}function E(e,r){3!==e.length||"Variable"!==e[0].termType||"NamedNode"!==e[2].termType&&"Literal"!==e[2].termType?6===e.length&&"string"==typeof e[0]&&"regexp"===e[0].toLowerCase()&&"("===e[1]&&")"===e[5]&&","===e[3]&&"Variable"===e[4].termType&&"Literal"===e[2].termType&&(log.debug("Constraint added: "+e),r.constraints[e[4]]=new R(e[2].value)):"="===e[1]?(log.debug("Constraint added: "+e),r.constraints[e[0]]=new L(e[2])):">"===e[1]?(log.debug("Constraint added: "+e),r.constraints[e[0]]=new L(e[2])):"<"===e[1]?(log.debug("Constraint added: "+e),r.constraints[e[0]]=new L(e[2])):log.warn("I don't know how to handle the constraint: "+e)}function T(e,r){log.debug("Optional query: "+e+" not yet implemented.");var t=n.formula();P(e,t),r.optional.push(t)}function P(e,r){var n,t=y(e);log.debug("WHERE: "+t);for(var o;w("OPTIONAL",t);)o=w("OPTIONAL",t),log.debug("OPT: "+o+" "+t[o]+" in "+t),"{"!==t[o+1]&&log.warn("Bad optional opening bracket in word "+o),n=b(t.slice(o+2),"{","}"),-1===n?log.error("No matching bracket in word "+o):(T(t.slice(o+2,o+2+n),r),o=w("OPTIONAL",t),n=b(t.slice(o+2),"{","}"),t.splice(o,n+3));for(log.debug("WHERE after optionals: "+t);w("FILTER",t);){var i=w("FILTER",t);"("!==t[i+1]&&log.warn("Bad filter opening bracket in word "+i),n=b(t.slice(i+2),"(",")"),-1===n?log.error("No matching bracket in word "+i):(E(t.slice(i+2,i+2+n),r),i=w("FILTER",t),n=b(t.slice(i+2),"(",")"),t.splice(i,n+3))}log.debug("WHERE after filters and optionals: "+t),A(t,r)}function A(e,r){var n=new Array(1);n[0]=-1;for(var t=n.concat(m(".",e)),o=[],i=0;i<t.length-1;i++)o[i]=e.slice(t[i]+1,t[i+1]);for(i in o){log.info("s+p+o "+i+" = "+o[i]);var a=o[i][0];o[i].splice(0,1);var l=n.concat(m(";",o[i]));l.push(o[i].length);for(var c=[],s=0;s<l.length-1;s++)c[s]=o[i].slice(l[s]+1,l[s+1]);for(i in c){log.info("p+o "+i+" = "+o[i]);var f=c[i][0];c[i].splice(0,1);var u=n.concat(m(",",c[i]));u.push(c[i].length);var g=[];for(s=0;s<u.length-1;s++)g[s]=c[i].slice(u[s]+1,u[s+1]);for(i in g){var p=g[i][0];log.info("Subj="+a+" Pred="+f+" Obj="+p),r.add(a,f,p)}}}}var Q=[];log.info("SPARQL input: \n"+e);var S=new Query,x=function(e){var r=d(e),n=[];for(var t in r)n="string"==typeof r[t]?n.concat(h(r[t])):n.concat(r[t]);return n=v(n),log.info("SPARQL Tokens: "+n),n}(e),O=function(e){var r=m("PREFIX",e),n=[];for(var t in r){var o=e[r[t]+1],i=e[r[t]+2];if(s(o))if(l(i)){log.info("Prefix found: "+o+" -> "+i);var a=u(o),c=p(i);n[a]=c}else log.error("Invalid SPARQL symbol: "+i);else log.error("Invalid SPARQL prefix: "+o)}return n}(x);O.rdf||(O.rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"),O.rdfs||(O.rdfs="http://www.w3.org/2000/01/rdf-schema#");var N=w("SELECT",x),C=w("WHERE",x);if(N<0||C<0||N>C)return log.error("Invalid or nonexistent SELECT and WHERE tags in SPARQL query"),!1;if(function(e,r){log.info("SPARQL vars: "+e);for(var n in e)if(i(e[n])){log.info("Added "+e[n]+" to query variables from SPARQL");var o=t(e[n].slice(1));r.vars.push(o),o.label=e[n].slice(1)}else log.warn("Incorrect SPARQL variable in SELECT: "+e[n])}(x.slice(N+1,C),S),P(x.slice(C+2,x.length-1),S.pat),r)return S;for(var I in S.pat.statements){var k=S.pat.statements[I];"NamedNode"===k.subject.termType&&n.fetcher&&n.fetcher.lookUpThing(k.subject,"sparql:"+k.subject),"NamedNode"===k.object.termType&&n.fetcher&&n.fetcher.lookUpThing(k.object,"sparql:"+k.object)}return S}var log=require("./log"),Query=require("./query").Query;module.exports=SPARQLToQuery;
},{"./log":56,"./query":64}],70:[function(require,module,exports){
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Node=require("./node"),Statement=function(){function t(e,i,n,s){_classCallCheck(this,t),this.subject=Node.fromValue(e),this.predicate=Node.fromValue(i),this.object=Node.fromValue(n),this.why=s}return _createClass(t,[{key:"equals",value:function(t){return t.subject.equals(this.subject)&&t.predicate.equals(this.predicate)&&t.object.equals(this.object)&&t.graph.equals(this.graph)}},{key:"substitute",value:function(e){var i=new t(this.subject.substitute(e),this.predicate.substitute(e),this.object.substitute(e),this.why.substitute(e));return console.log("@@@ statement substitute:"+i),i}},{key:"toCanonical",value:function(){var t=[this.subject.toCanonical(),this.predicate.toCanonical(),this.object.toCanonical()];return this.graph&&"DefaultGraph"!==this.graph.termType&&t.push(this.graph.toCanonical()),t.join(" ")+" ."}},{key:"toNT",value:function(){return[this.subject.toNT(),this.predicate.toNT(),this.object.toNT()].join(" ")+" ."}},{key:"toString",value:function(){return this.toNT()}},{key:"graph",get:function(){return this.why},set:function(t){this.why=t}}]),t}();module.exports=Statement;
},{"./node":60}],71:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_indexedFormula=require("./indexed-formula"),_indexedFormula2=_interopRequireDefault(_indexedFormula),docpart=require("./uri").docpart,Fetcher=require("./fetcher"),namedNode=require("./data-factory").namedNode,Namespace=require("./namespace"),Serializer=require("./serializer"),uriJoin=require("./uri").join,Util=require("./util"),UpdateManager=function(){function e(t){if(_classCallCheck(this,e),this.store=t,t.updater)throw new Error("You can't have two UpdateManagers for the same store");t.fetcher||(t.fetcher=new Fetcher(t)),t.updater=this,this.ifps={},this.fps={},this.ns={},this.ns.link=Namespace("http://www.w3.org/2007/ont/link#"),this.ns.http=Namespace("http://www.w3.org/2007/ont/http#"),this.ns.httph=Namespace("http://www.w3.org/2007/ont/httph#"),this.ns.ldp=Namespace("http://www.w3.org/ns/ldp#"),this.ns.rdf=Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.ns.rdfs=Namespace("http://www.w3.org/2000/01/rdf-schema#"),this.ns.rdf=Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.ns.owl=Namespace("http://www.w3.org/2002/07/owl#"),this.patchControl=[]}return _createClass(e,[{key:"patchControlFor",value:function(e){return this.patchControl[e.uri]||(this.patchControl[e.uri]=[]),this.patchControl[e.uri]}},{key:"editable",value:function(e,t){if(!e)return!1;if(t||(t=this.store),"file:///"===e.slice(0,8)){if(t.holds(t.sym(e),namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),namedNode("http://www.w3.org/2007/ont/link#MachineEditableDocument")))return"LOCALFILE";var n=t.statementsMatching(t.sym(e));return console.log("sparql.editable: Not MachineEditableDocument file "+e+"\n"),console.log(n.map(function(e){return e.toNT()}).join("\n")),!1}var o,r=!1,i=t.each(void 0,this.ns.link("requestedURI"),docpart(e));if(t.holds(namedNode(e),this.ns.rdf("type"),this.ns.ldp("Resource")))return"SPARQL";for(var a,s,l=0;l<i.length;l++)if(void 0!==(o=i[l])){var c=t.any(o,this.ns.link("response"));if(void 0!==o){var u=t.each(c,this.ns.httph("accept-patch"));if(u.length)for(a=0;a<u.length;a++)if(s=u[a].value.trim(),s.indexOf("application/sparql-update")>=0)return"SPARQL";var h=t.each(c,this.ns.httph("ms-author-via"));if(h.length)for(a=0;a<h.length;a++){if(s=h[a].value.trim(),s.indexOf("SPARQL")>=0)return"SPARQL";if(s.indexOf("DAV")>=0)return"DAV"}var f=t.each(c,this.ns.http("status"));if(f.length)for(a=0;a<f.length;a++)200!==f[a]&&404!==f[a]||(r=!0)}else console.log("sparql.editable: No response for "+e+"\n")}if(0===i.length)console.log("sparql.editable: No request for "+e+"\n");else if(r)return!1;console.log("sparql.editable: inconclusive for "+e+"\n")}},{key:"anonymize",value:function(e){return"_:"===e.toNT().substr(0,2)&&this.mentioned(e)?"?"+e.toNT().substr(2):e.toNT()}},{key:"anonymizeNT",value:function(e){return this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+" ."}},{key:"statementBnodes",value:function(e){return[e.subject,e.predicate,e.object].filter(function(e){return e.isBlank})}},{key:"statementArrayBnodes",value:function(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(this.statementBnodes(e[n]));t.sort();for(var o=[],r=0;r<t.length;r++)0!==r&&t[r].sameTerm(t[r-1])||o.push(t[r]);return o}},{key:"cacheIfps",value:function(){this.ifps={};for(var e=this.store.each(void 0,this.ns.rdf("type"),this.ns.owl("InverseFunctionalProperty")),t=0;t<e.length;t++)this.ifps[e[t].uri]=!0;for(this.fps={},e=this.store.each(void 0,this.ns.rdf("type"),this.ns.owl("FunctionalProperty")),t=0;t<e.length;t++)this.fps[e[t].uri]=!0}},{key:"bnodeContext2",value:function(e,t,n){for(var o,r,i=this.store.statementsMatching(void 0,void 0,e,t),a=0;a<i.length;a++)if(this.fps[i[a].predicate.uri]){if(o=i[a].subject,!o.isBlank)return[i[a]];if(n&&(r=this.bnodeContext2(o,t,n-1)))return r.concat([i[a]])}for(i=this.store.statementsMatching(e,void 0,void 0,t),a=0;a<i.length;a++)if(this.ifps[i[a].predicate.uri]){if(o=i[a].object,!o.isBlank)return[i[a]];if(n&&(r=this.bnodeContext2(o,t,n-1)))return r.concat([i[a]])}return null}},{key:"bnodeContext1",value:function(e,t){for(var n=0;n<3;n++){var o=this.bnodeContext2(e,t,n);if(null!==o)return o}return this.store.connectedStatements(e,t)}},{key:"mentioned",value:function(e){return 0!==this.store.statementsMatching(e).length||0!==this.store.statementsMatching(void 0,e).length||0!==this.store.statementsMatching(void 0,void 0,e).length}},{key:"bnodeContext",value:function(e,t){var n=[];if(e.length){this.cacheIfps();for(var o=0;o<e.length;o++){var r=e[o];this.mentioned(r)&&(n=n.concat(this.bnodeContext1(r,t)))}}return n}},{key:"statementContext",value:function(e){var t=this.statementBnodes(e);return this.bnodeContext(t,e.why)}},{key:"contextWhere",value:function(e){var t=this;return e&&0!==e.length?"WHERE { "+e.map(function(e){return t.anonymizeNT(e)}).join("\n")+" }\n":""}},{key:"fire",value:function(e,t,n){var o=this;return Promise.resolve().then(function(){if(!e)throw new Error("No URI given for remote editing operation: "+t);console.log("sparql: sending update to <"+e+">");var n={noMeta:!0,contentType:"application/sparql-update",body:t};return o.store.fetcher.webOperation("PATCH",e,n)}).then(function(o){if(!o.ok){var r="sparql: update failed for <"+e+"> status="+o.status+", "+o.statusText+"\n   for query: "+t;throw console.log(r),new Error(r)}console.log("sparql: update Ok for <"+e+">"),n(e,o.ok,o.responseText,o)}).catch(function(t){n(e,!1,t.message,t)})}},{key:"update_statement",value:function(e){if(!e||e.why){var t=this,n=this.statementContext(e);return{statement:e?[e.subject,e.predicate,e.object,e.why]:void 0,statementNT:e?this.anonymizeNT(e):void 0,where:t.contextWhere(n),set_object:function(e,n){var o=this.where;o+="DELETE DATA { "+this.statementNT+" } ;\n",o+="INSERT DATA { "+this.anonymize(this.statement[0])+" "+this.anonymize(this.statement[1])+" "+this.anonymize(e)+"  . }\n",t.fire(this.statement[3].uri,o,n)}}}}},{key:"insert_statement",value:function(e,t){var n=e instanceof Array?e[0]:e,o=this.contextWhere(this.statementContext(n));if(e instanceof Array){for(var r="",i=0;i<e.length;i++)r+=e[i]+"\n";o+="INSERT DATA { "+r+" }\n"}else o+="INSERT DATA { "+this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+"  . }\n";this.fire(n.why.uri,o,t)}},{key:"delete_statement",value:function(e,t){var n=e instanceof Array?e[0]:e,o=this.contextWhere(this.statementContext(n));if(e instanceof Array){for(var r="",i=0;i<e.length;i++)r+=e[i]+"\n";o+="DELETE DATA { "+r+" }\n"}else o+="DELETE DATA { "+this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+"  . }\n";this.fire(n.why.uri,o,t)}},{key:"requestDownstreamAction",value:function(e,t){var n=this.patchControlFor(e);if(n.pendingUpstream)if(n.downstreamAction){if(""+n.downstreamAction!=""+t)throw new Error("Can't wait for > 1 different downstream actions")}else n.downstreamAction=t;else t(e)}},{key:"clearUpstreamCount",value:function(e){this.patchControlFor(e).upstreamCount=0}},{key:"getUpdatesVia",value:function(e){var t=this.store.fetcher.getHeader(e,"updates-via");return t&&t.length?t[0].trim():null}},{key:"addDownstreamChangeListener",value:function(e,t){var n=this,o=this.patchControlFor(e);o.downstreamChangeListeners||(o.downstreamChangeListeners=[]),o.downstreamChangeListeners.push(t),this.setRefreshHandler(e,function(e){n.reloadAndSync(e)})}},{key:"reloadAndSync",value:function(e){var t=this.patchControlFor(e),n=this;if(t.reloading)return void console.log("   Already reloading - stop");t.reloading=!0;var o=1e3;!function r(){console.log("try reload - timeout = "+o),n.reload(n.store,e,function(n,i,a){if(t.reloading=!1,n){if(t.downstreamChangeListeners)for(var s=0;s<t.downstreamChangeListeners.length;s++)console.log("        Calling downstream listener "+s),t.downstreamChangeListeners[s]()}else 0===a.status?(console.log("Network error refreshing the data. Retrying in "+o/1e3),t.reloading=!0,o*=2,setTimeout(r,o)):console.log("Error "+a.status+"refreshing the data:"+i+". Stopped"+e)})}()}},{key:"setRefreshHandler",value:function(e,t){var n=this.getUpdatesVia(e),o=t,r=this,i=this,a=1500,s=0;if(!n)return console.log("Server doies not support live updates thoughUpdates-Via :-("),!1;n=uriJoin(n,e.uri),n=n.replace(/^http:/,"ws:").replace(/^https:/,"wss:"),console.log("Web socket URI "+n);return function t(){var l;if("undefined"!=typeof WebSocket)l=new WebSocket(n);else if("undefined"!=typeof Services)l=Services.wm.getMostRecentWindow("navigator:browser").WebSocket(n);else{if("undefined"==typeof window||!window.WebSocket)return void console.log("Live update disabled, as WebSocket not supported by platform :-(");l=window.WebSocket(n)}l.onopen=function(){console.log("    websocket open"),a=1500,this.send("sub "+e.uri),s&&(console.log("Web socket has been down, better check for any news."),i.requestDownstreamAction(e,o))};var c=r.patchControlFor(e);c.upstreamCount=0,l.onerror=function(e){console.log("Error on Websocket:",e)},l.onclose=function(e){console.log("*** Websocket closed with code "+e.code+", reason '"+e.reason+"' clean = "+e.clean),a*=2,s+=1,console.log("Retrying in "+a+"ms"),setTimeout(function(){console.log("Trying websocket again"),t()},a)},l.onmessage=function(t){if(t.data&&"pub"===t.data.slice(0,3)){if("upstreamCount"in c&&(c.upstreamCount-=1,c.upstreamCount>=0))return void console.log("just an echo: "+c.upstreamCount);console.log("Assume a real downstream change: "+c.upstreamCount+" -> 0"),c.upstreamCount=0,r.requestDownstreamAction(e,o)}}}(),!0}},{key:"update",value:function(e,t,n){try{var o=this.store,r=e?e instanceof _indexedFormula2.default?e.statements:e instanceof Array?e:[e]:[],i=t?t instanceof _indexedFormula2.default?t.statements:t instanceof Array?t:[t]:[];if(!(r instanceof Array))throw new Error("Type Error "+(void 0===r?"undefined":_typeof(r))+": "+r);if(!(i instanceof Array))throw new Error("Type Error "+(void 0===i?"undefined":_typeof(i))+": "+i);if(0===r.length&&0===i.length)return n(null,!0);var a=r.length?r[0].why:i[0].why;if(!a){var s="Error patching: statement does not specify which document to patch:"+r[0]+", "+i[0];throw console.log(s),new Error(s)}var l=this.patchControlFor(a),c=Date.now(),u=["subject","predicate","object","why"],h={delete:r,insert:i};["insert","delete"].map(function(e){h[e].map(function(e){if(!a.sameTerm(e.why))throw new Error("update: destination "+a+" inconsistent with delete quad "+e.why);u.map(function(t){if(void 0===e[t])throw new Error("update: undefined "+t+" of statement.")})})});var f=this.editable(a.uri,o);if(!f)throw new Error("Can't make changes in uneditable "+a);var d;if(f.indexOf("SPARQL")>=0){var p=[];r.length&&(p=this.statementArrayBnodes(r)),i.length&&(p=p.concat(this.statementArrayBnodes(i)));var m=this.bnodeContext(p,a),g=this.contextWhere(m),v="";if(g.length){if(r.length){for(v+="DELETE { ",d=0;d<r.length;d++)v+=this.anonymizeNT(r[d])+"\n";v+=" }\n"}if(i.length){for(v+="INSERT { ",d=0;d<i.length;d++)v+=this.anonymizeNT(i[d])+"\n";v+=" }\n"}v+=g}else{if(r.length){for(v+="DELETE DATA { ",d=0;d<r.length;d++)v+=this.anonymizeNT(r[d])+"\n";v+=" } \n"}if(i.length){for(r.length&&(v+=" ; "),v+="INSERT DATA { ",d=0;d<i.length;d++)v+=this.anonymizeNT(i[d])+"\n";v+=" }\n"}}l.pendingUpstream=l.pendingUpstream?l.pendingUpstream+1:1,"upstreamCount"in l&&(l.upstreamCount+=1,console.log("upstream count up to : "+l.upstreamCount)),this.fire(a.uri,v,function(e,t,s,u){if(u.elapsedTimeMs=Date.now()-c,console.log("success"),t){try{o.remove(r)}catch(e){t=!1,s="Remote Ok BUT error deleting "+r.length+" from store!!! "+e}for(var h=0;h<i.length;h++)o.add(i[h].subject,i[h].predicate,i[h].object,a)}if(n(e,t,s,u),l.pendingUpstream-=1,0===l.pendingUpstream&&l.downstreamAction){var f=l.downstreamAction;delete l.downstreamAction,console.log("delayed downstream action:"),f(a)}})}else if(f.indexOf("DAV")>=0)this.updateDav(a,r,i,n);else{if(!(f.indexOf("LOCALFILE")>=0))throw new Error("Unhandled edit method: '"+f+"' for "+a);try{this.updateLocalFile(a,r,i,n)}catch(e){n(a.uri,!1,"Exception trying to write back file <"+a.uri+">\n")}}}catch(e){n(void 0,!1,"Exception in update: "+e+"\n"+$rdf.Util.stackString(e))}}},{key:"updateDav",value:function(e,t,n,o){var r=this.store,i=r.any(e,this.ns.link("request"));if(!i)throw new Error("No record of our HTTP GET request for document: "+e);var a=r.any(i,this.ns.link("response"));if(!a)return null;var s=r.the(a,this.ns.httph("content-type")).value,l=void 0,c=r.statementsMatching(void 0,void 0,void 0,e).slice();for(l=0;l<t.length;l++)Util.RDFArrayRemove(c,t[l]);for(l=0;l<n.length;l++)c.push(n[l]);var u,h=this.serialize(e.uri,c,s),f=r.the(a,this.ns.httph("content-location"));f&&(u=uriJoin(f.value,u));var d={contentType:s,noMeta:!0,body:h};return r.fetcher.webOperation("PUT",u,d).then(function(i){if(!i.ok)throw new Error(i.error);for(var a=0;a<t.length;a++)r.remove(t[a]);for(a=0;a<n.length;a++)r.add(n[a].subject,n[a].predicate,n[a].object,e);o(e.uri,i.ok,i.responseText,i)}).catch(function(t){o(e.uri,!1,t.message,t)})}},{key:"updateLocalFile",value:function(e,t,n,o){var r=this.store;console.log("Writing back to local file\n");var i=r.statementsMatching(void 0,void 0,void 0,e).slice(),a=void 0;for(a=0;a<t.length;a++)Util.RDFArrayRemove(i,t[a]);for(a=0;a<n.length;a++)i.push(n[a]);var s=e.uri.lastIndexOf(".");if(s<1)throw new Error("Rewriting file: No filename extension: "+e.uri);var l=e.uri.slice(s+1),c=Fetcher.CONTENT_TYPE_BY_EXT[l];if(!c)throw new Error("File extension ."+l+" not supported for data write");var u=this.serialize(e.uri,i,c);console.log("Writing back: <<<"+u+">>>");var h=e.uri.slice(7),f=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);if(f.initWithPath(h),!f.exists())throw new Error("Rewriting file <"+e.uri+"> but it does not exist!");var d=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);for(d.init(f,42,parseInt("0666",8),0),d.write(u,u.length),d.close(),a=0;a<t.length;a++)r.remove(t[a]);for(a=0;a<n.length;a++)r.add(n[a].subject,n[a].predicate,n[a].object,e);o(e.uri,!0,"")}},{key:"serialize",value:function(e,t,n){var o=this.store,r=void 0;if("string"==typeof t)return t;var i=Serializer(o);switch(i.suggestNamespaces(o.namespaces),i.setBase(e),n){case"text/xml":case"application/rdf+xml":r=i.statementsToXML(t);break;case"text/n3":case"text/turtle":case"application/x-turtle":case"application/n3":r=i.statementsToN3(t);break;default:throw new Error("Content-type "+n+" not supported for data serialization")}return r}},{key:"put",value:function(e,t,n,o){var r=this,i=this.store,a=void 0;return Promise.resolve().then(function(){return a=r.serialize(e.uri,t,n),i.fetcher.webOperation("PUT",e.uri,{contentType:n,body:a})}).then(function(n){if(!n.ok)return o(e.uri,n.ok,n.error,n);delete i.fetcher.nonexistent[e.uri],delete i.fetcher.requested[e.uri],"string"!=typeof t&&t.map(function(e){i.addStatement(e)}),o(e.uri,n.ok,"",n)}).catch(function(t){o(e.uri,!1,t.message)})}},{key:"reload",value:function(e,t,n){var o=Date.now(),r={force:!0,noMeta:!0,clearPreviousData:!0};e.fetcher.nowOrWhenFetched(t.uri,r,function(e,r,i){if(e)if(i.onErrorWasCalled||200!==i.status)console.log("    Non-HTTP error reloading data! onErrorWasCalled="+i.onErrorWasCalled+" status: "+i.status),n(!1,"Non-HTTP error reloading data: "+r,i);else{var a=Date.now()-o;t.reloadTimeTotal||(t.reloadTimeTotal=0),t.reloadTimeCount||(t.reloadTimeCount=0),t.reloadTimeTotal+=a,t.reloadTimeCount+=1,console.log("    Fetch took "+a+"ms, av. of "+t.reloadTimeCount+" = "+t.reloadTimeTotal/t.reloadTimeCount+"ms."),n(!0)}else console.log("    ERROR reloading data: "+r),n(!1,"Error reloading data: "+r,i)})}}]),e}();module.exports=UpdateManager;
},{"./data-factory":48,"./fetcher":51,"./indexed-formula":53,"./namespace":59,"./serializer":68,"./uri":73,"./util":74}],72:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),namedNode=require("./data-factory").namedNode,UpdatesSocket=function(){function e(t,n){_classCallCheck(this,e),this.parent=t,this.via=n,this.connected=!1,this.pending={},this.subscribed={},this.socket={};try{this.socket=new WebSocket(n),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onmessage=this.onMessage,this.socket.onerror=this.onError}catch(e){this.onError(e)}}return _createClass(e,[{key:"_decode",value:function(e){var t,n,s,i,r,o,a;i={},r=function(){var n,s,i,r;for(i=e.split("&"),r=[],n=0,s=i.length;n<s;n++)t=i[n],r.push(t.split("="));return r}();for(n in r)t=r[n],o=[decodeURIComponent(t[0]),decodeURIComponent(t[1])],s=o[0],a=o[1],null==i[s]&&(i[s]=[]),i[s].push(a);return i}},{key:"_send",value:function(e,t,n){var s,i;return i=[e,t,n].join(" "),"function"==typeof(s=this.socket).send?s.send(i):void 0}},{key:"_subscribe",value:function(e){return this._send("sub",e,""),this.subscribed[e]=!0,this.subscribed[e]}},{key:"onClose",value:function(e){var t;this.connected=!1;for(t in this.subscribed)this.pending[t]=!0;return this.subscribed={},this.subscribed}},{key:"onError",value:function(e){throw new Error("onError"+e)}},{key:"onMessage",value:function(e){var t,n;return n=e.data.split(" "),"ping"===n[0]?"function"==typeof(t=this.socket).send?t.send("pong "+n.slice(1).join(" ")):void 0:"pub"===n[0]?this.parent.onUpdate(n[1],this._decode(n[2])):void 0}},{key:"onOpen",value:function(e){var t,n;this.connected=!0,t=[];for(n in this.pending)delete this.pending[n],t.push(this._subscribe(n));return t}},{key:"subscribe",value:function(e){return this.connected?this._subscribe(e):(this.pending[e]=!0,this.pending[e])}}]),e}(),UpdatesVia=function(){function e(t){_classCallCheck(this,e),this.fetcher=t,this.graph={},this.via={},this.fetcher.addCallback("headers",this.onHeaders)}return _createClass(e,[{key:"onHeaders",value:function(e){var t,n,s;return null==e.headers||("undefined"==typeof WebSocket||null===WebSocket||(t=e.headers.etag,s=e.headers["updates-via"],n=e.uri,t&&s&&(this.graph[n]={etag:t,via:s},this.register(s,n)),!0))}},{key:"onUpdate",value:function(e,t){return this.fetcher.refresh(namedNode(e))}},{key:"register",value:function(e,t){return null==this.via[e]&&(this.via[e]=new UpdatesSocket(this,e)),this.via[e].subscribe(t)}}]),e}();module.exports.UpdatesSocket=UpdatesSocket,module.exports.UpdatesVia=UpdatesVia;
},{"./data-factory":48}],73:[function(require,module,exports){
"use strict";function docpart(e){var r;return r=e.indexOf("#"),r<0?e:e.slice(0,r)}function document(e){return new NamedNode(docpart(e.uri))}function hostpart(e){var r=/[^\/]*\/\/([^\/]*)\//.exec(e);return r?r[1]:""}function join(e,r){var n,t,i,o,f,l=r.indexOf("#");if(l>0&&(r=r.slice(0,l)),0===e.length)return r;if(0===e.indexOf("#"))return r+e;if(e.indexOf(":")>=0)return e;if(n=r.indexOf(":"),0===r.length)return e;if(n<0)return alert("Invalid base: "+r+" in join with given: "+e),e;if(t=r.slice(0,+n+1||9e9),0===e.indexOf("//"))return t+e;if(r.indexOf("//",n)===n+1){if((i=r.indexOf("/",n+3))<0)return r.length-n-3>0?r+"/"+e:t+e}else if((i=r.indexOf("/",n+1))<0)return r.length-n-1>0?r+"/"+e:t+e;if(0===e.indexOf("/"))return r.slice(0,i)+e;if(f=r.slice(i),(o=f.lastIndexOf("/"))<0)return t+e;for(o>=0&&o<f.length-1&&(f=f.slice(0,+o+1||9e9)),f+=e;f.match(/[^\/]*\/\.\.\//);)f=f.replace(/[^\/]*\/\.\.\//,"");return f=f.replace(/\.\//g,""),f=f.replace(/\/\.$/,"/"),r.slice(0,i)+f}function protocol(e){var r;return r=e.indexOf(":"),r<0?null:e.slice(0,r)}function refTo(e,r){var n,t,i,o,f,l,u,c,d,s,a,x,p=new RegExp("^[-_a-zA-Z0-9.]+:(//[^/]*)?/[^/]*$");if(!e)return r;if(e===r)return"";for(n=u=0,o=r.length;u<o&&r[n]===e[n];n=++u);if(e.slice(0,n).match(p)&&(t=r.indexOf("//"),t<0&&(t=-2),i=r.indexOf("/",t+2),"/"!==r[i+1]&&"/"!==e[i+1]&&r.slice(0,i)===e.slice(0,i)))return r.slice(i);if("#"===r[n]&&e.length===n)return r.slice(n);for(;n>0&&"/"!==r[n-1];)n--;if(n<3)return r;if(e.indexOf("//",n-2)>0||r.indexOf("//",n-2)>0)return r;if(e.indexOf(":",n)>0)return r;for(l=0,s=e.slice(n),c=0,f=s.length;c<f;c++)"/"===s[c]&&l++;if(0===l&&n<r.length&&"#"===r[n])return"./"+r.slice(n);if(0===l&&n===r.length)return"./";if(x="",l>0)for(d=1,a=l;a>=1?d<=a:d>=a;a>=1?++d:--d)x+="../";return x+r.slice(n)}var alert=alert||console.log;module.exports.docpart=docpart,module.exports.document=document,module.exports.hostpart=hostpart,module.exports.join=join,module.exports.protocol=protocol,module.exports.refTo=refTo;var NamedNode=require("./named-node");
},{"./named-node":58}],74:[function(require,module,exports){
"use strict";function ajarHandleNewTerm(e,t,r){var a=null;if(void 0!==e.fetcher&&(a=e.fetcher,"NamedNode"===t.termType)){var o,n=docpart(t.uri);if(t.uri.indexOf("#")<0){if(stringStartsWith(t.uri,"http://dbpedia.org/resource/Category:"))return;stringStartsWith(t.uri,"http://purl.org/dc/elements/1.1/")||stringStartsWith(t.uri,"http://purl.org/dc/terms/")?o="http://dublincore.org/2005/06/13/dcq":stringStartsWith(t.uri,"http://xmlns.com/wot/0.1/")?o="http://xmlns.com/wot/0.1/index.rdf":stringStartsWith(t.uri,"http://web.resource.org/cc/")&&(o="http://web.resource.org/cc/schema.rdf")}if(o&&(n=o),!a||"unrequested"===a.getState(n))return o&&log.warn("Assuming server still broken, faking redirect of <"+t.uri+"> to <"+n+">"),a.fetch(n,{referringTerm:r})}}function arrayIndexOf(e,t,r){r||(r=0);var a=e.length;for(r<0&&(r=a+r);r<a;r++)if(e[r]===t)return r;return-1}function callbackify(e,t){e.callbacks={};for(var r=t.length-1;r>=0;r--)e.callbacks[t[r]]=[];e.addHook=function(t){e.callbacks[t]||(e.callbacks[t]=[])},e.addCallback=function(t,r){e.callbacks[t].push(r)},e.removeCallback=function(t,r){for(var a=0;a<e.callbacks[t].length;a++)if(e.callbacks[t][a].name===r)return e.callbacks[t].splice(a,1),!0;return!1},e.insertCallback=function(t,r){e.callbacks[t].unshift(r)},e.fireCallbacks=function(t,r){var a,o=[],n=[],s=e.callbacks[t].length,i=void 0;for(a=s-1;a>=0;a--)(i=e.callbacks[t][a])&&i.apply(e,r)&&o.push(i);for(a=o.length-1;a>=0;a--)n.push(o[a]);for(a=s;a<e.callbacks[t].length;a++)n.push(e.callbacks[t][a]);e.callbacks[t]=n}}function domParser(){return tabulator&&tabulator.isExtension?Components.classes["@mozilla.org/xmlextras/domparser;1"].getService(Components.interfaces.nsIDOMParser):window.DOMParser?new DOMParser:!!window.ActiveXObject&&new ActiveXObject("Microsoft.XMLDOM")}function domToString(e,t){t=t||{};var r=[];"selfClosing"in t&&t.selfClosing.split(" ").forEach(function(e){r[e]=!0});var a=[];return"skipAttributes"in t&&t.skipAttributes.split(" ").forEach(function(e){a[e]=!0}),dumpNode(e,t,r,a)}function dumpNode(e,t,r,a){var o,n="",s=[!1];if(void 0===e.nodeType)return n;if(1===e.nodeType){if(e.hasAttribute("class")&&"classWithChildText"in t&&e.matches(t.classWithChildText.class))n+=e.querySelector(t.classWithChildText.element).textContent;else if(!("skipNodeWithClass"in t&&e.matches("."+t.skipNodeWithClass))){var i=e.nodeName.toLowerCase();n+="<"+i;var l=[];for(o=e.attributes.length-1;o>=0;o--){var c=e.attributes[o];if(!(a.length>0&&a[c.name])&&!/^\d+$/.test(c.name)){if("class"===c.name&&"replaceClassItemWith"in t&&c.value.split(" ").indexOf(t.replaceClassItemWith.source)>-1){var u=new RegExp(t.replaceClassItemWith.source,"g");c.value=c.value.replace(u,t.replaceClassItemWith.target).trim()}"class"===c.name&&"skipClassWithValue"in t&&t.skipClassWithValue===c.value||l.push(c.name+"='"+c.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;")+"'")}}if(l.length>0&&("sortAttributes"in t&&t.sortAttributes&&l.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),n+=" "+l.join(" ")),r[i])n+=" />";else{for(n+=">",n+="html"===i?"\n  ":"",s.push("style"===i||"script"===i),o=0;o<e.childNodes.length;o++)n+=dumpNode(e.childNodes[o]);s.pop(),n+="body"===i?"</"+i+">\n":"</"+i+">"}}}else if(8===e.nodeType)n+="\x3c!--"+e.nodeValue+"--\x3e";else if(3===e.nodeType||4===e.nodeType){var p=e.nodeValue.replace(/\n+$/,"");n+=s[s.length-1]?p:p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}else console.log("Warning; Cannot handle serialising nodes of type: "+e.nodeType),console.log(e);return n}function dtstamp(){var e=new Date,t=e.getYear()+1900,r=e.getMonth()+1,a=e.getDate(),o=e.getUTCHours(),n=e.getUTCMinutes(),s=e.getSeconds();return r<10&&(r="0"+r),a<10&&(a="0"+a),o<10&&(o="0"+o),n<10&&(n="0"+n),s<10&&(s="0"+s),t+"-"+r+"-"+a+"T"+o+":"+n+":"+s+"Z"}function heavyCompare(e,t,r,a){var o=function(e){return"BlankNode"===e.termType?null:e},n=function(e){var t=r.statementsMatching(e).map(function(e){return o(e.subject)+" "+o(e.predicate)+" "+o(e.object)}).concat(r.statementsMatching(void 0,void 0,e).map(function(e){return o(e.subject)+" "+o(e.predicate)+" "+o(e.object)}));return t.sort(),t.join("\n")};return"BlankNode"===e.termType&&"BlankNode"===t.termType?0===e.compareTerm(t)?0:n(e)>n(t)?1:n(e)<n(t)?-1:e.compareTerm(t):a&&e.uri&&t.uri?(a[e.uri]||e.uri).localeCompare(a[t.uri]||t.uri):e.compareTerm(t)}function heavyCompareSPO(e,t,r,a){return heavyCompare(e.subject,t.subject,r,a)||heavyCompare(e.predicate,t.predicate,r,a)||heavyCompare(e.object,t.object,r,a)}function output(e){var t=document.createElement("div");t.textContent=e,document.body.appendChild(t)}function parseXML(e,t){var r;if(t=t||{},"undefined"!=typeof tabulator&&tabulator.isExtension)r=Components.classes["@mozilla.org/xmlextras/domparser;1"].getService(Components.interfaces.nsIDOMParser);else{if("undefined"!=typeof module&&module&&module.exports){var a=require("xmldom").DOMParser;return(new a).parseFromString(e,t.contentType||"application/xhtml+xml")}r="undefined"!=typeof window&&window.DOMParser?new window.DOMParser:new a}return r.parseFromString(e,"application/xml")}function rdfArrayRemove(e,t){for(var r=0;r<e.length;r++)if(e[r].subject.sameTerm(t.subject)&&e[r].predicate.sameTerm(t.predicate)&&e[r].object.sameTerm(t.object)&&e[r].why.sameTerm(t.why))return void e.splice(r,1);throw new Error("RDFArrayRemove: Array did not contain "+t+" "+t.why)}function stringStartsWith(e,t){return e.slice(0,t.length)===t}function stringTemplate(e,t){for(var r=e.split("%s"),a="",o=0;o<t.length;o++)t[o]+="",a+=r[o]+t[o];return a+r.slice(t.length).join()}function stackString(e){var t=e+"\n";if(!e.stack)return t+"No stack available.\n";for(var r=e.stack.toString().split("\n"),a=[],o=0;o<r.length;o++){var n=r[o];if(n.indexOf("ecmaunit.js")>-1)break;"("==n.charAt(0)&&(n="function"+n);var s=n.split("@");a.push(s)}for(var o=0;o<a.length;o++)t+="  "+a[o][1]+"\n    "+a[o][0];return t}var docpart=require("./uri").docpart,log=require("./log"),NamedNode=require("./named-node");module.exports.AJAR_handleNewTerm=ajarHandleNewTerm,module.exports.ArrayIndexOf=arrayIndexOf,module.exports.callbackify=callbackify,module.exports.dtstamp=dtstamp,module.exports.DOMParserFactory=domParser,module.exports.domToString=domToString,module.exports.dumpNode=dumpNode,module.exports.heavyCompare=heavyCompare,module.exports.heavyCompareSPO=heavyCompareSPO,module.exports.output=output,module.exports.parseXML=parseXML,module.exports.RDFArrayRemove=rdfArrayRemove,module.exports.stackString=stackString,module.exports.string_startswith=stringStartsWith,module.exports.string={},module.exports.string.template=stringTemplate,module.exports.uri=require("./uri"),module.exports.log=log,module.exports.mediaTypeClass=function(e){return e=e.split(";")[0].trim(),new NamedNode("http://www.w3.org/ns/iana/media-types/"+e+"#Resource")};
},{"./log":56,"./named-node":58,"./uri":73,"xmldom":undefined}],75:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),ClassOrder=require("./class-order"),Node=require("./node"),Uri=require("./uri"),Variable=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.termType=t.termType,r.value=e,r.base="varid:",r.uri=Uri.join(e,r.base),r}return _inherits(t,e),_createClass(t,[{key:"equals",value:function(e){return!!e&&(this.termType===e.termType&&this.value===e.value)}},{key:"hashString",value:function(){return this.toString()}},{key:"substitute",value:function(e){var t;return null!=(t=e[this.toNT()])?t:this}},{key:"toString",value:function(){return this.uri.slice(0,this.base.length)===this.base?"?"+this.uri.slice(this.base.length):"?"+this.uri}}]),t}(Node);Variable.termType="Variable",Variable.prototype.classOrder=ClassOrder.Variable,Variable.prototype.isVar=1,module.exports=Variable;
},{"./class-order":45,"./node":60,"./uri":73}],76:[function(require,module,exports){
"use strict";function _classCallCheck(e,w){if(!(e instanceof w))throw new TypeError("Cannot call a class as a function")}var NamedNode=require("./named-node"),XSD=function e(){_classCallCheck(this,e)};XSD.boolean=new NamedNode("http://www.w3.org/2001/XMLSchema#boolean"),XSD.dateTime=new NamedNode("http://www.w3.org/2001/XMLSchema#dateTime"),XSD.decimal=new NamedNode("http://www.w3.org/2001/XMLSchema#decimal"),XSD.double=new NamedNode("http://www.w3.org/2001/XMLSchema#double"),XSD.integer=new NamedNode("http://www.w3.org/2001/XMLSchema#integer"),XSD.langString=new NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"),XSD.string=new NamedNode("http://www.w3.org/2001/XMLSchema#string"),module.exports=XSD;
},{"./named-node":58}],"rdflib":[function(require,module,exports){
"use strict";function _interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}var _indexedFormula=require("./indexed-formula"),_indexedFormula2=_interopRequireDefault(_indexedFormula),$rdf={BlankNode:require("./blank-node"),Collection:require("./collection"),convert:require("./convert"),DataFactory:require("./data-factory"),Empty:require("./empty"),Fetcher:require("./fetcher"),Formula:require("./formula"),IndexedFormula:_indexedFormula2.default,jsonParser:require("./jsonparser"),Literal:require("./literal"),log:require("./log"),N3Parser:require("./n3parser"),NamedNode:require("./named-node"),Namespace:require("./namespace"),Node:require("./node"),parse:require("./parse"),Query:require("./query").Query,queryToSPARQL:require("./query-to-sparql"),RDFaProcessor:require("./rdfaparser"),RDFParser:require("./rdfxmlparser"),serialize:require("./serialize"),Serializer:require("./serializer"),SPARQLToQuery:require("./sparql-to-query"),sparqlUpdateParser:require("./patch-parser"),Statement:require("./statement"),term:require("./node").fromValue,UpdateManager:require("./update-manager"),UpdatesSocket:require("./updates-via").UpdatesSocket,UpdatesVia:require("./updates-via").UpdatesVia,uri:require("./uri"),Util:require("./util"),Variable:require("./variable")};$rdf.NextId=$rdf.BlankNode.nextId,$rdf.fromNT=$rdf.Formula.prototype.fromNT,$rdf.fetcher=$rdf.DataFactory.fetcher,$rdf.graph=$rdf.DataFactory.graph,$rdf.lit=$rdf.DataFactory.lit,$rdf.st=$rdf.DataFactory.st,$rdf.sym=$rdf.DataFactory.namedNode,$rdf.variable=$rdf.DataFactory.variable,$rdf.blankNode=$rdf.DataFactory.blankNode,$rdf.defaultGraph=$rdf.DataFactory.defaultGraph,$rdf.literal=$rdf.DataFactory.literal,$rdf.namedNode=$rdf.DataFactory.namedNode,$rdf.quad=$rdf.DataFactory.quad,$rdf.triple=$rdf.DataFactory.triple,module.exports=$rdf;
},{"./blank-node":44,"./collection":46,"./convert":47,"./data-factory":48,"./empty":50,"./fetcher":51,"./formula":52,"./indexed-formula":53,"./jsonparser":54,"./literal":55,"./log":56,"./n3parser":57,"./named-node":58,"./namespace":59,"./node":60,"./parse":61,"./patch-parser":62,"./query":64,"./query-to-sparql":63,"./rdfaparser":65,"./rdfxmlparser":66,"./serialize":67,"./serializer":68,"./sparql-to-query":69,"./statement":70,"./update-manager":71,"./updates-via":72,"./uri":73,"./util":74,"./variable":75}]},{},[])("rdflib")
});

